var rE=Object.defineProperty;var iE=(t,e,n)=>e in t?rE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var g=(t,e,n)=>iE(t,typeof e!="symbol"?e+"":e,n);function sE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Zk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _m(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mm={exports:{}},Ll={},ym={exports:{}},K={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oo=Symbol.for("react.element"),oE=Symbol.for("react.portal"),aE=Symbol.for("react.fragment"),lE=Symbol.for("react.strict_mode"),cE=Symbol.for("react.profiler"),uE=Symbol.for("react.provider"),fE=Symbol.for("react.context"),hE=Symbol.for("react.forward_ref"),dE=Symbol.for("react.suspense"),pE=Symbol.for("react.memo"),gE=Symbol.for("react.lazy"),Kd=Symbol.iterator;function _E(t){return t===null||typeof t!="object"?null:(t=Kd&&t[Kd]||t["@@iterator"],typeof t=="function"?t:null)}var vm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tm=Object.assign,Em={};function Bi(t,e,n){this.props=t,this.context=e,this.refs=Em,this.updater=n||vm}Bi.prototype.isReactComponent={};Bi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Bi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Sm(){}Sm.prototype=Bi.prototype;function hh(t,e,n){this.props=t,this.context=e,this.refs=Em,this.updater=n||vm}var dh=hh.prototype=new Sm;dh.constructor=hh;Tm(dh,Bi.prototype);dh.isPureReactComponent=!0;var qd=Array.isArray,wm=Object.prototype.hasOwnProperty,ph={current:null},Am={key:!0,ref:!0,__self:!0,__source:!0};function Rm(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)wm.call(e,r)&&!Am.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:oo,type:t,key:s,ref:o,props:i,_owner:ph.current}}function mE(t,e){return{$$typeof:oo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function gh(t){return typeof t=="object"&&t!==null&&t.$$typeof===oo}function yE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Zd=/\/+/g;function Ec(t,e){return typeof t=="object"&&t!==null&&t.key!=null?yE(""+t.key):e.toString(36)}function la(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case oo:case oE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ec(o,0):r,qd(i)?(n="",t!=null&&(n=t.replace(Zd,"$&/")+"/"),la(i,e,n,"",function(c){return c})):i!=null&&(gh(i)&&(i=mE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Zd,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",qd(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+Ec(s,a);o+=la(s,e,n,l,i)}else if(l=_E(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+Ec(s,a++),o+=la(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function xo(t,e,n){if(t==null)return t;var r=[],i=0;return la(t,r,"","",function(s){return e.call(n,s,i++)}),r}function vE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var $e={current:null},ca={transition:null},TE={ReactCurrentDispatcher:$e,ReactCurrentBatchConfig:ca,ReactCurrentOwner:ph};function bm(){throw Error("act(...) is not supported in production builds of React.")}K.Children={map:xo,forEach:function(t,e,n){xo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return xo(t,function(){e++}),e},toArray:function(t){return xo(t,function(e){return e})||[]},only:function(t){if(!gh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};K.Component=Bi;K.Fragment=aE;K.Profiler=cE;K.PureComponent=hh;K.StrictMode=lE;K.Suspense=dE;K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TE;K.act=bm;K.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Tm({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=ph.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)wm.call(e,l)&&!Am.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:oo,type:t.type,key:i,ref:s,props:r,_owner:o}};K.createContext=function(t){return t={$$typeof:fE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:uE,_context:t},t.Consumer=t};K.createElement=Rm;K.createFactory=function(t){var e=Rm.bind(null,t);return e.type=t,e};K.createRef=function(){return{current:null}};K.forwardRef=function(t){return{$$typeof:hE,render:t}};K.isValidElement=gh;K.lazy=function(t){return{$$typeof:gE,_payload:{_status:-1,_result:t},_init:vE}};K.memo=function(t,e){return{$$typeof:pE,type:t,compare:e===void 0?null:e}};K.startTransition=function(t){var e=ca.transition;ca.transition={};try{t()}finally{ca.transition=e}};K.unstable_act=bm;K.useCallback=function(t,e){return $e.current.useCallback(t,e)};K.useContext=function(t){return $e.current.useContext(t)};K.useDebugValue=function(){};K.useDeferredValue=function(t){return $e.current.useDeferredValue(t)};K.useEffect=function(t,e){return $e.current.useEffect(t,e)};K.useId=function(){return $e.current.useId()};K.useImperativeHandle=function(t,e,n){return $e.current.useImperativeHandle(t,e,n)};K.useInsertionEffect=function(t,e){return $e.current.useInsertionEffect(t,e)};K.useLayoutEffect=function(t,e){return $e.current.useLayoutEffect(t,e)};K.useMemo=function(t,e){return $e.current.useMemo(t,e)};K.useReducer=function(t,e,n){return $e.current.useReducer(t,e,n)};K.useRef=function(t){return $e.current.useRef(t)};K.useState=function(t){return $e.current.useState(t)};K.useSyncExternalStore=function(t,e,n){return $e.current.useSyncExternalStore(t,e,n)};K.useTransition=function(){return $e.current.useTransition()};K.version="18.3.1";ym.exports=K;var k=ym.exports;const EE=_m(k);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SE=k,wE=Symbol.for("react.element"),AE=Symbol.for("react.fragment"),RE=Object.prototype.hasOwnProperty,bE=SE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CE={key:!0,ref:!0,__self:!0,__source:!0};function Cm(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)RE.call(e,r)&&!CE.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:wE,type:t,key:s,ref:o,props:i,_owner:bE.current}}Ll.Fragment=AE;Ll.jsx=Cm;Ll.jsxs=Cm;mm.exports=Ll;var W=mm.exports,Pm={exports:{}},st={},xm={exports:{}},Im={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,$){var X=z.length;z.push($);e:for(;0<X;){var de=X-1>>>1,ce=z[de];if(0<i(ce,$))z[de]=$,z[X]=ce,X=de;else break e}}function n(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var $=z[0],X=z.pop();if(X!==$){z[0]=X;e:for(var de=0,ce=z.length,Nr=ce>>>1;de<Nr;){var vt=2*(de+1)-1,ji=z[vt],qt=vt+1,Te=z[qt];if(0>i(ji,X))qt<ce&&0>i(Te,ji)?(z[de]=Te,z[qt]=X,de=qt):(z[de]=ji,z[vt]=X,de=vt);else if(qt<ce&&0>i(Te,X))z[de]=Te,z[qt]=X,de=qt;else break e}}return $}function i(z,$){var X=z.sortIndex-$.sortIndex;return X!==0?X:z.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,_=!1,y=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(z){for(var $=n(c);$!==null;){if($.callback===null)r(c);else if($.startTime<=z)r(c),$.sortIndex=$.expirationTime,e(l,$);else break;$=n(c)}}function A(z){if(S=!1,E(z),!y)if(n(l)!==null)y=!0,zi(x);else{var $=n(c);$!==null&&Mr(A,$.startTime-z)}}function x(z,$){y=!1,S&&(S=!1,m(D),D=-1),_=!0;var X=h;try{for(E($),f=n(l);f!==null&&(!(f.expirationTime>$)||z&&!H());){var de=f.callback;if(typeof de=="function"){f.callback=null,h=f.priorityLevel;var ce=de(f.expirationTime<=$);$=t.unstable_now(),typeof ce=="function"?f.callback=ce:f===n(l)&&r(l),E($)}else r(l);f=n(l)}if(f!==null)var Nr=!0;else{var vt=n(c);vt!==null&&Mr(A,vt.startTime-$),Nr=!1}return Nr}finally{f=null,h=X,_=!1}}var M=!1,N=null,D=-1,L=5,U=-1;function H(){return!(t.unstable_now()-U<L)}function Q(){if(N!==null){var z=t.unstable_now();U=z;var $=!0;try{$=N(!0,z)}finally{$?ee():(M=!1,N=null)}}else M=!1}var ee;if(typeof p=="function")ee=function(){p(Q)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,at=q.port2;q.port1.onmessage=Q,ee=function(){at.postMessage(null)}}else ee=function(){C(Q,0)};function zi(z){N=z,M||(M=!0,ee())}function Mr(z,$){D=C(function(){z(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){y||_||(y=!0,zi(x))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(z){switch(h){case 1:case 2:case 3:var $=3;break;default:$=h}var X=h;h=$;try{return z()}finally{h=X}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,$){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var X=h;h=z;try{return $()}finally{h=X}},t.unstable_scheduleCallback=function(z,$,X){var de=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?de+X:de):X=de,z){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=X+ce,z={id:u++,callback:$,priorityLevel:z,startTime:X,expirationTime:ce,sortIndex:-1},X>de?(z.sortIndex=X,e(c,z),n(l)===null&&z===n(c)&&(S?(m(D),D=-1):S=!0,Mr(A,X-de))):(z.sortIndex=ce,e(l,z),y||_||(y=!0,zi(x))),z},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(z){var $=h;return function(){var X=h;h=$;try{return z.apply(this,arguments)}finally{h=X}}}})(Im);xm.exports=Im;var PE=xm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xE=k,it=PE;function F(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Mm=new Set,Ds={};function Ar(t,e){Ti(t,e),Ti(t+"Capture",e)}function Ti(t,e){for(Ds[t]=e,t=0;t<e.length;t++)Mm.add(e[t])}var an=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bu=Object.prototype.hasOwnProperty,IE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qd={},Jd={};function ME(t){return bu.call(Jd,t)?!0:bu.call(Qd,t)?!1:IE.test(t)?Jd[t]=!0:(Qd[t]=!0,!1)}function NE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function kE(t,e,n,r){if(e===null||typeof e>"u"||NE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fe[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fe[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fe[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fe[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fe[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fe[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fe[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fe[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fe[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var _h=/[\-:]([a-z])/g;function mh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(_h,mh);Fe[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(_h,mh);Fe[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(_h,mh);Fe[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fe[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Fe.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fe[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function yh(t,e,n,r){var i=Fe.hasOwnProperty(e)?Fe[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(kE(e,n,i,r)&&(n=null),r||i===null?ME(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var hn=xE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Io=Symbol.for("react.element"),Hr=Symbol.for("react.portal"),Wr=Symbol.for("react.fragment"),vh=Symbol.for("react.strict_mode"),Cu=Symbol.for("react.profiler"),Nm=Symbol.for("react.provider"),km=Symbol.for("react.context"),Th=Symbol.for("react.forward_ref"),Pu=Symbol.for("react.suspense"),xu=Symbol.for("react.suspense_list"),Eh=Symbol.for("react.memo"),En=Symbol.for("react.lazy"),Om=Symbol.for("react.offscreen"),Gd=Symbol.iterator;function Zi(t){return t===null||typeof t!="object"?null:(t=Gd&&t[Gd]||t["@@iterator"],typeof t=="function"?t:null)}var _e=Object.assign,Sc;function fs(t){if(Sc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Sc=e&&e[1]||""}return`
`+Sc+t}var wc=!1;function Ac(t,e){if(!t||wc)return"";wc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{wc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?fs(t):""}function OE(t){switch(t.tag){case 5:return fs(t.type);case 16:return fs("Lazy");case 13:return fs("Suspense");case 19:return fs("SuspenseList");case 0:case 2:case 15:return t=Ac(t.type,!1),t;case 11:return t=Ac(t.type.render,!1),t;case 1:return t=Ac(t.type,!0),t;default:return""}}function Iu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Wr:return"Fragment";case Hr:return"Portal";case Cu:return"Profiler";case vh:return"StrictMode";case Pu:return"Suspense";case xu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case km:return(t.displayName||"Context")+".Consumer";case Nm:return(t._context.displayName||"Context")+".Provider";case Th:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Eh:return e=t.displayName||null,e!==null?e:Iu(t.type)||"Memo";case En:e=t._payload,t=t._init;try{return Iu(t(e))}catch{}}return null}function FE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Iu(e);case 8:return e===vh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function zn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Fm(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function DE(t){var e=Fm(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Mo(t){t._valueTracker||(t._valueTracker=DE(t))}function Dm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Fm(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function wa(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Mu(t,e){var n=e.checked;return _e({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ep(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=zn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Bm(t,e){e=e.checked,e!=null&&yh(t,"checked",e,!1)}function Nu(t,e){Bm(t,e);var n=zn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ku(t,e.type,n):e.hasOwnProperty("defaultValue")&&ku(t,e.type,zn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ku(t,e,n){(e!=="number"||wa(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var hs=Array.isArray;function li(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+zn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Ou(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return _e({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function np(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(F(92));if(hs(n)){if(1<n.length)throw Error(F(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:zn(n)}}function Um(t,e){var n=zn(e.value),r=zn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Lm(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Lm(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var No,Vm=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(No=No||document.createElement("div"),No.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=No.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Bs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var vs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BE=["Webkit","ms","Moz","O"];Object.keys(vs).forEach(function(t){BE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),vs[e]=vs[t]})});function zm(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||vs.hasOwnProperty(t)&&vs[t]?(""+e).trim():e+"px"}function jm(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=zm(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var UE=_e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Du(t,e){if(e){if(UE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function Bu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Uu=null;function Sh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Lu=null,ci=null,ui=null;function ip(t){if(t=co(t)){if(typeof Lu!="function")throw Error(F(280));var e=t.stateNode;e&&(e=Wl(e),Lu(t.stateNode,t.type,e))}}function Hm(t){ci?ui?ui.push(t):ui=[t]:ci=t}function Wm(){if(ci){var t=ci,e=ui;if(ui=ci=null,ip(t),e)for(t=0;t<e.length;t++)ip(e[t])}}function $m(t,e){return t(e)}function Xm(){}var Rc=!1;function Ym(t,e,n){if(Rc)return t(e,n);Rc=!0;try{return $m(t,e,n)}finally{Rc=!1,(ci!==null||ui!==null)&&(Xm(),Wm())}}function Us(t,e){var n=t.stateNode;if(n===null)return null;var r=Wl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(F(231,e,typeof n));return n}var Vu=!1;if(an)try{var Qi={};Object.defineProperty(Qi,"passive",{get:function(){Vu=!0}}),window.addEventListener("test",Qi,Qi),window.removeEventListener("test",Qi,Qi)}catch{Vu=!1}function LE(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ts=!1,Aa=null,Ra=!1,zu=null,VE={onError:function(t){Ts=!0,Aa=t}};function zE(t,e,n,r,i,s,o,a,l){Ts=!1,Aa=null,LE.apply(VE,arguments)}function jE(t,e,n,r,i,s,o,a,l){if(zE.apply(this,arguments),Ts){if(Ts){var c=Aa;Ts=!1,Aa=null}else throw Error(F(198));Ra||(Ra=!0,zu=c)}}function Rr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Km(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sp(t){if(Rr(t)!==t)throw Error(F(188))}function HE(t){var e=t.alternate;if(!e){if(e=Rr(t),e===null)throw Error(F(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return sp(i),t;if(s===r)return sp(i),e;s=s.sibling}throw Error(F(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(F(189))}}if(n.alternate!==r)throw Error(F(190))}if(n.tag!==3)throw Error(F(188));return n.stateNode.current===n?t:e}function qm(t){return t=HE(t),t!==null?Zm(t):null}function Zm(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Zm(t);if(e!==null)return e;t=t.sibling}return null}var Qm=it.unstable_scheduleCallback,op=it.unstable_cancelCallback,WE=it.unstable_shouldYield,$E=it.unstable_requestPaint,ve=it.unstable_now,XE=it.unstable_getCurrentPriorityLevel,wh=it.unstable_ImmediatePriority,Jm=it.unstable_UserBlockingPriority,ba=it.unstable_NormalPriority,YE=it.unstable_LowPriority,Gm=it.unstable_IdlePriority,Vl=null,$t=null;function KE(t){if($t&&typeof $t.onCommitFiberRoot=="function")try{$t.onCommitFiberRoot(Vl,t,void 0,(t.current.flags&128)===128)}catch{}}var Ct=Math.clz32?Math.clz32:QE,qE=Math.log,ZE=Math.LN2;function QE(t){return t>>>=0,t===0?32:31-(qE(t)/ZE|0)|0}var ko=64,Oo=4194304;function ds(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ca(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=ds(a):(s&=o,s!==0&&(r=ds(s)))}else o=n&~i,o!==0?r=ds(o):s!==0&&(r=ds(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ct(e),i=1<<n,r|=t[n],e&=~i;return r}function JE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function GE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ct(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=JE(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function ju(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ey(){var t=ko;return ko<<=1,!(ko&4194240)&&(ko=64),t}function bc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ao(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ct(e),t[e]=n}function eS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ct(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Ah(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ct(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var G=0;function ty(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ny,Rh,ry,iy,sy,Hu=!1,Fo=[],Nn=null,kn=null,On=null,Ls=new Map,Vs=new Map,Rn=[],tS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ap(t,e){switch(t){case"focusin":case"focusout":Nn=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":On=null;break;case"pointerover":case"pointerout":Ls.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vs.delete(e.pointerId)}}function Ji(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=co(e),e!==null&&Rh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function nS(t,e,n,r,i){switch(e){case"focusin":return Nn=Ji(Nn,t,e,n,r,i),!0;case"dragenter":return kn=Ji(kn,t,e,n,r,i),!0;case"mouseover":return On=Ji(On,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Ls.set(s,Ji(Ls.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Vs.set(s,Ji(Vs.get(s)||null,t,e,n,r,i)),!0}return!1}function oy(t){var e=sr(t.target);if(e!==null){var n=Rr(e);if(n!==null){if(e=n.tag,e===13){if(e=Km(n),e!==null){t.blockedOn=e,sy(t.priority,function(){ry(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ua(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Wu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Uu=r,n.target.dispatchEvent(r),Uu=null}else return e=co(n),e!==null&&Rh(e),t.blockedOn=n,!1;e.shift()}return!0}function lp(t,e,n){ua(t)&&n.delete(e)}function rS(){Hu=!1,Nn!==null&&ua(Nn)&&(Nn=null),kn!==null&&ua(kn)&&(kn=null),On!==null&&ua(On)&&(On=null),Ls.forEach(lp),Vs.forEach(lp)}function Gi(t,e){t.blockedOn===e&&(t.blockedOn=null,Hu||(Hu=!0,it.unstable_scheduleCallback(it.unstable_NormalPriority,rS)))}function zs(t){function e(i){return Gi(i,t)}if(0<Fo.length){Gi(Fo[0],t);for(var n=1;n<Fo.length;n++){var r=Fo[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Nn!==null&&Gi(Nn,t),kn!==null&&Gi(kn,t),On!==null&&Gi(On,t),Ls.forEach(e),Vs.forEach(e),n=0;n<Rn.length;n++)r=Rn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Rn.length&&(n=Rn[0],n.blockedOn===null);)oy(n),n.blockedOn===null&&Rn.shift()}var fi=hn.ReactCurrentBatchConfig,Pa=!0;function iS(t,e,n,r){var i=G,s=fi.transition;fi.transition=null;try{G=1,bh(t,e,n,r)}finally{G=i,fi.transition=s}}function sS(t,e,n,r){var i=G,s=fi.transition;fi.transition=null;try{G=4,bh(t,e,n,r)}finally{G=i,fi.transition=s}}function bh(t,e,n,r){if(Pa){var i=Wu(t,e,n,r);if(i===null)Dc(t,e,r,xa,n),ap(t,r);else if(nS(i,t,e,n,r))r.stopPropagation();else if(ap(t,r),e&4&&-1<tS.indexOf(t)){for(;i!==null;){var s=co(i);if(s!==null&&ny(s),s=Wu(t,e,n,r),s===null&&Dc(t,e,r,xa,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Dc(t,e,r,null,n)}}var xa=null;function Wu(t,e,n,r){if(xa=null,t=Sh(r),t=sr(t),t!==null)if(e=Rr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Km(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return xa=t,null}function ay(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XE()){case wh:return 1;case Jm:return 4;case ba:case YE:return 16;case Gm:return 536870912;default:return 16}default:return 16}}var Cn=null,Ch=null,fa=null;function ly(){if(fa)return fa;var t,e=Ch,n=e.length,r,i="value"in Cn?Cn.value:Cn.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return fa=i.slice(t,1<r?1-r:void 0)}function ha(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Do(){return!0}function cp(){return!1}function ot(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Do:cp,this.isPropagationStopped=cp,this}return _e(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),e}var Ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ph=ot(Ui),lo=_e({},Ui,{view:0,detail:0}),oS=ot(lo),Cc,Pc,es,zl=_e({},lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==es&&(es&&t.type==="mousemove"?(Cc=t.screenX-es.screenX,Pc=t.screenY-es.screenY):Pc=Cc=0,es=t),Cc)},movementY:function(t){return"movementY"in t?t.movementY:Pc}}),up=ot(zl),aS=_e({},zl,{dataTransfer:0}),lS=ot(aS),cS=_e({},lo,{relatedTarget:0}),xc=ot(cS),uS=_e({},Ui,{animationName:0,elapsedTime:0,pseudoElement:0}),fS=ot(uS),hS=_e({},Ui,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dS=ot(hS),pS=_e({},Ui,{data:0}),fp=ot(pS),gS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_S={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mS[t])?!!e[t]:!1}function xh(){return yS}var vS=_e({},lo,{key:function(t){if(t.key){var e=gS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ha(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?_S[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xh,charCode:function(t){return t.type==="keypress"?ha(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ha(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),TS=ot(vS),ES=_e({},zl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hp=ot(ES),SS=_e({},lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xh}),wS=ot(SS),AS=_e({},Ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),RS=ot(AS),bS=_e({},zl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CS=ot(bS),PS=[9,13,27,32],Ih=an&&"CompositionEvent"in window,Es=null;an&&"documentMode"in document&&(Es=document.documentMode);var xS=an&&"TextEvent"in window&&!Es,cy=an&&(!Ih||Es&&8<Es&&11>=Es),dp=" ",pp=!1;function uy(t,e){switch(t){case"keyup":return PS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var $r=!1;function IS(t,e){switch(t){case"compositionend":return fy(e);case"keypress":return e.which!==32?null:(pp=!0,dp);case"textInput":return t=e.data,t===dp&&pp?null:t;default:return null}}function MS(t,e){if($r)return t==="compositionend"||!Ih&&uy(t,e)?(t=ly(),fa=Ch=Cn=null,$r=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cy&&e.locale!=="ko"?null:e.data;default:return null}}var NS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!NS[t.type]:e==="textarea"}function hy(t,e,n,r){Hm(r),e=Ia(e,"onChange"),0<e.length&&(n=new Ph("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ss=null,js=null;function kS(t){wy(t,0)}function jl(t){var e=Kr(t);if(Dm(e))return t}function OS(t,e){if(t==="change")return e}var dy=!1;if(an){var Ic;if(an){var Mc="oninput"in document;if(!Mc){var _p=document.createElement("div");_p.setAttribute("oninput","return;"),Mc=typeof _p.oninput=="function"}Ic=Mc}else Ic=!1;dy=Ic&&(!document.documentMode||9<document.documentMode)}function mp(){Ss&&(Ss.detachEvent("onpropertychange",py),js=Ss=null)}function py(t){if(t.propertyName==="value"&&jl(js)){var e=[];hy(e,js,t,Sh(t)),Ym(kS,e)}}function FS(t,e,n){t==="focusin"?(mp(),Ss=e,js=n,Ss.attachEvent("onpropertychange",py)):t==="focusout"&&mp()}function DS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return jl(js)}function BS(t,e){if(t==="click")return jl(e)}function US(t,e){if(t==="input"||t==="change")return jl(e)}function LS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xt=typeof Object.is=="function"?Object.is:LS;function Hs(t,e){if(xt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!bu.call(e,i)||!xt(t[i],e[i]))return!1}return!0}function yp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function vp(t,e){var n=yp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yp(n)}}function gy(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?gy(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _y(){for(var t=window,e=wa();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=wa(t.document)}return e}function Mh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function VS(t){var e=_y(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&gy(n.ownerDocument.documentElement,n)){if(r!==null&&Mh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=vp(n,s);var o=vp(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var zS=an&&"documentMode"in document&&11>=document.documentMode,Xr=null,$u=null,ws=null,Xu=!1;function Tp(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Xu||Xr==null||Xr!==wa(r)||(r=Xr,"selectionStart"in r&&Mh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ws&&Hs(ws,r)||(ws=r,r=Ia($u,"onSelect"),0<r.length&&(e=new Ph("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Xr)))}function Bo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Yr={animationend:Bo("Animation","AnimationEnd"),animationiteration:Bo("Animation","AnimationIteration"),animationstart:Bo("Animation","AnimationStart"),transitionend:Bo("Transition","TransitionEnd")},Nc={},my={};an&&(my=document.createElement("div").style,"AnimationEvent"in window||(delete Yr.animationend.animation,delete Yr.animationiteration.animation,delete Yr.animationstart.animation),"TransitionEvent"in window||delete Yr.transitionend.transition);function Hl(t){if(Nc[t])return Nc[t];if(!Yr[t])return t;var e=Yr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in my)return Nc[t]=e[n];return t}var yy=Hl("animationend"),vy=Hl("animationiteration"),Ty=Hl("animationstart"),Ey=Hl("transitionend"),Sy=new Map,Ep="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $n(t,e){Sy.set(t,e),Ar(e,[t])}for(var kc=0;kc<Ep.length;kc++){var Oc=Ep[kc],jS=Oc.toLowerCase(),HS=Oc[0].toUpperCase()+Oc.slice(1);$n(jS,"on"+HS)}$n(yy,"onAnimationEnd");$n(vy,"onAnimationIteration");$n(Ty,"onAnimationStart");$n("dblclick","onDoubleClick");$n("focusin","onFocus");$n("focusout","onBlur");$n(Ey,"onTransitionEnd");Ti("onMouseEnter",["mouseout","mouseover"]);Ti("onMouseLeave",["mouseout","mouseover"]);Ti("onPointerEnter",["pointerout","pointerover"]);Ti("onPointerLeave",["pointerout","pointerover"]);Ar("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ar("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ar("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ar("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ps="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WS=new Set("cancel close invalid load scroll toggle".split(" ").concat(ps));function Sp(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,jE(r,e,void 0,t),t.currentTarget=null}function wy(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Sp(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Sp(i,a,c),s=l}}}if(Ra)throw t=zu,Ra=!1,zu=null,t}function ae(t,e){var n=e[Qu];n===void 0&&(n=e[Qu]=new Set);var r=t+"__bubble";n.has(r)||(Ay(e,t,2,!1),n.add(r))}function Fc(t,e,n){var r=0;e&&(r|=4),Ay(n,t,r,e)}var Uo="_reactListening"+Math.random().toString(36).slice(2);function Ws(t){if(!t[Uo]){t[Uo]=!0,Mm.forEach(function(n){n!=="selectionchange"&&(WS.has(n)||Fc(n,!1,t),Fc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Uo]||(e[Uo]=!0,Fc("selectionchange",!1,e))}}function Ay(t,e,n,r){switch(ay(e)){case 1:var i=iS;break;case 4:i=sS;break;default:i=bh}n=i.bind(null,e,n,t),i=void 0,!Vu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Dc(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=sr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}Ym(function(){var c=s,u=Sh(n),f=[];e:{var h=Sy.get(t);if(h!==void 0){var _=Ph,y=t;switch(t){case"keypress":if(ha(n)===0)break e;case"keydown":case"keyup":_=TS;break;case"focusin":y="focus",_=xc;break;case"focusout":y="blur",_=xc;break;case"beforeblur":case"afterblur":_=xc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=up;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=lS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=wS;break;case yy:case vy:case Ty:_=fS;break;case Ey:_=RS;break;case"scroll":_=oS;break;case"wheel":_=CS;break;case"copy":case"cut":case"paste":_=dS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=hp}var S=(e&4)!==0,C=!S&&t==="scroll",m=S?h!==null?h+"Capture":null:h;S=[];for(var p=c,E;p!==null;){E=p;var A=E.stateNode;if(E.tag===5&&A!==null&&(E=A,m!==null&&(A=Us(p,m),A!=null&&S.push($s(p,A,E)))),C)break;p=p.return}0<S.length&&(h=new _(h,y,null,n,u),f.push({event:h,listeners:S}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",h&&n!==Uu&&(y=n.relatedTarget||n.fromElement)&&(sr(y)||y[ln]))break e;if((_||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,_?(y=n.relatedTarget||n.toElement,_=c,y=y?sr(y):null,y!==null&&(C=Rr(y),y!==C||y.tag!==5&&y.tag!==6)&&(y=null)):(_=null,y=c),_!==y)){if(S=up,A="onMouseLeave",m="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(S=hp,A="onPointerLeave",m="onPointerEnter",p="pointer"),C=_==null?h:Kr(_),E=y==null?h:Kr(y),h=new S(A,p+"leave",_,n,u),h.target=C,h.relatedTarget=E,A=null,sr(u)===c&&(S=new S(m,p+"enter",y,n,u),S.target=E,S.relatedTarget=C,A=S),C=A,_&&y)t:{for(S=_,m=y,p=0,E=S;E;E=Or(E))p++;for(E=0,A=m;A;A=Or(A))E++;for(;0<p-E;)S=Or(S),p--;for(;0<E-p;)m=Or(m),E--;for(;p--;){if(S===m||m!==null&&S===m.alternate)break t;S=Or(S),m=Or(m)}S=null}else S=null;_!==null&&wp(f,h,_,S,!1),y!==null&&C!==null&&wp(f,C,y,S,!0)}}e:{if(h=c?Kr(c):window,_=h.nodeName&&h.nodeName.toLowerCase(),_==="select"||_==="input"&&h.type==="file")var x=OS;else if(gp(h))if(dy)x=US;else{x=DS;var M=FS}else(_=h.nodeName)&&_.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(x=BS);if(x&&(x=x(t,c))){hy(f,x,n,u);break e}M&&M(t,h,c),t==="focusout"&&(M=h._wrapperState)&&M.controlled&&h.type==="number"&&ku(h,"number",h.value)}switch(M=c?Kr(c):window,t){case"focusin":(gp(M)||M.contentEditable==="true")&&(Xr=M,$u=c,ws=null);break;case"focusout":ws=$u=Xr=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,Tp(f,n,u);break;case"selectionchange":if(zS)break;case"keydown":case"keyup":Tp(f,n,u)}var N;if(Ih)e:{switch(t){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else $r?uy(t,n)&&(D="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(D="onCompositionStart");D&&(cy&&n.locale!=="ko"&&($r||D!=="onCompositionStart"?D==="onCompositionEnd"&&$r&&(N=ly()):(Cn=u,Ch="value"in Cn?Cn.value:Cn.textContent,$r=!0)),M=Ia(c,D),0<M.length&&(D=new fp(D,t,null,n,u),f.push({event:D,listeners:M}),N?D.data=N:(N=fy(n),N!==null&&(D.data=N)))),(N=xS?IS(t,n):MS(t,n))&&(c=Ia(c,"onBeforeInput"),0<c.length&&(u=new fp("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=N))}wy(f,e)})}function $s(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ia(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Us(t,n),s!=null&&r.unshift($s(t,s,i)),s=Us(t,e),s!=null&&r.push($s(t,s,i))),t=t.return}return r}function Or(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function wp(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Us(n,s),l!=null&&o.unshift($s(n,l,a))):i||(l=Us(n,s),l!=null&&o.push($s(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var $S=/\r\n?/g,XS=/\u0000|\uFFFD/g;function Ap(t){return(typeof t=="string"?t:""+t).replace($S,`
`).replace(XS,"")}function Lo(t,e,n){if(e=Ap(e),Ap(t)!==e&&n)throw Error(F(425))}function Ma(){}var Yu=null,Ku=null;function qu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zu=typeof setTimeout=="function"?setTimeout:void 0,YS=typeof clearTimeout=="function"?clearTimeout:void 0,Rp=typeof Promise=="function"?Promise:void 0,KS=typeof queueMicrotask=="function"?queueMicrotask:typeof Rp<"u"?function(t){return Rp.resolve(null).then(t).catch(qS)}:Zu;function qS(t){setTimeout(function(){throw t})}function Bc(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),zs(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);zs(e)}function Fn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function bp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Li=Math.random().toString(36).slice(2),zt="__reactFiber$"+Li,Xs="__reactProps$"+Li,ln="__reactContainer$"+Li,Qu="__reactEvents$"+Li,ZS="__reactListeners$"+Li,QS="__reactHandles$"+Li;function sr(t){var e=t[zt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ln]||n[zt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=bp(t);t!==null;){if(n=t[zt])return n;t=bp(t)}return e}t=n,n=t.parentNode}return null}function co(t){return t=t[zt]||t[ln],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Kr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(F(33))}function Wl(t){return t[Xs]||null}var Ju=[],qr=-1;function Xn(t){return{current:t}}function le(t){0>qr||(t.current=Ju[qr],Ju[qr]=null,qr--)}function ie(t,e){qr++,Ju[qr]=t.current,t.current=e}var jn={},Ve=Xn(jn),Ze=Xn(!1),mr=jn;function Ei(t,e){var n=t.type.contextTypes;if(!n)return jn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Qe(t){return t=t.childContextTypes,t!=null}function Na(){le(Ze),le(Ve)}function Cp(t,e,n){if(Ve.current!==jn)throw Error(F(168));ie(Ve,e),ie(Ze,n)}function Ry(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(F(108,FE(t)||"Unknown",i));return _e({},n,r)}function ka(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||jn,mr=Ve.current,ie(Ve,t),ie(Ze,Ze.current),!0}function Pp(t,e,n){var r=t.stateNode;if(!r)throw Error(F(169));n?(t=Ry(t,e,mr),r.__reactInternalMemoizedMergedChildContext=t,le(Ze),le(Ve),ie(Ve,t)):le(Ze),ie(Ze,n)}var en=null,$l=!1,Uc=!1;function by(t){en===null?en=[t]:en.push(t)}function JS(t){$l=!0,by(t)}function Yn(){if(!Uc&&en!==null){Uc=!0;var t=0,e=G;try{var n=en;for(G=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}en=null,$l=!1}catch(i){throw en!==null&&(en=en.slice(t+1)),Qm(wh,Yn),i}finally{G=e,Uc=!1}}return null}var Zr=[],Qr=0,Oa=null,Fa=0,ut=[],ft=0,yr=null,nn=1,rn="";function Gn(t,e){Zr[Qr++]=Fa,Zr[Qr++]=Oa,Oa=t,Fa=e}function Cy(t,e,n){ut[ft++]=nn,ut[ft++]=rn,ut[ft++]=yr,yr=t;var r=nn;t=rn;var i=32-Ct(r)-1;r&=~(1<<i),n+=1;var s=32-Ct(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,nn=1<<32-Ct(e)+i|n<<i|r,rn=s+t}else nn=1<<s|n<<i|r,rn=t}function Nh(t){t.return!==null&&(Gn(t,1),Cy(t,1,0))}function kh(t){for(;t===Oa;)Oa=Zr[--Qr],Zr[Qr]=null,Fa=Zr[--Qr],Zr[Qr]=null;for(;t===yr;)yr=ut[--ft],ut[ft]=null,rn=ut[--ft],ut[ft]=null,nn=ut[--ft],ut[ft]=null}var rt=null,nt=null,ue=!1,At=null;function Py(t,e){var n=ht(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function xp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,rt=t,nt=Fn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,rt=t,nt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=yr!==null?{id:nn,overflow:rn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ht(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,rt=t,nt=null,!0):!1;default:return!1}}function Gu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ef(t){if(ue){var e=nt;if(e){var n=e;if(!xp(t,e)){if(Gu(t))throw Error(F(418));e=Fn(n.nextSibling);var r=rt;e&&xp(t,e)?Py(r,n):(t.flags=t.flags&-4097|2,ue=!1,rt=t)}}else{if(Gu(t))throw Error(F(418));t.flags=t.flags&-4097|2,ue=!1,rt=t}}}function Ip(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;rt=t}function Vo(t){if(t!==rt)return!1;if(!ue)return Ip(t),ue=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!qu(t.type,t.memoizedProps)),e&&(e=nt)){if(Gu(t))throw xy(),Error(F(418));for(;e;)Py(t,e),e=Fn(e.nextSibling)}if(Ip(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(F(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){nt=Fn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}nt=null}}else nt=rt?Fn(t.stateNode.nextSibling):null;return!0}function xy(){for(var t=nt;t;)t=Fn(t.nextSibling)}function Si(){nt=rt=null,ue=!1}function Oh(t){At===null?At=[t]:At.push(t)}var GS=hn.ReactCurrentBatchConfig;function ts(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(F(309));var r=n.stateNode}if(!r)throw Error(F(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(F(284));if(!n._owner)throw Error(F(290,t))}return t}function zo(t,e){throw t=Object.prototype.toString.call(e),Error(F(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mp(t){var e=t._init;return e(t._payload)}function Iy(t){function e(m,p){if(t){var E=m.deletions;E===null?(m.deletions=[p],m.flags|=16):E.push(p)}}function n(m,p){if(!t)return null;for(;p!==null;)e(m,p),p=p.sibling;return null}function r(m,p){for(m=new Map;p!==null;)p.key!==null?m.set(p.key,p):m.set(p.index,p),p=p.sibling;return m}function i(m,p){return m=Ln(m,p),m.index=0,m.sibling=null,m}function s(m,p,E){return m.index=E,t?(E=m.alternate,E!==null?(E=E.index,E<p?(m.flags|=2,p):E):(m.flags|=2,p)):(m.flags|=1048576,p)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,p,E,A){return p===null||p.tag!==6?(p=$c(E,m.mode,A),p.return=m,p):(p=i(p,E),p.return=m,p)}function l(m,p,E,A){var x=E.type;return x===Wr?u(m,p,E.props.children,A,E.key):p!==null&&(p.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===En&&Mp(x)===p.type)?(A=i(p,E.props),A.ref=ts(m,p,E),A.return=m,A):(A=va(E.type,E.key,E.props,null,m.mode,A),A.ref=ts(m,p,E),A.return=m,A)}function c(m,p,E,A){return p===null||p.tag!==4||p.stateNode.containerInfo!==E.containerInfo||p.stateNode.implementation!==E.implementation?(p=Xc(E,m.mode,A),p.return=m,p):(p=i(p,E.children||[]),p.return=m,p)}function u(m,p,E,A,x){return p===null||p.tag!==7?(p=hr(E,m.mode,A,x),p.return=m,p):(p=i(p,E),p.return=m,p)}function f(m,p,E){if(typeof p=="string"&&p!==""||typeof p=="number")return p=$c(""+p,m.mode,E),p.return=m,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Io:return E=va(p.type,p.key,p.props,null,m.mode,E),E.ref=ts(m,null,p),E.return=m,E;case Hr:return p=Xc(p,m.mode,E),p.return=m,p;case En:var A=p._init;return f(m,A(p._payload),E)}if(hs(p)||Zi(p))return p=hr(p,m.mode,E,null),p.return=m,p;zo(m,p)}return null}function h(m,p,E,A){var x=p!==null?p.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return x!==null?null:a(m,p,""+E,A);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Io:return E.key===x?l(m,p,E,A):null;case Hr:return E.key===x?c(m,p,E,A):null;case En:return x=E._init,h(m,p,x(E._payload),A)}if(hs(E)||Zi(E))return x!==null?null:u(m,p,E,A,null);zo(m,E)}return null}function _(m,p,E,A,x){if(typeof A=="string"&&A!==""||typeof A=="number")return m=m.get(E)||null,a(p,m,""+A,x);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Io:return m=m.get(A.key===null?E:A.key)||null,l(p,m,A,x);case Hr:return m=m.get(A.key===null?E:A.key)||null,c(p,m,A,x);case En:var M=A._init;return _(m,p,E,M(A._payload),x)}if(hs(A)||Zi(A))return m=m.get(E)||null,u(p,m,A,x,null);zo(p,A)}return null}function y(m,p,E,A){for(var x=null,M=null,N=p,D=p=0,L=null;N!==null&&D<E.length;D++){N.index>D?(L=N,N=null):L=N.sibling;var U=h(m,N,E[D],A);if(U===null){N===null&&(N=L);break}t&&N&&U.alternate===null&&e(m,N),p=s(U,p,D),M===null?x=U:M.sibling=U,M=U,N=L}if(D===E.length)return n(m,N),ue&&Gn(m,D),x;if(N===null){for(;D<E.length;D++)N=f(m,E[D],A),N!==null&&(p=s(N,p,D),M===null?x=N:M.sibling=N,M=N);return ue&&Gn(m,D),x}for(N=r(m,N);D<E.length;D++)L=_(N,m,D,E[D],A),L!==null&&(t&&L.alternate!==null&&N.delete(L.key===null?D:L.key),p=s(L,p,D),M===null?x=L:M.sibling=L,M=L);return t&&N.forEach(function(H){return e(m,H)}),ue&&Gn(m,D),x}function S(m,p,E,A){var x=Zi(E);if(typeof x!="function")throw Error(F(150));if(E=x.call(E),E==null)throw Error(F(151));for(var M=x=null,N=p,D=p=0,L=null,U=E.next();N!==null&&!U.done;D++,U=E.next()){N.index>D?(L=N,N=null):L=N.sibling;var H=h(m,N,U.value,A);if(H===null){N===null&&(N=L);break}t&&N&&H.alternate===null&&e(m,N),p=s(H,p,D),M===null?x=H:M.sibling=H,M=H,N=L}if(U.done)return n(m,N),ue&&Gn(m,D),x;if(N===null){for(;!U.done;D++,U=E.next())U=f(m,U.value,A),U!==null&&(p=s(U,p,D),M===null?x=U:M.sibling=U,M=U);return ue&&Gn(m,D),x}for(N=r(m,N);!U.done;D++,U=E.next())U=_(N,m,D,U.value,A),U!==null&&(t&&U.alternate!==null&&N.delete(U.key===null?D:U.key),p=s(U,p,D),M===null?x=U:M.sibling=U,M=U);return t&&N.forEach(function(Q){return e(m,Q)}),ue&&Gn(m,D),x}function C(m,p,E,A){if(typeof E=="object"&&E!==null&&E.type===Wr&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Io:e:{for(var x=E.key,M=p;M!==null;){if(M.key===x){if(x=E.type,x===Wr){if(M.tag===7){n(m,M.sibling),p=i(M,E.props.children),p.return=m,m=p;break e}}else if(M.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===En&&Mp(x)===M.type){n(m,M.sibling),p=i(M,E.props),p.ref=ts(m,M,E),p.return=m,m=p;break e}n(m,M);break}else e(m,M);M=M.sibling}E.type===Wr?(p=hr(E.props.children,m.mode,A,E.key),p.return=m,m=p):(A=va(E.type,E.key,E.props,null,m.mode,A),A.ref=ts(m,p,E),A.return=m,m=A)}return o(m);case Hr:e:{for(M=E.key;p!==null;){if(p.key===M)if(p.tag===4&&p.stateNode.containerInfo===E.containerInfo&&p.stateNode.implementation===E.implementation){n(m,p.sibling),p=i(p,E.children||[]),p.return=m,m=p;break e}else{n(m,p);break}else e(m,p);p=p.sibling}p=Xc(E,m.mode,A),p.return=m,m=p}return o(m);case En:return M=E._init,C(m,p,M(E._payload),A)}if(hs(E))return y(m,p,E,A);if(Zi(E))return S(m,p,E,A);zo(m,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,p!==null&&p.tag===6?(n(m,p.sibling),p=i(p,E),p.return=m,m=p):(n(m,p),p=$c(E,m.mode,A),p.return=m,m=p),o(m)):n(m,p)}return C}var wi=Iy(!0),My=Iy(!1),Da=Xn(null),Ba=null,Jr=null,Fh=null;function Dh(){Fh=Jr=Ba=null}function Bh(t){var e=Da.current;le(Da),t._currentValue=e}function tf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function hi(t,e){Ba=t,Fh=Jr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qe=!0),t.firstContext=null)}function mt(t){var e=t._currentValue;if(Fh!==t)if(t={context:t,memoizedValue:e,next:null},Jr===null){if(Ba===null)throw Error(F(308));Jr=t,Ba.dependencies={lanes:0,firstContext:t}}else Jr=Jr.next=t;return e}var or=null;function Uh(t){or===null?or=[t]:or.push(t)}function Ny(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Uh(e)):(n.next=i.next,i.next=n),e.interleaved=n,cn(t,r)}function cn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Sn=!1;function Lh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ky(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function on(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Dn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Z&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,cn(t,n)}return i=r.interleaved,i===null?(e.next=e,Uh(r)):(e.next=i.next,i.next=e),r.interleaved=e,cn(t,n)}function da(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ah(t,n)}}function Np(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ua(t,e,n,r){var i=t.updateQueue;Sn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,_=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,S=a;switch(h=e,_=n,S.tag){case 1:if(y=S.payload,typeof y=="function"){f=y.call(_,f,h);break e}f=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=S.payload,h=typeof y=="function"?y.call(_,f,h):y,h==null)break e;f=_e({},f,h);break e;case 2:Sn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else _={eventTime:_,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=_,l=f):u=u.next=_,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Tr|=o,t.lanes=o,t.memoizedState=f}}function kp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(F(191,i));i.call(r)}}}var uo={},Xt=Xn(uo),Ys=Xn(uo),Ks=Xn(uo);function ar(t){if(t===uo)throw Error(F(174));return t}function Vh(t,e){switch(ie(Ks,e),ie(Ys,t),ie(Xt,uo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Fu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Fu(e,t)}le(Xt),ie(Xt,e)}function Ai(){le(Xt),le(Ys),le(Ks)}function Oy(t){ar(Ks.current);var e=ar(Xt.current),n=Fu(e,t.type);e!==n&&(ie(Ys,t),ie(Xt,n))}function zh(t){Ys.current===t&&(le(Xt),le(Ys))}var pe=Xn(0);function La(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Lc=[];function jh(){for(var t=0;t<Lc.length;t++)Lc[t]._workInProgressVersionPrimary=null;Lc.length=0}var pa=hn.ReactCurrentDispatcher,Vc=hn.ReactCurrentBatchConfig,vr=0,ge=null,Ae=null,Pe=null,Va=!1,As=!1,qs=0,ew=0;function De(){throw Error(F(321))}function Hh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!xt(t[n],e[n]))return!1;return!0}function Wh(t,e,n,r,i,s){if(vr=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,pa.current=t===null||t.memoizedState===null?iw:sw,t=n(r,i),As){s=0;do{if(As=!1,qs=0,25<=s)throw Error(F(301));s+=1,Pe=Ae=null,e.updateQueue=null,pa.current=ow,t=n(r,i)}while(As)}if(pa.current=za,e=Ae!==null&&Ae.next!==null,vr=0,Pe=Ae=ge=null,Va=!1,e)throw Error(F(300));return t}function $h(){var t=qs!==0;return qs=0,t}function Vt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pe===null?ge.memoizedState=Pe=t:Pe=Pe.next=t,Pe}function yt(){if(Ae===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=Ae.next;var e=Pe===null?ge.memoizedState:Pe.next;if(e!==null)Pe=e,Ae=t;else{if(t===null)throw Error(F(310));Ae=t,t={memoizedState:Ae.memoizedState,baseState:Ae.baseState,baseQueue:Ae.baseQueue,queue:Ae.queue,next:null},Pe===null?ge.memoizedState=Pe=t:Pe=Pe.next=t}return Pe}function Zs(t,e){return typeof e=="function"?e(t):e}function zc(t){var e=yt(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var r=Ae,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((vr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,ge.lanes|=u,Tr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,xt(r,e.memoizedState)||(qe=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ge.lanes|=s,Tr|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function jc(t){var e=yt(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);xt(s,e.memoizedState)||(qe=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Fy(){}function Dy(t,e){var n=ge,r=yt(),i=e(),s=!xt(r.memoizedState,i);if(s&&(r.memoizedState=i,qe=!0),r=r.queue,Xh(Ly.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Pe!==null&&Pe.memoizedState.tag&1){if(n.flags|=2048,Qs(9,Uy.bind(null,n,r,i,e),void 0,null),xe===null)throw Error(F(349));vr&30||By(n,e,i)}return i}function By(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Uy(t,e,n,r){e.value=n,e.getSnapshot=r,Vy(e)&&zy(t)}function Ly(t,e,n){return n(function(){Vy(e)&&zy(t)})}function Vy(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!xt(t,n)}catch{return!0}}function zy(t){var e=cn(t,1);e!==null&&Pt(e,t,1,-1)}function Op(t){var e=Vt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:t},e.queue=t,t=t.dispatch=rw.bind(null,ge,t),[e.memoizedState,t]}function Qs(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function jy(){return yt().memoizedState}function ga(t,e,n,r){var i=Vt();ge.flags|=t,i.memoizedState=Qs(1|e,n,void 0,r===void 0?null:r)}function Xl(t,e,n,r){var i=yt();r=r===void 0?null:r;var s=void 0;if(Ae!==null){var o=Ae.memoizedState;if(s=o.destroy,r!==null&&Hh(r,o.deps)){i.memoizedState=Qs(e,n,s,r);return}}ge.flags|=t,i.memoizedState=Qs(1|e,n,s,r)}function Fp(t,e){return ga(8390656,8,t,e)}function Xh(t,e){return Xl(2048,8,t,e)}function Hy(t,e){return Xl(4,2,t,e)}function Wy(t,e){return Xl(4,4,t,e)}function $y(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Xy(t,e,n){return n=n!=null?n.concat([t]):null,Xl(4,4,$y.bind(null,e,t),n)}function Yh(){}function Yy(t,e){var n=yt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Hh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Ky(t,e){var n=yt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Hh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function qy(t,e,n){return vr&21?(xt(n,e)||(n=ey(),ge.lanes|=n,Tr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qe=!0),t.memoizedState=n)}function tw(t,e){var n=G;G=n!==0&&4>n?n:4,t(!0);var r=Vc.transition;Vc.transition={};try{t(!1),e()}finally{G=n,Vc.transition=r}}function Zy(){return yt().memoizedState}function nw(t,e,n){var r=Un(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qy(t))Jy(e,n);else if(n=Ny(t,e,n,r),n!==null){var i=We();Pt(n,t,r,i),Gy(n,e,r)}}function rw(t,e,n){var r=Un(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qy(t))Jy(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,xt(a,o)){var l=e.interleaved;l===null?(i.next=i,Uh(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=Ny(t,e,i,r),n!==null&&(i=We(),Pt(n,t,r,i),Gy(n,e,r))}}function Qy(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function Jy(t,e){As=Va=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Gy(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ah(t,n)}}var za={readContext:mt,useCallback:De,useContext:De,useEffect:De,useImperativeHandle:De,useInsertionEffect:De,useLayoutEffect:De,useMemo:De,useReducer:De,useRef:De,useState:De,useDebugValue:De,useDeferredValue:De,useTransition:De,useMutableSource:De,useSyncExternalStore:De,useId:De,unstable_isNewReconciler:!1},iw={readContext:mt,useCallback:function(t,e){return Vt().memoizedState=[t,e===void 0?null:e],t},useContext:mt,useEffect:Fp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ga(4194308,4,$y.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ga(4194308,4,t,e)},useInsertionEffect:function(t,e){return ga(4,2,t,e)},useMemo:function(t,e){var n=Vt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Vt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=nw.bind(null,ge,t),[r.memoizedState,t]},useRef:function(t){var e=Vt();return t={current:t},e.memoizedState=t},useState:Op,useDebugValue:Yh,useDeferredValue:function(t){return Vt().memoizedState=t},useTransition:function(){var t=Op(!1),e=t[0];return t=tw.bind(null,t[1]),Vt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ge,i=Vt();if(ue){if(n===void 0)throw Error(F(407));n=n()}else{if(n=e(),xe===null)throw Error(F(349));vr&30||By(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Fp(Ly.bind(null,r,s,t),[t]),r.flags|=2048,Qs(9,Uy.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Vt(),e=xe.identifierPrefix;if(ue){var n=rn,r=nn;n=(r&~(1<<32-Ct(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=qs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ew++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},sw={readContext:mt,useCallback:Yy,useContext:mt,useEffect:Xh,useImperativeHandle:Xy,useInsertionEffect:Hy,useLayoutEffect:Wy,useMemo:Ky,useReducer:zc,useRef:jy,useState:function(){return zc(Zs)},useDebugValue:Yh,useDeferredValue:function(t){var e=yt();return qy(e,Ae.memoizedState,t)},useTransition:function(){var t=zc(Zs)[0],e=yt().memoizedState;return[t,e]},useMutableSource:Fy,useSyncExternalStore:Dy,useId:Zy,unstable_isNewReconciler:!1},ow={readContext:mt,useCallback:Yy,useContext:mt,useEffect:Xh,useImperativeHandle:Xy,useInsertionEffect:Hy,useLayoutEffect:Wy,useMemo:Ky,useReducer:jc,useRef:jy,useState:function(){return jc(Zs)},useDebugValue:Yh,useDeferredValue:function(t){var e=yt();return Ae===null?e.memoizedState=t:qy(e,Ae.memoizedState,t)},useTransition:function(){var t=jc(Zs)[0],e=yt().memoizedState;return[t,e]},useMutableSource:Fy,useSyncExternalStore:Dy,useId:Zy,unstable_isNewReconciler:!1};function St(t,e){if(t&&t.defaultProps){e=_e({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function nf(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:_e({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Yl={isMounted:function(t){return(t=t._reactInternals)?Rr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=We(),i=Un(t),s=on(r,i);s.payload=e,n!=null&&(s.callback=n),e=Dn(t,s,i),e!==null&&(Pt(e,t,i,r),da(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=We(),i=Un(t),s=on(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Dn(t,s,i),e!==null&&(Pt(e,t,i,r),da(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=We(),r=Un(t),i=on(n,r);i.tag=2,e!=null&&(i.callback=e),e=Dn(t,i,r),e!==null&&(Pt(e,t,r,n),da(e,t,r))}};function Dp(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Hs(n,r)||!Hs(i,s):!0}function e0(t,e,n){var r=!1,i=jn,s=e.contextType;return typeof s=="object"&&s!==null?s=mt(s):(i=Qe(e)?mr:Ve.current,r=e.contextTypes,s=(r=r!=null)?Ei(t,i):jn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yl,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Bp(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Yl.enqueueReplaceState(e,e.state,null)}function rf(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Lh(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=mt(s):(s=Qe(e)?mr:Ve.current,i.context=Ei(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(nf(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Yl.enqueueReplaceState(i,i.state,null),Ua(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ri(t,e){try{var n="",r=e;do n+=OE(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Hc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function sf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var aw=typeof WeakMap=="function"?WeakMap:Map;function t0(t,e,n){n=on(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ha||(Ha=!0,gf=r),sf(t,e)},n}function n0(t,e,n){n=on(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){sf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){sf(t,e),typeof r!="function"&&(Bn===null?Bn=new Set([this]):Bn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Up(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new aw;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=Ew.bind(null,t,e,n),e.then(t,t))}function Lp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Vp(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=on(-1,1),e.tag=2,Dn(n,e,1))),n.lanes|=1),t)}var lw=hn.ReactCurrentOwner,qe=!1;function je(t,e,n,r){e.child=t===null?My(e,null,n,r):wi(e,t.child,n,r)}function zp(t,e,n,r,i){n=n.render;var s=e.ref;return hi(e,i),r=Wh(t,e,n,r,s,i),n=$h(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,un(t,e,i)):(ue&&n&&Nh(e),e.flags|=1,je(t,e,r,i),e.child)}function jp(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!td(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,r0(t,e,s,r,i)):(t=va(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Hs,n(o,r)&&t.ref===e.ref)return un(t,e,i)}return e.flags|=1,t=Ln(s,r),t.ref=e.ref,t.return=e,e.child=t}function r0(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Hs(s,r)&&t.ref===e.ref)if(qe=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(qe=!0);else return e.lanes=t.lanes,un(t,e,i)}return of(t,e,n,r,i)}function i0(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ie(ei,et),et|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ie(ei,et),et|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ie(ei,et),et|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ie(ei,et),et|=r;return je(t,e,i,n),e.child}function s0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function of(t,e,n,r,i){var s=Qe(n)?mr:Ve.current;return s=Ei(e,s),hi(e,i),n=Wh(t,e,n,r,s,i),r=$h(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,un(t,e,i)):(ue&&r&&Nh(e),e.flags|=1,je(t,e,n,i),e.child)}function Hp(t,e,n,r,i){if(Qe(n)){var s=!0;ka(e)}else s=!1;if(hi(e,i),e.stateNode===null)_a(t,e),e0(e,n,r),rf(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=mt(c):(c=Qe(n)?mr:Ve.current,c=Ei(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Bp(e,o,r,c),Sn=!1;var h=e.memoizedState;o.state=h,Ua(e,r,o,i),l=e.memoizedState,a!==r||h!==l||Ze.current||Sn?(typeof u=="function"&&(nf(e,n,u,r),l=e.memoizedState),(a=Sn||Dp(e,n,a,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,ky(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:St(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=mt(l):(l=Qe(n)?mr:Ve.current,l=Ei(e,l));var _=n.getDerivedStateFromProps;(u=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Bp(e,o,r,l),Sn=!1,h=e.memoizedState,o.state=h,Ua(e,r,o,i);var y=e.memoizedState;a!==f||h!==y||Ze.current||Sn?(typeof _=="function"&&(nf(e,n,_,r),y=e.memoizedState),(c=Sn||Dp(e,n,c,r,h,y,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),o.props=r,o.state=y,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return af(t,e,n,r,s,i)}function af(t,e,n,r,i,s){s0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Pp(e,n,!1),un(t,e,s);r=e.stateNode,lw.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=wi(e,t.child,null,s),e.child=wi(e,null,a,s)):je(t,e,a,s),e.memoizedState=r.state,i&&Pp(e,n,!0),e.child}function o0(t){var e=t.stateNode;e.pendingContext?Cp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Cp(t,e.context,!1),Vh(t,e.containerInfo)}function Wp(t,e,n,r,i){return Si(),Oh(i),e.flags|=256,je(t,e,n,r),e.child}var lf={dehydrated:null,treeContext:null,retryLane:0};function cf(t){return{baseLanes:t,cachePool:null,transitions:null}}function a0(t,e,n){var r=e.pendingProps,i=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ie(pe,i&1),t===null)return ef(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Zl(o,r,0,null),t=hr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=cf(n),e.memoizedState=lf,t):Kh(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return cw(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Ln(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Ln(a,s):(s=hr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?cf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=lf,r}return s=t.child,t=s.sibling,r=Ln(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Kh(t,e){return e=Zl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function jo(t,e,n,r){return r!==null&&Oh(r),wi(e,t.child,null,n),t=Kh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function cw(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Hc(Error(F(422))),jo(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Zl({mode:"visible",children:r.children},i,0,null),s=hr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&wi(e,t.child,null,o),e.child.memoizedState=cf(o),e.memoizedState=lf,s);if(!(e.mode&1))return jo(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(F(419)),r=Hc(s,r,void 0),jo(t,e,o,r)}if(a=(o&t.childLanes)!==0,qe||a){if(r=xe,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,cn(t,i),Pt(r,t,i,-1))}return ed(),r=Hc(Error(F(421))),jo(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Sw.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,nt=Fn(i.nextSibling),rt=e,ue=!0,At=null,t!==null&&(ut[ft++]=nn,ut[ft++]=rn,ut[ft++]=yr,nn=t.id,rn=t.overflow,yr=e),e=Kh(e,r.children),e.flags|=4096,e)}function $p(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),tf(t.return,e,n)}function Wc(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function l0(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(je(t,e,r.children,n),r=pe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$p(t,n,e);else if(t.tag===19)$p(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ie(pe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&La(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Wc(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&La(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Wc(e,!0,n,null,s);break;case"together":Wc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _a(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function un(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Tr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(F(153));if(e.child!==null){for(t=e.child,n=Ln(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ln(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function uw(t,e,n){switch(e.tag){case 3:o0(e),Si();break;case 5:Oy(e);break;case 1:Qe(e.type)&&ka(e);break;case 4:Vh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ie(Da,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ie(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?a0(t,e,n):(ie(pe,pe.current&1),t=un(t,e,n),t!==null?t.sibling:null);ie(pe,pe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return l0(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ie(pe,pe.current),r)break;return null;case 22:case 23:return e.lanes=0,i0(t,e,n)}return un(t,e,n)}var c0,uf,u0,f0;c0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};uf=function(){};u0=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ar(Xt.current);var s=null;switch(n){case"input":i=Mu(t,i),r=Mu(t,r),s=[];break;case"select":i=_e({},i,{value:void 0}),r=_e({},r,{value:void 0}),s=[];break;case"textarea":i=Ou(t,i),r=Ou(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ma)}Du(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ds.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ds.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ae("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};f0=function(t,e,n,r){n!==r&&(e.flags|=4)};function ns(t,e){if(!ue)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Be(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function fw(t,e,n){var r=e.pendingProps;switch(kh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Be(e),null;case 1:return Qe(e.type)&&Na(),Be(e),null;case 3:return r=e.stateNode,Ai(),le(Ze),le(Ve),jh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Vo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,At!==null&&(yf(At),At=null))),uf(t,e),Be(e),null;case 5:zh(e);var i=ar(Ks.current);if(n=e.type,t!==null&&e.stateNode!=null)u0(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(F(166));return Be(e),null}if(t=ar(Xt.current),Vo(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[zt]=e,r[Xs]=s,t=(e.mode&1)!==0,n){case"dialog":ae("cancel",r),ae("close",r);break;case"iframe":case"object":case"embed":ae("load",r);break;case"video":case"audio":for(i=0;i<ps.length;i++)ae(ps[i],r);break;case"source":ae("error",r);break;case"img":case"image":case"link":ae("error",r),ae("load",r);break;case"details":ae("toggle",r);break;case"input":ep(r,s),ae("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ae("invalid",r);break;case"textarea":np(r,s),ae("invalid",r)}Du(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Lo(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Lo(r.textContent,a,t),i=["children",""+a]):Ds.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ae("scroll",r)}switch(n){case"input":Mo(r),tp(r,s,!0);break;case"textarea":Mo(r),rp(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Ma)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Lm(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[zt]=e,t[Xs]=r,c0(t,e,!1,!1),e.stateNode=t;e:{switch(o=Bu(n,r),n){case"dialog":ae("cancel",t),ae("close",t),i=r;break;case"iframe":case"object":case"embed":ae("load",t),i=r;break;case"video":case"audio":for(i=0;i<ps.length;i++)ae(ps[i],t);i=r;break;case"source":ae("error",t),i=r;break;case"img":case"image":case"link":ae("error",t),ae("load",t),i=r;break;case"details":ae("toggle",t),i=r;break;case"input":ep(t,r),i=Mu(t,r),ae("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=_e({},r,{value:void 0}),ae("invalid",t);break;case"textarea":np(t,r),i=Ou(t,r),ae("invalid",t);break;default:i=r}Du(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?jm(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Vm(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Bs(t,l):typeof l=="number"&&Bs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ds.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ae("scroll",t):l!=null&&yh(t,s,l,o))}switch(n){case"input":Mo(t),tp(t,r,!1);break;case"textarea":Mo(t),rp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+zn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?li(t,!!r.multiple,s,!1):r.defaultValue!=null&&li(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ma)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Be(e),null;case 6:if(t&&e.stateNode!=null)f0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(F(166));if(n=ar(Ks.current),ar(Xt.current),Vo(e)){if(r=e.stateNode,n=e.memoizedProps,r[zt]=e,(s=r.nodeValue!==n)&&(t=rt,t!==null))switch(t.tag){case 3:Lo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Lo(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[zt]=e,e.stateNode=r}return Be(e),null;case 13:if(le(pe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ue&&nt!==null&&e.mode&1&&!(e.flags&128))xy(),Si(),e.flags|=98560,s=!1;else if(s=Vo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(F(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(F(317));s[zt]=e}else Si(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Be(e),s=!1}else At!==null&&(yf(At),At=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Re===0&&(Re=3):ed())),e.updateQueue!==null&&(e.flags|=4),Be(e),null);case 4:return Ai(),uf(t,e),t===null&&Ws(e.stateNode.containerInfo),Be(e),null;case 10:return Bh(e.type._context),Be(e),null;case 17:return Qe(e.type)&&Na(),Be(e),null;case 19:if(le(pe),s=e.memoizedState,s===null)return Be(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ns(s,!1);else{if(Re!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=La(t),o!==null){for(e.flags|=128,ns(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ie(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&ve()>bi&&(e.flags|=128,r=!0,ns(s,!1),e.lanes=4194304)}else{if(!r)if(t=La(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ns(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ue)return Be(e),null}else 2*ve()-s.renderingStartTime>bi&&n!==1073741824&&(e.flags|=128,r=!0,ns(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ve(),e.sibling=null,n=pe.current,ie(pe,r?n&1|2:n&1),e):(Be(e),null);case 22:case 23:return Gh(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?et&1073741824&&(Be(e),e.subtreeFlags&6&&(e.flags|=8192)):Be(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function hw(t,e){switch(kh(e),e.tag){case 1:return Qe(e.type)&&Na(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ai(),le(Ze),le(Ve),jh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zh(e),null;case 13:if(le(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(F(340));Si()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return le(pe),null;case 4:return Ai(),null;case 10:return Bh(e.type._context),null;case 22:case 23:return Gh(),null;case 24:return null;default:return null}}var Ho=!1,Le=!1,dw=typeof WeakSet=="function"?WeakSet:Set,j=null;function Gr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ye(t,e,r)}else n.current=null}function ff(t,e,n){try{n()}catch(r){ye(t,e,r)}}var Xp=!1;function pw(t,e){if(Yu=Pa,t=_y(),Mh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var _;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(_=f.firstChild)!==null;)h=f,f=_;for(;;){if(f===t)break t;if(h===n&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(_=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=_}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ku={focusedElem:t,selectionRange:n},Pa=!1,j=e;j!==null;)if(e=j,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,j=t;else for(;j!==null;){e=j;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var S=y.memoizedProps,C=y.memoizedState,m=e.stateNode,p=m.getSnapshotBeforeUpdate(e.elementType===e.type?S:St(e.type,S),C);m.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(A){ye(e,e.return,A)}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}return y=Xp,Xp=!1,y}function Rs(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&ff(e,n,s)}i=i.next}while(i!==r)}}function Kl(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function hf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function h0(t){var e=t.alternate;e!==null&&(t.alternate=null,h0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[zt],delete e[Xs],delete e[Qu],delete e[ZS],delete e[QS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function d0(t){return t.tag===5||t.tag===3||t.tag===4}function Yp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||d0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function df(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ma));else if(r!==4&&(t=t.child,t!==null))for(df(t,e,n),t=t.sibling;t!==null;)df(t,e,n),t=t.sibling}function pf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(pf(t,e,n),t=t.sibling;t!==null;)pf(t,e,n),t=t.sibling}var Ne=null,wt=!1;function _n(t,e,n){for(n=n.child;n!==null;)p0(t,e,n),n=n.sibling}function p0(t,e,n){if($t&&typeof $t.onCommitFiberUnmount=="function")try{$t.onCommitFiberUnmount(Vl,n)}catch{}switch(n.tag){case 5:Le||Gr(n,e);case 6:var r=Ne,i=wt;Ne=null,_n(t,e,n),Ne=r,wt=i,Ne!==null&&(wt?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(wt?(t=Ne,n=n.stateNode,t.nodeType===8?Bc(t.parentNode,n):t.nodeType===1&&Bc(t,n),zs(t)):Bc(Ne,n.stateNode));break;case 4:r=Ne,i=wt,Ne=n.stateNode.containerInfo,wt=!0,_n(t,e,n),Ne=r,wt=i;break;case 0:case 11:case 14:case 15:if(!Le&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ff(n,e,o),i=i.next}while(i!==r)}_n(t,e,n);break;case 1:if(!Le&&(Gr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ye(n,e,a)}_n(t,e,n);break;case 21:_n(t,e,n);break;case 22:n.mode&1?(Le=(r=Le)||n.memoizedState!==null,_n(t,e,n),Le=r):_n(t,e,n);break;default:_n(t,e,n)}}function Kp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new dw),e.forEach(function(r){var i=ww.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Et(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ne=a.stateNode,wt=!1;break e;case 3:Ne=a.stateNode.containerInfo,wt=!0;break e;case 4:Ne=a.stateNode.containerInfo,wt=!0;break e}a=a.return}if(Ne===null)throw Error(F(160));p0(s,o,i),Ne=null,wt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ye(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)g0(e,t),e=e.sibling}function g0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Et(e,t),Ot(t),r&4){try{Rs(3,t,t.return),Kl(3,t)}catch(S){ye(t,t.return,S)}try{Rs(5,t,t.return)}catch(S){ye(t,t.return,S)}}break;case 1:Et(e,t),Ot(t),r&512&&n!==null&&Gr(n,n.return);break;case 5:if(Et(e,t),Ot(t),r&512&&n!==null&&Gr(n,n.return),t.flags&32){var i=t.stateNode;try{Bs(i,"")}catch(S){ye(t,t.return,S)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Bm(i,s),Bu(a,o);var c=Bu(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?jm(i,f):u==="dangerouslySetInnerHTML"?Vm(i,f):u==="children"?Bs(i,f):yh(i,u,f,c)}switch(a){case"input":Nu(i,s);break;case"textarea":Um(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var _=s.value;_!=null?li(i,!!s.multiple,_,!1):h!==!!s.multiple&&(s.defaultValue!=null?li(i,!!s.multiple,s.defaultValue,!0):li(i,!!s.multiple,s.multiple?[]:"",!1))}i[Xs]=s}catch(S){ye(t,t.return,S)}}break;case 6:if(Et(e,t),Ot(t),r&4){if(t.stateNode===null)throw Error(F(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(S){ye(t,t.return,S)}}break;case 3:if(Et(e,t),Ot(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{zs(e.containerInfo)}catch(S){ye(t,t.return,S)}break;case 4:Et(e,t),Ot(t);break;case 13:Et(e,t),Ot(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Qh=ve())),r&4&&Kp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Le=(c=Le)||u,Et(e,t),Le=c):Et(e,t),Ot(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(j=t,u=t.child;u!==null;){for(f=j=u;j!==null;){switch(h=j,_=h.child,h.tag){case 0:case 11:case 14:case 15:Rs(4,h,h.return);break;case 1:Gr(h,h.return);var y=h.stateNode;if(typeof y.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(S){ye(r,n,S)}}break;case 5:Gr(h,h.return);break;case 22:if(h.memoizedState!==null){Zp(f);continue}}_!==null?(_.return=h,j=_):Zp(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=zm("display",o))}catch(S){ye(t,t.return,S)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(S){ye(t,t.return,S)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Et(e,t),Ot(t),r&4&&Kp(t);break;case 21:break;default:Et(e,t),Ot(t)}}function Ot(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(d0(n)){var r=n;break e}n=n.return}throw Error(F(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Bs(i,""),r.flags&=-33);var s=Yp(t);pf(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Yp(t);df(t,a,o);break;default:throw Error(F(161))}}catch(l){ye(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function gw(t,e,n){j=t,_0(t)}function _0(t,e,n){for(var r=(t.mode&1)!==0;j!==null;){var i=j,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Ho;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Le;a=Ho;var c=Le;if(Ho=o,(Le=l)&&!c)for(j=i;j!==null;)o=j,l=o.child,o.tag===22&&o.memoizedState!==null?Qp(i):l!==null?(l.return=o,j=l):Qp(i);for(;s!==null;)j=s,_0(s),s=s.sibling;j=i,Ho=a,Le=c}qp(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,j=s):qp(t)}}function qp(t){for(;j!==null;){var e=j;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Le||Kl(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Le)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:St(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&kp(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}kp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&zs(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}Le||e.flags&512&&hf(e)}catch(h){ye(e,e.return,h)}}if(e===t){j=null;break}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}}function Zp(t){for(;j!==null;){var e=j;if(e===t){j=null;break}var n=e.sibling;if(n!==null){n.return=e.return,j=n;break}j=e.return}}function Qp(t){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Kl(4,e)}catch(l){ye(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){ye(e,i,l)}}var s=e.return;try{hf(e)}catch(l){ye(e,s,l)}break;case 5:var o=e.return;try{hf(e)}catch(l){ye(e,o,l)}}}catch(l){ye(e,e.return,l)}if(e===t){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var _w=Math.ceil,ja=hn.ReactCurrentDispatcher,qh=hn.ReactCurrentOwner,pt=hn.ReactCurrentBatchConfig,Z=0,xe=null,we=null,Oe=0,et=0,ei=Xn(0),Re=0,Js=null,Tr=0,ql=0,Zh=0,bs=null,Ke=null,Qh=0,bi=1/0,Jt=null,Ha=!1,gf=null,Bn=null,Wo=!1,Pn=null,Wa=0,Cs=0,_f=null,ma=-1,ya=0;function We(){return Z&6?ve():ma!==-1?ma:ma=ve()}function Un(t){return t.mode&1?Z&2&&Oe!==0?Oe&-Oe:GS.transition!==null?(ya===0&&(ya=ey()),ya):(t=G,t!==0||(t=window.event,t=t===void 0?16:ay(t.type)),t):1}function Pt(t,e,n,r){if(50<Cs)throw Cs=0,_f=null,Error(F(185));ao(t,n,r),(!(Z&2)||t!==xe)&&(t===xe&&(!(Z&2)&&(ql|=n),Re===4&&bn(t,Oe)),Je(t,r),n===1&&Z===0&&!(e.mode&1)&&(bi=ve()+500,$l&&Yn()))}function Je(t,e){var n=t.callbackNode;GE(t,e);var r=Ca(t,t===xe?Oe:0);if(r===0)n!==null&&op(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&op(n),e===1)t.tag===0?JS(Jp.bind(null,t)):by(Jp.bind(null,t)),KS(function(){!(Z&6)&&Yn()}),n=null;else{switch(ty(r)){case 1:n=wh;break;case 4:n=Jm;break;case 16:n=ba;break;case 536870912:n=Gm;break;default:n=ba}n=A0(n,m0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function m0(t,e){if(ma=-1,ya=0,Z&6)throw Error(F(327));var n=t.callbackNode;if(di()&&t.callbackNode!==n)return null;var r=Ca(t,t===xe?Oe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=$a(t,r);else{e=r;var i=Z;Z|=2;var s=v0();(xe!==t||Oe!==e)&&(Jt=null,bi=ve()+500,fr(t,e));do try{vw();break}catch(a){y0(t,a)}while(!0);Dh(),ja.current=s,Z=i,we!==null?e=0:(xe=null,Oe=0,e=Re)}if(e!==0){if(e===2&&(i=ju(t),i!==0&&(r=i,e=mf(t,i))),e===1)throw n=Js,fr(t,0),bn(t,r),Je(t,ve()),n;if(e===6)bn(t,r);else{if(i=t.current.alternate,!(r&30)&&!mw(i)&&(e=$a(t,r),e===2&&(s=ju(t),s!==0&&(r=s,e=mf(t,s))),e===1))throw n=Js,fr(t,0),bn(t,r),Je(t,ve()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(F(345));case 2:er(t,Ke,Jt);break;case 3:if(bn(t,r),(r&130023424)===r&&(e=Qh+500-ve(),10<e)){if(Ca(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){We(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Zu(er.bind(null,t,Ke,Jt),e);break}er(t,Ke,Jt);break;case 4:if(bn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Ct(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=ve()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*_w(r/1960))-r,10<r){t.timeoutHandle=Zu(er.bind(null,t,Ke,Jt),r);break}er(t,Ke,Jt);break;case 5:er(t,Ke,Jt);break;default:throw Error(F(329))}}}return Je(t,ve()),t.callbackNode===n?m0.bind(null,t):null}function mf(t,e){var n=bs;return t.current.memoizedState.isDehydrated&&(fr(t,e).flags|=256),t=$a(t,e),t!==2&&(e=Ke,Ke=n,e!==null&&yf(e)),t}function yf(t){Ke===null?Ke=t:Ke.push.apply(Ke,t)}function mw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!xt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function bn(t,e){for(e&=~Zh,e&=~ql,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ct(e),r=1<<n;t[n]=-1,e&=~r}}function Jp(t){if(Z&6)throw Error(F(327));di();var e=Ca(t,0);if(!(e&1))return Je(t,ve()),null;var n=$a(t,e);if(t.tag!==0&&n===2){var r=ju(t);r!==0&&(e=r,n=mf(t,r))}if(n===1)throw n=Js,fr(t,0),bn(t,e),Je(t,ve()),n;if(n===6)throw Error(F(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,er(t,Ke,Jt),Je(t,ve()),null}function Jh(t,e){var n=Z;Z|=1;try{return t(e)}finally{Z=n,Z===0&&(bi=ve()+500,$l&&Yn())}}function Er(t){Pn!==null&&Pn.tag===0&&!(Z&6)&&di();var e=Z;Z|=1;var n=pt.transition,r=G;try{if(pt.transition=null,G=1,t)return t()}finally{G=r,pt.transition=n,Z=e,!(Z&6)&&Yn()}}function Gh(){et=ei.current,le(ei)}function fr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,YS(n)),we!==null)for(n=we.return;n!==null;){var r=n;switch(kh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Na();break;case 3:Ai(),le(Ze),le(Ve),jh();break;case 5:zh(r);break;case 4:Ai();break;case 13:le(pe);break;case 19:le(pe);break;case 10:Bh(r.type._context);break;case 22:case 23:Gh()}n=n.return}if(xe=t,we=t=Ln(t.current,null),Oe=et=e,Re=0,Js=null,Zh=ql=Tr=0,Ke=bs=null,or!==null){for(e=0;e<or.length;e++)if(n=or[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}or=null}return t}function y0(t,e){do{var n=we;try{if(Dh(),pa.current=za,Va){for(var r=ge.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Va=!1}if(vr=0,Pe=Ae=ge=null,As=!1,qs=0,qh.current=null,n===null||n.return===null){Re=1,Js=e,we=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Oe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var _=Lp(o);if(_!==null){_.flags&=-257,Vp(_,o,a,s,e),_.mode&1&&Up(s,c,e),e=_,l=c;var y=e.updateQueue;if(y===null){var S=new Set;S.add(l),e.updateQueue=S}else y.add(l);break e}else{if(!(e&1)){Up(s,c,e),ed();break e}l=Error(F(426))}}else if(ue&&a.mode&1){var C=Lp(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Vp(C,o,a,s,e),Oh(Ri(l,a));break e}}s=l=Ri(l,a),Re!==4&&(Re=2),bs===null?bs=[s]:bs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=t0(s,l,e);Np(s,m);break e;case 1:a=l;var p=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof p.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Bn===null||!Bn.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var A=n0(s,a,e);Np(s,A);break e}}s=s.return}while(s!==null)}E0(n)}catch(x){e=x,we===n&&n!==null&&(we=n=n.return);continue}break}while(!0)}function v0(){var t=ja.current;return ja.current=za,t===null?za:t}function ed(){(Re===0||Re===3||Re===2)&&(Re=4),xe===null||!(Tr&268435455)&&!(ql&268435455)||bn(xe,Oe)}function $a(t,e){var n=Z;Z|=2;var r=v0();(xe!==t||Oe!==e)&&(Jt=null,fr(t,e));do try{yw();break}catch(i){y0(t,i)}while(!0);if(Dh(),Z=n,ja.current=r,we!==null)throw Error(F(261));return xe=null,Oe=0,Re}function yw(){for(;we!==null;)T0(we)}function vw(){for(;we!==null&&!WE();)T0(we)}function T0(t){var e=w0(t.alternate,t,et);t.memoizedProps=t.pendingProps,e===null?E0(t):we=e,qh.current=null}function E0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=hw(n,e),n!==null){n.flags&=32767,we=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Re=6,we=null;return}}else if(n=fw(n,e,et),n!==null){we=n;return}if(e=e.sibling,e!==null){we=e;return}we=e=t}while(e!==null);Re===0&&(Re=5)}function er(t,e,n){var r=G,i=pt.transition;try{pt.transition=null,G=1,Tw(t,e,n,r)}finally{pt.transition=i,G=r}return null}function Tw(t,e,n,r){do di();while(Pn!==null);if(Z&6)throw Error(F(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(F(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(eS(t,s),t===xe&&(we=xe=null,Oe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Wo||(Wo=!0,A0(ba,function(){return di(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=pt.transition,pt.transition=null;var o=G;G=1;var a=Z;Z|=4,qh.current=null,pw(t,n),g0(n,t),VS(Ku),Pa=!!Yu,Ku=Yu=null,t.current=n,gw(n),$E(),Z=a,G=o,pt.transition=s}else t.current=n;if(Wo&&(Wo=!1,Pn=t,Wa=i),s=t.pendingLanes,s===0&&(Bn=null),KE(n.stateNode),Je(t,ve()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ha)throw Ha=!1,t=gf,gf=null,t;return Wa&1&&t.tag!==0&&di(),s=t.pendingLanes,s&1?t===_f?Cs++:(Cs=0,_f=t):Cs=0,Yn(),null}function di(){if(Pn!==null){var t=ty(Wa),e=pt.transition,n=G;try{if(pt.transition=null,G=16>t?16:t,Pn===null)var r=!1;else{if(t=Pn,Pn=null,Wa=0,Z&6)throw Error(F(331));var i=Z;for(Z|=4,j=t.current;j!==null;){var s=j,o=s.child;if(j.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(j=c;j!==null;){var u=j;switch(u.tag){case 0:case 11:case 15:Rs(8,u,s)}var f=u.child;if(f!==null)f.return=u,j=f;else for(;j!==null;){u=j;var h=u.sibling,_=u.return;if(h0(u),u===c){j=null;break}if(h!==null){h.return=_,j=h;break}j=_}}}var y=s.alternate;if(y!==null){var S=y.child;if(S!==null){y.child=null;do{var C=S.sibling;S.sibling=null,S=C}while(S!==null)}}j=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,j=o;else e:for(;j!==null;){if(s=j,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Rs(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,j=m;break e}j=s.return}}var p=t.current;for(j=p;j!==null;){o=j;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,j=E;else e:for(o=p;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Kl(9,a)}}catch(x){ye(a,a.return,x)}if(a===o){j=null;break e}var A=a.sibling;if(A!==null){A.return=a.return,j=A;break e}j=a.return}}if(Z=i,Yn(),$t&&typeof $t.onPostCommitFiberRoot=="function")try{$t.onPostCommitFiberRoot(Vl,t)}catch{}r=!0}return r}finally{G=n,pt.transition=e}}return!1}function Gp(t,e,n){e=Ri(n,e),e=t0(t,e,1),t=Dn(t,e,1),e=We(),t!==null&&(ao(t,1,e),Je(t,e))}function ye(t,e,n){if(t.tag===3)Gp(t,t,n);else for(;e!==null;){if(e.tag===3){Gp(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Bn===null||!Bn.has(r))){t=Ri(n,t),t=n0(e,t,1),e=Dn(e,t,1),t=We(),e!==null&&(ao(e,1,t),Je(e,t));break}}e=e.return}}function Ew(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=We(),t.pingedLanes|=t.suspendedLanes&n,xe===t&&(Oe&n)===n&&(Re===4||Re===3&&(Oe&130023424)===Oe&&500>ve()-Qh?fr(t,0):Zh|=n),Je(t,e)}function S0(t,e){e===0&&(t.mode&1?(e=Oo,Oo<<=1,!(Oo&130023424)&&(Oo=4194304)):e=1);var n=We();t=cn(t,e),t!==null&&(ao(t,e,n),Je(t,n))}function Sw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),S0(t,n)}function ww(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(F(314))}r!==null&&r.delete(e),S0(t,n)}var w0;w0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ze.current)qe=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qe=!1,uw(t,e,n);qe=!!(t.flags&131072)}else qe=!1,ue&&e.flags&1048576&&Cy(e,Fa,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;_a(t,e),t=e.pendingProps;var i=Ei(e,Ve.current);hi(e,n),i=Wh(null,e,r,t,i,n);var s=$h();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(r)?(s=!0,ka(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Lh(e),i.updater=Yl,e.stateNode=i,i._reactInternals=e,rf(e,r,t,n),e=af(null,e,r,!0,s,n)):(e.tag=0,ue&&s&&Nh(e),je(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(_a(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Rw(r),t=St(r,t),i){case 0:e=of(null,e,r,t,n);break e;case 1:e=Hp(null,e,r,t,n);break e;case 11:e=zp(null,e,r,t,n);break e;case 14:e=jp(null,e,r,St(r.type,t),n);break e}throw Error(F(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:St(r,i),of(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:St(r,i),Hp(t,e,r,i,n);case 3:e:{if(o0(e),t===null)throw Error(F(387));r=e.pendingProps,s=e.memoizedState,i=s.element,ky(t,e),Ua(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ri(Error(F(423)),e),e=Wp(t,e,r,n,i);break e}else if(r!==i){i=Ri(Error(F(424)),e),e=Wp(t,e,r,n,i);break e}else for(nt=Fn(e.stateNode.containerInfo.firstChild),rt=e,ue=!0,At=null,n=My(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Si(),r===i){e=un(t,e,n);break e}je(t,e,r,n)}e=e.child}return e;case 5:return Oy(e),t===null&&ef(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,qu(r,i)?o=null:s!==null&&qu(r,s)&&(e.flags|=32),s0(t,e),je(t,e,o,n),e.child;case 6:return t===null&&ef(e),null;case 13:return a0(t,e,n);case 4:return Vh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=wi(e,null,r,n):je(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:St(r,i),zp(t,e,r,i,n);case 7:return je(t,e,e.pendingProps,n),e.child;case 8:return je(t,e,e.pendingProps.children,n),e.child;case 12:return je(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ie(Da,r._currentValue),r._currentValue=o,s!==null)if(xt(s.value,o)){if(s.children===i.children&&!Ze.current){e=un(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=on(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),tf(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(F(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),tf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}je(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,hi(e,n),i=mt(i),r=r(i),e.flags|=1,je(t,e,r,n),e.child;case 14:return r=e.type,i=St(r,e.pendingProps),i=St(r.type,i),jp(t,e,r,i,n);case 15:return r0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:St(r,i),_a(t,e),e.tag=1,Qe(r)?(t=!0,ka(e)):t=!1,hi(e,n),e0(e,r,i),rf(e,r,i,n),af(null,e,r,!0,t,n);case 19:return l0(t,e,n);case 22:return i0(t,e,n)}throw Error(F(156,e.tag))};function A0(t,e){return Qm(t,e)}function Aw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ht(t,e,n,r){return new Aw(t,e,n,r)}function td(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Rw(t){if(typeof t=="function")return td(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Th)return 11;if(t===Eh)return 14}return 2}function Ln(t,e){var n=t.alternate;return n===null?(n=ht(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function va(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")td(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Wr:return hr(n.children,i,s,e);case vh:o=8,i|=8;break;case Cu:return t=ht(12,n,e,i|2),t.elementType=Cu,t.lanes=s,t;case Pu:return t=ht(13,n,e,i),t.elementType=Pu,t.lanes=s,t;case xu:return t=ht(19,n,e,i),t.elementType=xu,t.lanes=s,t;case Om:return Zl(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Nm:o=10;break e;case km:o=9;break e;case Th:o=11;break e;case Eh:o=14;break e;case En:o=16,r=null;break e}throw Error(F(130,t==null?t:typeof t,""))}return e=ht(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function hr(t,e,n,r){return t=ht(7,t,r,e),t.lanes=n,t}function Zl(t,e,n,r){return t=ht(22,t,r,e),t.elementType=Om,t.lanes=n,t.stateNode={isHidden:!1},t}function $c(t,e,n){return t=ht(6,t,null,e),t.lanes=n,t}function Xc(t,e,n){return e=ht(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function bw(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bc(0),this.expirationTimes=bc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function nd(t,e,n,r,i,s,o,a,l){return t=new bw(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ht(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lh(s),t}function Cw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function R0(t){if(!t)return jn;t=t._reactInternals;e:{if(Rr(t)!==t||t.tag!==1)throw Error(F(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(t.tag===1){var n=t.type;if(Qe(n))return Ry(t,n,e)}return e}function b0(t,e,n,r,i,s,o,a,l){return t=nd(n,r,!0,t,i,s,o,a,l),t.context=R0(null),n=t.current,r=We(),i=Un(n),s=on(r,i),s.callback=e??null,Dn(n,s,i),t.current.lanes=i,ao(t,i,r),Je(t,r),t}function Ql(t,e,n,r){var i=e.current,s=We(),o=Un(i);return n=R0(n),e.context===null?e.context=n:e.pendingContext=n,e=on(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Dn(i,e,o),t!==null&&(Pt(t,i,o,s),da(t,i,o)),o}function Xa(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function eg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function rd(t,e){eg(t,e),(t=t.alternate)&&eg(t,e)}function Pw(){return null}var C0=typeof reportError=="function"?reportError:function(t){console.error(t)};function id(t){this._internalRoot=t}Jl.prototype.render=id.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(F(409));Ql(t,e,null,null)};Jl.prototype.unmount=id.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Er(function(){Ql(null,t,null,null)}),e[ln]=null}};function Jl(t){this._internalRoot=t}Jl.prototype.unstable_scheduleHydration=function(t){if(t){var e=iy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Rn.length&&e!==0&&e<Rn[n].priority;n++);Rn.splice(n,0,t),n===0&&oy(t)}};function sd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tg(){}function xw(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=Xa(o);s.call(c)}}var o=b0(e,r,t,0,null,!1,!1,"",tg);return t._reactRootContainer=o,t[ln]=o.current,Ws(t.nodeType===8?t.parentNode:t),Er(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Xa(l);a.call(c)}}var l=nd(t,0,!1,null,null,!1,!1,"",tg);return t._reactRootContainer=l,t[ln]=l.current,Ws(t.nodeType===8?t.parentNode:t),Er(function(){Ql(e,l,n,r)}),l}function ec(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Xa(o);a.call(l)}}Ql(e,o,t,i)}else o=xw(n,e,t,i,r);return Xa(o)}ny=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ds(e.pendingLanes);n!==0&&(Ah(e,n|1),Je(e,ve()),!(Z&6)&&(bi=ve()+500,Yn()))}break;case 13:Er(function(){var r=cn(t,1);if(r!==null){var i=We();Pt(r,t,1,i)}}),rd(t,1)}};Rh=function(t){if(t.tag===13){var e=cn(t,134217728);if(e!==null){var n=We();Pt(e,t,134217728,n)}rd(t,134217728)}};ry=function(t){if(t.tag===13){var e=Un(t),n=cn(t,e);if(n!==null){var r=We();Pt(n,t,e,r)}rd(t,e)}};iy=function(){return G};sy=function(t,e){var n=G;try{return G=t,e()}finally{G=n}};Lu=function(t,e,n){switch(e){case"input":if(Nu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Wl(r);if(!i)throw Error(F(90));Dm(r),Nu(r,i)}}}break;case"textarea":Um(t,n);break;case"select":e=n.value,e!=null&&li(t,!!n.multiple,e,!1)}};$m=Jh;Xm=Er;var Iw={usingClientEntryPoint:!1,Events:[co,Kr,Wl,Hm,Wm,Jh]},rs={findFiberByHostInstance:sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Mw={bundleType:rs.bundleType,version:rs.version,rendererPackageName:rs.rendererPackageName,rendererConfig:rs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qm(t),t===null?null:t.stateNode},findFiberByHostInstance:rs.findFiberByHostInstance||Pw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$o.isDisabled&&$o.supportsFiber)try{Vl=$o.inject(Mw),$t=$o}catch{}}st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Iw;st.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sd(e))throw Error(F(200));return Cw(t,e,null,n)};st.createRoot=function(t,e){if(!sd(t))throw Error(F(299));var n=!1,r="",i=C0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=nd(t,1,!1,null,null,n,!1,r,i),t[ln]=e.current,Ws(t.nodeType===8?t.parentNode:t),new id(e)};st.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(F(188)):(t=Object.keys(t).join(","),Error(F(268,t)));return t=qm(e),t=t===null?null:t.stateNode,t};st.flushSync=function(t){return Er(t)};st.hydrate=function(t,e,n){if(!Gl(e))throw Error(F(200));return ec(null,t,e,!0,n)};st.hydrateRoot=function(t,e,n){if(!sd(t))throw Error(F(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=C0;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=b0(e,null,t,1,n??null,i,!1,s,o),t[ln]=e.current,Ws(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Jl(e)};st.render=function(t,e,n){if(!Gl(e))throw Error(F(200));return ec(null,t,e,!1,n)};st.unmountComponentAtNode=function(t){if(!Gl(t))throw Error(F(40));return t._reactRootContainer?(Er(function(){ec(null,null,t,!1,function(){t._reactRootContainer=null,t[ln]=null})}),!0):!1};st.unstable_batchedUpdates=Jh;st.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Gl(n))throw Error(F(200));if(t==null||t._reactInternals===void 0)throw Error(F(38));return ec(t,e,n,!1,r)};st.version="18.3.1-next-f1338f8080-20240426";function P0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(P0)}catch(t){console.error(t)}}P0(),Pm.exports=st;var od=Pm.exports,x0,ng=od;x0=ng.createRoot,ng.hydrateRoot;const I0=k.createContext(null),Nw=({children:t})=>{const[e,n]=k.useState(()=>{try{return JSON.parse(localStorage.getItem("settings")||"{}")}catch{return{}}});k.useEffect(()=>{try{localStorage.setItem("settings",JSON.stringify(e))}catch{}},[e]);const r=(i,s)=>n(o=>({...o,[i]:s}));return W.jsx(I0.Provider,{value:{settings:e,setSetting:r},children:t})},pi=(t,e=null)=>{const n=k.useContext(I0);if(!n)throw new Error("useSetting must be used inside <SettingsProvider>");return[Object.prototype.hasOwnProperty.call(n.settings,t)?n.settings[t]:e,s=>n.setSetting(t,s)]},rg=[[227,26,28],[31,120,180],[51,160,44],[255,127,0],[106,61,154],[166,206,227],[178,223,138],[251,154,153],[253,191,111],[202,178,214]];function M0(t){const e=[...t].sort((r,i)=>r.localeCompare(i)),n={};return e.forEach((r,i)=>{n[r]=rg[i%rg.length]}),n}const vf="/bird-tracking/",kw=t=>t?/^https?:\/\//.test(t)?t:`${vf}${t.replace(/^\/+/,"")}`:null,Tf=t=>(t||"").normalize("NFC"),ig=t=>Tf(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),Xo=110,Ow=3;function Fw(){const[t,e]=pi("activeSpeciesList",[]),[n,r]=pi("highlightedSpecies",null),[i,s]=pi("speed",1),[o,a]=k.useState([]),[l,c]=k.useState({});k.useEffect(()=>{Promise.all([fetch(`${vf}birds.geojson`).then(y=>y.json()).catch(()=>({features:[]})),fetch(`${vf}birds_meta.json`).then(y=>y.json()).catch(()=>[])]).then(([y,S])=>{const C=[...new Set((y.features||[]).map(p=>{var E;return(E=p==null?void 0:p.properties)==null?void 0:E.species}).filter(Boolean))].sort((p,E)=>p.localeCompare(E));a(C);const m={};for(const p of S)p!=null&&p.id&&(m[Tf(p.id)]=p,m[ig(p.id)]=p);c(m),(!t||t.length===0)&&e(C)})},[]);const u=k.useMemo(()=>M0(o),[o]),f=y=>{const S=new Set(t||[]);S.has(y)?S.delete(y):S.add(y),e([...S])},h=()=>e([]),_=()=>e(o);return W.jsxs("div",{className:"panel",children:[W.jsx("h2",{className:"u-mobileHidden",children:"ltalunk jellt madarak"}),W.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[W.jsx("button",{onClick:_,children:"Select all"}),W.jsx("button",{onClick:h,children:"Clear"})]}),W.jsx("div",{className:"legend-grid",style:{display:"grid",gridTemplateColumns:`repeat(${Ow}, minmax(0, 1fr))`,gap:14,alignItems:"start"},children:o.map(y=>{const S=l[Tf(y)]||l[ig(y)]||{},C=S.name||y,m=kw(S.photo),p=u[y]||[150,150,150],E=`rgb(${p[0]}, ${p[1]}, ${p[2]})`;return W.jsxs("div",{style:{textAlign:"center"},onMouseEnter:()=>r(y),onMouseLeave:()=>r(null),children:[m?W.jsx("img",{src:m,alt:C,width:Xo,height:Xo,style:{display:"block",margin:"0 auto",borderRadius:"50%",border:`3px solid ${E}`,objectFit:"cover"},onError:A=>{A.currentTarget.style.display="none"}}):W.jsx("span",{style:{display:"inline-block",width:Xo,height:Xo,margin:"0 auto",background:E,borderRadius:"50%"}}),W.jsxs("label",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:8,marginTop:8,cursor:"pointer"},children:[W.jsx("input",{type:"checkbox",checked:(t||[]).includes(y),onChange:()=>f(y)}),W.jsx("span",{style:{display:"block",lineHeight:1.1},children:C})]})]},y)})}),W.jsx("hr",{style:{margin:"12px 0"}}),W.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",marginTop:8},children:["Speed",W.jsx("input",{type:"range",min:"0.25",max:"8",step:"0.25",value:i||1,onChange:y=>s(parseFloat(y.target.value))}),W.jsxs("span",{children:[i||1,""]})]})]})}const Dw=t=>new Date(t*1e3),Bw=t=>{var r;if(!Array.isArray(t)||t.length===0)return[0,0];let e=1/0,n=-1/0;for(const i of t){const s=((r=i==null?void 0:i.properties)==null?void 0:r.times)||[];for(const o of s)o<e&&(e=o),o>n&&(n=o)}return!isFinite(e)||!isFinite(n)?[0,0]:[e,n]};function Uw({time:t,timeRange:e,setTime:n,isTimeRunning:r,setIsTimeRunning:i}){const[s=0,o=0]=e||[],a=t?Dw(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return W.jsx("div",{className:"controls",children:W.jsxs("div",{className:"timeControlLine",children:[W.jsx("button",{className:"c-button c-button--icon","aria-label":r?"Pause":"Play",onClick:()=>i(!r),title:r?"Pause":"Play",style:{marginRight:8},children:r?"":""}),W.jsx("input",{type:"range",min:s,max:o,step:3600,value:t,onChange:l=>n(Number(l.target.value)),style:{flex:1}}),W.jsx("div",{style:{width:110,textAlign:"right",marginLeft:8},children:a})]})})}const Lw=()=>W.jsxs("footer",{className:"credits",children:[W.jsxs("p",{children:["Map background: "," ",W.jsx("a",{href:"https://carto.com/",target:"_blank",rel:"noreferrer",children:"CARTO"}),"  "," ",W.jsx("a",{href:"https://www.openstreetmap.org/copyright",target:"_blank",rel:"noreferrer",children:"OpenStreetMap"})," ","contributors"]}),W.jsxs("p",{children:["Built with ",W.jsx("a",{href:"https://deck.gl/",target:"_blank",rel:"noreferrer",children:"deck.gl"})," &"," ",W.jsx("a",{href:"https://maplibre.org/",target:"_blank",rel:"noreferrer",children:"MapLibre GL"}),"."," ","Source code:"," ",W.jsx("a",{href:"https://github.com/L-KA-HU/bird-tracking",target:"_blank",rel:"noreferrer",children:"GitHub"}),"."]}),W.jsx("p",{children:"Author: Lovas-Kiss dm, code based on the work of Benjamin Becquet"})]}),Vw=({time:t,timeRange:e,setTime:n,isTimeRunning:r,setIsTimeRunning:i})=>W.jsxs("div",{id:"panel",children:[W.jsx("h1",{className:"u-mobileHidden",children:"20242025-ben jellt nagy goda egyedek mozgsa"}),W.jsx(Uw,{time:t,timeRange:e,setTime:n,isTimeRunning:r,setIsTimeRunning:i}),W.jsx(Fw,{}),W.jsx(Lw,{})]});function Ya(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const ad=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),sg=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sg&&parseFloat(sg[1]);const Yo=globalThis,Fr=globalThis.process||{},zw=globalThis.navigator||{};function N0(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Kn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||N0()}function jw(t){return Kn()?N0()?"Electron":(zw.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const k0="4.0.7";function Hw(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class Ww{constructor(e,n,r="sessionStorage"){this.storage=Hw(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function $w(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function Xw(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Ka;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ka||(Ka={}));const Yw=10;function og(t){return typeof t!="string"?t:(t=t.toUpperCase(),Ka[t]||Ka.WHITE)}function Kw(t,e,n){return!Kn&&typeof t=="string"&&(e&&(t=`\x1B[${og(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${og(n)+Yw}m${t}\x1B[49m`)),t}function qw(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function ld(t,e){if(!t)throw new Error("Assertion failed")}function Dr(){var e,n,r;let t;if(Kn()&&Yo.performance)t=(n=(e=Yo==null?void 0:Yo.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Fr){const i=(r=Fr==null?void 0:Fr.hrtime)==null?void 0:r.call(Fr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Br={debug:Kn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Zw={enabled:!0,level:0};function Ur(){}const ag={},lg={once:!0};class fo{constructor({id:e}={id:""}){this.VERSION=k0,this._startTs=Dr(),this._deltaTs=Dr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Ww(`__probe-${this.id}__`,Zw),this.timeStamp(`${this.id} started`),qw(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Dr()-this._startTs).toPrecision(10))}getDelta(){return Number((Dr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Br.warn,arguments,lg)}error(e){return this._getLogFunction(0,e,Br.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Br.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Br.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Br.debug||Br.info,arguments,lg)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ur,r&&[r],{tag:Jw(n)}):Ur}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ur)}group(e,n,r={collapsed:!1}){const i=cg({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ur)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=O0(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=cg({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,ld(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Dr();const o=s.tag||s.message;if(s.once&&o)if(!ag[o])ag[o]=Dr();else return Ur;return n=Qw(this.id,s.message,s),r.bind(console,n,...s.args)}return Ur}}fo.VERSION=k0;function O0(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ld(Number.isFinite(e)&&e>=0),e}function cg(t){const{logLevel:e,message:n}=t;t.logLevel=O0(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return ld(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function Qw(t,e,n){if(typeof e=="string"){const r=n.time?Xw($w(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=Kw(e,n.color,n.background)}return e}function Jw(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}function Gw(t,e){return F0(t||{},e)}function F0(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=F0(r[i]||{},e[i],n+1):r[i]=e[i];return r}const e1="latest";function t1(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version}const n1=t1();function Hn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const dr=typeof process!="object"||String(process)!=="[object process]"||process.browser,r1=typeof window<"u"&&typeof window.orientation<"u",ug=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ug&&parseFloat(ug[1]);class i1{constructor(e,n){g(this,"name");g(this,"workerThread");g(this,"isRunning",!0);g(this,"result");g(this,"_resolve",()=>{});g(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Hn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Hn(this.isRunning),this.isRunning=!1,this._reject(e)}}class Yc{terminate(){}}const Kc=new Map;function s1(t){Hn(t.source&&!t.url||!t.source&&t.url);let e=Kc.get(t.source||t.url);return e||(t.url&&(e=o1(t.url),Kc.set(t.url,e)),t.source&&(e=D0(t.source),Kc.set(t.source,e))),Hn(e),e}function o1(t){if(!t.startsWith("http"))return t;const e=a1(t);return D0(e)}function D0(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function a1(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function B0(t,e=!0,n){const r=n||new Set;if(t){if(fg(t))r.add(t);else if(fg(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)B0(t[i],e,r)}}return n===void 0?Array.from(r):[]}function fg(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const qc=()=>{};class Ef{constructor(e){g(this,"name");g(this,"source");g(this,"url");g(this,"terminated",!1);g(this,"worker");g(this,"onMessage");g(this,"onError");g(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Hn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=qc,this.onError=s=>console.log(s),this.worker=dr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&dr||typeof Yc<"u"&&!dr}destroy(){this.onMessage=qc,this.onError=qc,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||B0(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=s1({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Yc(r,{eval:!1})}else if(this.source)e=new Yc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class l1{constructor(e){g(this,"name","unnamed");g(this,"source");g(this,"url");g(this,"maxConcurrency",1);g(this,"maxMobileConcurrency",1);g(this,"onDebug",()=>{});g(this,"reuseWorkers",!0);g(this,"props",{});g(this,"jobQueue",[]);g(this,"idleQueue",[]);g(this,"count",0);g(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Ef.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new i1(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!dr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ef({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return r1?this.maxMobileConcurrency:this.maxConcurrency}}const c1={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},An=class An{constructor(e){g(this,"props");g(this,"workerPools",new Map);this.props={...c1},this.setProps(e),this.workerPools=new Map}static isSupported(){return Ef.isSupported()}static getWorkerFarm(e={}){return An._workerFarm=An._workerFarm||new An({}),An._workerFarm.setProps(e),An._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new l1({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};g(An,"_workerFarm");let qa=An;function u1(t,e={}){const n=e[t.id]||{},r=dr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(dr?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=e1);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Hn(i),i}function f1(t,e=n1){Hn(t,"no worker provided");const n=t.version;return!(!e||!n)}function h1(t,e){return!qa.isSupported()||!dr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function d1(t,e,n,r,i){const s=t.id,o=u1(t,n),l=qa.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",p1.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function p1(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function g1(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function _1(...t){return m1(t)}function m1(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function y1(t){const e=[];for await(const n of t)e.push(n);return _1(...e)}function hg(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class dg{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=hg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(hg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class tc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof dg?i=e:i=new dg(n,r),this.stats[n]=i),i}}let v1="";const pg={};function T1(t){for(const e in pg)if(t.startsWith(e)){const n=pg[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${v1}${t}`),t}function E1(t){return t&&typeof t=="object"&&t.isBuffer}function U0(t){if(E1(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function L0(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function S1(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const w1=t=>typeof t=="boolean",Ps=t=>typeof t=="function",ho=t=>t!==null&&typeof t=="object",gg=t=>ho(t)&&t.constructor==={}.constructor,A1=t=>!!t&&typeof t[Symbol.iterator]=="function",R1=t=>t&&typeof t[Symbol.asyncIterator]=="function",br=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Cr=t=>typeof Blob<"u"&&t instanceof Blob,b1=t=>t&&typeof t=="object"&&t.isBuffer,C1=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ho(t)&&Ps(t.tee)&&Ps(t.cancel)&&Ps(t.getReader),P1=t=>ho(t)&&Ps(t.read)&&Ps(t.pipe)&&w1(t.readable),V0=t=>C1(t)||P1(t);class x1 extends Error{constructor(n,r){super(n);g(this,"reason");g(this,"url");g(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const I1=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,M1=/^([-\w.]+\/[-\w.+]+)/;function _g(t,e){return t.toLowerCase()===e.toLowerCase()}function N1(t){const e=M1.exec(t);return e?e[1]:t}function mg(t){const e=I1.exec(t);return e?e[1]:""}const z0=/\?.*/;function k1(t){const e=t.match(z0);return e&&e[0]}function cd(t){return t.replace(z0,"")}function O1(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function nc(t){return br(t)?t.url:Cr(t)?t.name||"":typeof t=="string"?t:""}function ud(t){if(br(t)){const e=t,n=e.headers.get("content-type")||"",r=cd(e.url);return N1(n)||mg(r)}return Cr(t)?t.type||"":typeof t=="string"?mg(t):""}function F1(t){return br(t)?t.headers["content-length"]||-1:Cr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function j0(t){if(br(t))return t;const e={},n=F1(t);n>=0&&(e["content-length"]=String(n));const r=nc(t),i=ud(t);i&&(e["content-type"]=i);const s=await U1(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function D1(t){if(!t.ok)throw await B1(t)}async function B1(t){const e=O1(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=i!=null&&i.includes("application/json")?await t.json():t.text()}catch{}return new x1(n,r)}async function U1(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${L1(n)}`}return null}function L1(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function V1(t){return!z1(t)&&!j1(t)}function z1(t){return t.startsWith("http:")||t.startsWith("https:")}function j1(t){return t.startsWith("data:")}async function yg(t,e){var n,r;if(typeof t=="string"){const i=T1(t);return V1(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await j0(t)}const vg=new fo({id:"loaders.gl"});class H1{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class W1{constructor(){g(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const H0={fetch:null,mimeType:void 0,nothrow:!1,log:new W1,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ad,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},$1={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function W0(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function $0(){const t=W0();return t.globalOptions=t.globalOptions||{...H0},t.globalOptions}function X1(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],Y1(t,n),q1(e,t,r)}function Y1(t,e){Tg(t,null,H0,$1,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Tg(r,n.id,i,s,e)}}function Tg(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&ho(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)vg.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const f=K1(a,i);vg.warn(`${s} loader option '${o}${a}' not recognized. ${f}`)()}}}}function K1(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function q1(t,e,n){const i={...t.options||{}};return Z1(i,n),i.log===null&&(i.log=new H1),Eg(i,$0()),Eg(i,e),i}function Eg(t,e){for(const n in e)if(n in e){const r=e[n];gg(r)&&gg(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Z1(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function fd(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function hd(t){Ya(t,"null loader"),Ya(fd(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const X0=()=>{const t=W0();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Q1(t){const e=X0();t=Array.isArray(t)?t:[t];for(const n of t){const r=hd(n);e.find(i=>r===i)||e.unshift(r)}}function J1(){return X0()}const G1=new fo({id:"loaders.gl"}),eA=/\.([^.]+)$/;async function tA(t,e=[],n,r){if(!Y0(t))return null;let i=Sg(t,e,{...n,nothrow:!0},r);if(i)return i;if(Cr(t)&&(t=await t.slice(0,10).arrayBuffer(),i=Sg(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(K0(t));return i}function Sg(t,e=[],n,r){if(!Y0(t))return null;if(e&&!Array.isArray(e))return hd(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...J1()),rA(i);const s=nA(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(K0(t));return s}function nA(t,e,n,r){const i=nc(t),s=ud(t),o=cd(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=Zc(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||iA(e,o),l=l||(a?`matched url ${o}`:""),a=a||Zc(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||oA(e,t),l=l||(a?`matched initial data ${q0(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Zc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&G1.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function Y0(t){return!(t instanceof Response&&t.status===204)}function K0(t){const e=nc(t),n=ud(t);let r="No valid loader found (";r+=e?`${L0(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?q0(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function rA(t){for(const e of t)hd(e)}function iA(t,e){const n=e&&eA.exec(e),r=n&&n[1];return r?sA(t,r):null}function sA(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Zc(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>_g(e,i))||_g(e,`application/x.${r.id}`))return r;return null}function oA(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(aA(e,n))return n}else if(ArrayBuffer.isView(e)){if(wg(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&wg(e,0,n))return n;return null}function aA(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function wg(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>lA(t,e,n,i))}function lA(t,e,n,r){if(r instanceof ArrayBuffer)return g1(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=Sf(t,e,r.length);return r===i;default:return!1}}function q0(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Sf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Sf(t,0,e):""}function Sf(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const cA=256*1024;function*uA(t,e){const n=(e==null?void 0:e.chunkSize)||cA;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const fA=256*1024;function*hA(t,e={}){const{chunkSize:n=fA}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const dA=1024*1024;async function*pA(t,e){const n=(e==null?void 0:e.chunkSize)||dA;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Ag(t,e){return ad?gA(t,e):_A(t)}async function*gA(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield U0(o)}}catch{n.releaseLock()}}async function*_A(t,e){for await(const n of t)yield U0(n)}function mA(t,e){if(typeof t=="string")return uA(t,e);if(t instanceof ArrayBuffer)return hA(t,e);if(Cr(t))return pA(t,e);if(V0(t))return Ag(t,e);if(br(t))return Ag(t.body,e);throw new Error("makeIterator")}const Z0="Cannot convert supplied data type";function yA(t,e,n){if(e.text&&typeof t=="string")return t;if(b1(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(Z0)}async function vA(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return yA(t,e);if(Cr(t)&&(t=await j0(t)),br(t)){const i=t;return await D1(i),e.binary?await i.arrayBuffer():await i.text()}if(V0(t)&&(t=mA(t,n)),A1(t)||R1(t))return y1(t);throw new Error(Z0)}function Q0(t,e){const n=$0(),r=t||n;return typeof r.fetch=="function"?r.fetch:ho(r.fetch)?i=>yg(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:yg}function TA(t,e,n){if(n)return n;const r={fetch:Q0(e,t),...t};if(r.url){const i=cd(r.url);r.baseUrl=i,r.queryString=k1(r.url),r.filename=L0(i),r.baseUrl=S1(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function EA(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Za(t,e,n,r){e&&!Array.isArray(e)&&!fd(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=nc(t),o=EA(e,r),a=await tA(t,o,n);return a?(n=X1(n,a,o,i),r=TA({url:i,_parse:Za,loaders:o},n,r||null),await SA(a,t,n,r)):null}async function SA(t,e,n,r){if(f1(t),n=Gw(t.options,n),br(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:f}=s,h=Object.fromEntries(s.headers.entries());r.response={headers:h,ok:o,redirected:a,status:l,statusText:c,type:u,url:f}}e=await vA(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(h1(t,n))return await d1(t,e,n,r,Za);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Hn(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function wf(t,e,n,r){let i,s;!Array.isArray(e)&&!fd(e)?(i=[],s=e):(i=e,s=n);const o=Q0(s);let a=t;return typeof t=="string"&&(a=await o(t)),Cr(t)&&(a=await o(t)),Array.isArray(i)?await Za(a,i,s):await Za(a,i,s)}const wA="4.2.1";var gm;const AA=(gm=globalThis.loaders)==null?void 0:gm.parseImageNode,Af=typeof Image<"u",Rf=typeof ImageBitmap<"u",RA=!!AA,bf=ad?!0:RA;function bA(t){switch(t){case"auto":return Rf||Af||bf;case"imagebitmap":return Rf;case"image":return Af;case"data":return bf;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function CA(){if(Rf)return"imagebitmap";if(Af)return"image";if(bf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function PA(t){const e=IA(t);if(!e)throw new Error("Not an image");return e}function xA(t){switch(PA(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function IA(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const MA=/^data:image\/svg\+xml/,NA=/\.svg((\?|#).*)?$/;function dd(t){return t&&(MA.test(t)||NA.test(t))}function kA(t,e){if(dd(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return J0(t,e)}function J0(t,e){if(dd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function G0(t,e,n){const r=kA(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await OA(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function OA(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const FA={};let Rg=!0;async function DA(t,e,n){let r;dd(n)?r=await G0(t,e,n):r=J0(t,n);const i=e&&e.imagebitmap;return await BA(r,i)}async function BA(t,e=null){if((UA(e)||!Rg)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Rg=!1}return await createImageBitmap(t)}function UA(t){for(const e in t||FA)return!1;return!0}function LA(t){return!HA(t,"ftyp",4)||!(t[8]&96)?null:VA(t)}function VA(t){switch(zA(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function zA(t,e,n){return String.fromCharCode(...t.slice(e,n))}function jA(t){return[...t].map(e=>e.charCodeAt(0))}function HA(t,e,n=0){const r=jA(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const jt=!1,xs=!0;function ev(t){const e=po(t);return $A(e)||KA(e)||XA(e)||YA(e)||WA(e)}function WA(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=LA(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function $A(t){const e=po(t);return e.byteLength>=24&&e.getUint32(0,jt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,jt),height:e.getUint32(20,jt)}:null}function XA(t){const e=po(t);return e.byteLength>=10&&e.getUint32(0,jt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,xs),height:e.getUint16(8,xs)}:null}function YA(t){const e=po(t);return e.byteLength>=14&&e.getUint16(0,jt)===16973&&e.getUint32(2,xs)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,xs),height:e.getUint32(22,xs)}:null}function KA(t){const e=po(t);if(!(e.byteLength>=3&&e.getUint16(0,jt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=qA();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,jt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,jt),width:e.getUint16(s+7,jt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,jt)}return null}function qA(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function po(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function ZA(t,e){var i;const{mimeType:n}=ev(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Ya(r),await r(t,n)}async function QA(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=JA(i);let a;switch(o){case"imagebitmap":a=await DA(t,e,s);break;case"image":a=await G0(t,e,s);break;case"data":a=await ZA(t);break;default:Ya(!1)}return i==="data"&&(a=xA(a)),a}function JA(t){switch(t){case"auto":case"data":return CA();default:return bA(t),t}}const GA=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],eR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],tR={image:{type:"auto",decode:!0}},nR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:wA,mimeTypes:eR,extensions:GA,parse:QA,tests:[t=>!!ev(new DataView(t))],options:tR},se=new fo({id:"deck"});let Cf={};function rR(t){Cf=t}function He(t,e,n,r){se.level>0&&Cf[t]&&Cf[t].call(null,e,n,r)}function iR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const sR={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:iR,parseTextSync:JSON.parse};function oR(){const t="9.0.27",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(se.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:se,_registerLoggers:rR},Q1([sR,[nR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const aR=oR();function lr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Qc={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function lR(t){const e={};for(const[n,r]of Object.entries(t))e[n]=uR(r);return e}function cR(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&lr(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function uR(t){let e=bg(t);if(e!=="object")return{value:t,...Qc[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Qc[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=bg(t.value),{...t,...Qc[e],type:e}):{type:"object",value:null};throw new Error("props")}function bg(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const fR=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,hR=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,dR={vertex:fR,fragment:hR},Cg=/void\s+main\s*\([^)]*\)\s*\{\n?/,Pg=/}\n?[^{}]*$/,Jc=[],Ta="__LUMA_INJECT_DECLARATIONS__";function pR(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=gR(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function gR(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Qa(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Jc.length=o.length;for(let l=0,c=o.length;l<c;++l)Jc[l]=o[l].injection;const a=`${Jc.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Ta,a));break;case"vs:#main-start":i&&(t=t.replace(Cg,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(Pg,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Ta,a));break;case"fs:#main-start":i||(t=t.replace(Cg,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(Pg,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ta,""),r&&(t=t.replace(/\}\s*$/,s=>s+dR[e])),t}let _R=1;class cr{constructor(e){g(this,"name");g(this,"vs");g(this,"fs");g(this,"getModuleUniforms");g(this,"dependencies");g(this,"deprecations");g(this,"defines");g(this,"injections");g(this,"uniforms",{});g(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:l,deprecations:c=[],defines:u={},inject:f={}}=e;lr(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=l,this.dependencies=cr.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=u,this.injections=pR(f),this.uniformTypes=o,a&&(this.uniforms=lR(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof cr)return n;lr(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${_R++}`);const r=new cr(n);return r.dependencies=cr.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:lr(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):cR(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&lr(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function xg(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=Ig(t.platformInfo,t.vs);let n;return t.fs&&(n=Ig(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function Ig(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function rc(t){const e=cr.instantiateModules(t);return mR(e)}function mR(t){const e={},n={};return tv({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function tv(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&tv({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function yR(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vR(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Mg(t,TR),t;case"fragment":return t=Mg(t,ER),t;default:throw new Error(e)}}const nv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],TR=[...nv,[Pf("attribute"),"in $1"],[Pf("varying"),"out $1"]],ER=[...nv,[Pf("varying"),"in $1"]];function Mg(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Pf(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function rv(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function iv(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function SR(t,e){return{name:wR(t,e),language:"glsl",version:AR(t)}}function wR(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function AR(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const sv=`

${Ta}
`,RR=`precision highp float;
`;function bR(t){const e=rc(t.modules||[]);return{source:xf(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:pd(e)}}function CR(t){const e=rc(t.modules||[]);return{vs:xf(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:xf(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:pd(e)}}function PR(t){const{vs:e,fs:n}=t,r=rc(t.modules||[]);return{vs:Ng(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Ng(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:pd(r)}}function xf(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;lr(typeof n=="string","shader source must be a string");const l=n;let c="";const u=iv(s),f={},h={},_={};for(const S in o){const C=typeof o[S]=="string"?{injection:o[S],order:0}:o[S],m=/^(v|f)s:(#)?([\w-]+)$/.exec(S);if(m){const p=m[2],E=m[3];p?E==="decl"?h[S]=[C]:_[S]=[C]:f[S]=[C]}else _[S]=[C]}const y=t.type!=="webgpu"?i:[];for(const S of y){a&&S.checkDeprecations(l,a);const C=S.getModuleSource(r,"wgsl");c+=C;const m=S.injections[r];for(const p in m){const E=/^(v|f)s:#([\w-]+)$/.exec(p);if(E){const x=E[2]==="decl"?h:_;x[p]=x[p]||[],x[p].push(m[p])}else f[p]=f[p]||[],f[p].push(m[p])}}return c+=sv,c=Qa(c,r,h),c+=rv(u[r],f),c+=l,c=Qa(c,r,_),c}function Ng(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=e;lr(typeof r=="string","shader source must be a string");const h=s==="glsl"?SR(r).version:-1,_=t.shaderLanguageVersion,y=h===100?"#version 100":"#version 300 es",C=r.split(`
`).slice(1).join(`
`),m={};o.forEach(N=>{Object.assign(m,N.getDefines())}),Object.assign(m,a);let p="";switch(s){case"wgsl":break;case"glsl":p=u?`${y}

// ----- PROLOGUE -------------------------
${xR({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${yR(t)}
${i==="fragment"?RR:""}

// ----- APPLICATION DEFINES -------------------------

${IR(m)}

`:`${y}
`;break}const E=iv(l),A={},x={},M={};for(const N in c){const D=typeof c[N]=="string"?{injection:c[N],order:0}:c[N],L=/^(v|f)s:(#)?([\w-]+)$/.exec(N);if(L){const U=L[2],H=L[3];U?H==="decl"?x[N]=[D]:M[N]=[D]:A[N]=[D]}else M[N]=[D]}for(const N of o){f&&N.checkDeprecations(C,f);const D=N.getModuleSource(i);p+=D;const L=N.injections[i];for(const U in L){const H=/^(v|f)s:#([\w-]+)$/.exec(U);if(H){const ee=H[2]==="decl"?x:M;ee[U]=ee[U]||[],ee[U].push(L[U])}else A[U]=A[U]||[],A[U].push(L[U])}}return p+="// ----- MAIN SHADER SOURCE -------------------------",p+=sv,p=Qa(p,i,x),p+=rv(E[i],A),p+=C,p=Qa(p,i,M),s==="glsl"&&h!==_&&(p=vR(p,i)),p.trim()}function pd(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function xR(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function IR(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const rr=class rr{constructor(){g(this,"_hookFunctions",[]);g(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return rr.defaultShaderAssembler=rr.defaultShaderAssembler||new rr,rr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=xg(e);return{...bR({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=xg(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?CR({platformInfo:s,...n,modules:r,hookFunctions:i}):PR({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,cr.instantiateModules(n)}};g(rr,"defaultShaderAssembler");let Ja=rr;const MR=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,NR=`#version 300 es
${MR}`;function kR(t){const{input:e,inputChannels:n,output:r}={};if(!e)return NR;if(!n)throw new Error("inputChannels");const i=OR(n),s=FR(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function OR(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function FR(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const B=new fo({id:"luma.gl"});class DR{constructor(){g(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new tc({id:e})),this.stats.get(e)}}const gd=new DR;function BR(){const t="9.0.23",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Kn()&&B.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:B,stats:gd}),t}const UR=BR();function LR(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Gs(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:LR(t)}const Gc={};function Pr(t="id"){Gc[t]=Gc[t]||1;const e=Gc[t]++;return`${t}-${e}`}function Ga(t){let e=!0;for(const n in t){e=!1;break}return e}var Ru;let re=(Ru=class{constructor(e,n,r){g(this,"id");g(this,"props");g(this,"userData",{});g(this,"_device");g(this,"destroyed",!1);g(this,"allocatedBytes",0);g(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=VR(n,r);const i=this.props.id!=="undefined"?this.props.id:Pr(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},g(Ru,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Ru);function VR(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Me=class Me extends re{constructor(n,r){const i={...r};(r.usage||0)&Me.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,Me.defaultProps);g(this,"usage");g(this,"indexType");g(this,"updateTimestamp");g(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Me.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};g(Me,"defaultProps",{...re.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),g(Me,"MAP_READ",1),g(Me,"MAP_WRITE",2),g(Me,"COPY_SRC",4),g(Me,"COPY_DST",8),g(Me,"INDEX",16),g(Me,"VERTEX",32),g(Me,"UNIFORM",64),g(Me,"STORAGE",128),g(Me,"INDIRECT",256),g(Me,"QUERY_RESOLVE",512),g(Me,"DEBUG_DATA_MAX_LENGTH",32);let fe=Me;function ov(t){const e=kg[t],n=zR(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:kg[t],byteLength:n,integer:i,signed:s,normalized:r}}function zR(t){return jR[t]}const kg={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},jR={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},HR=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],WR=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function $R(t){return HR.some(e=>t.startsWith(e))}function av(t){const e=WR.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=ov(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return YR(t)}const XR={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function YR(t){var n;const e=XR[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class KR{}class qR{constructor(e=[],n){g(this,"features");g(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const ks=class ks{constructor(e){g(this,"id");g(this,"props");g(this,"userData",{});g(this,"statsManager",gd);g(this,"_lumaData",{});g(this,"timestamp",0);this.props={...ks.defaultProps,...e},this.id=this.props.id||Pr(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return $R(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&fe.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":B.warn("indices buffer content must be of integer type")()),n}};g(ks,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!B.get("debug"),spector:!!(B.get("spector")||B.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>B.error(e.message)}),g(ks,"VERSION",UR);let Ci=ks;function oe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const is=new Map,ai=class ai{static registerDevices(e){for(const n of e)oe(n.type&&n.isSupported&&n.create),is.set(n.type,n)}static getAvailableDevices(){return Array.from(is).map(e=>e.type)}static getSupportedDevices(){return Array.from(is).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Ci.defaultProps,e)}static async attachDevice(e){const n=Og(e.devices)||is;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var r,i;e={...ai.defaultProps,...e},e.gl&&(e.type="webgl");const n=Og(e.devices)||is;switch(e.type){case"webgpu":let s=n.get("webgpu");if(s)return await s.create(e);break;case"webgl":let o=n.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(s=n.get("webgpu"),(r=s==null?void 0:s.isSupported)!=null&&r.call(s))return await s.create(e);if(o=n.get("webgl"),(i=o==null?void 0:o.isSupported)!=null&&i.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,i){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(r,i)}}};g(ai,"defaultProps",{...Ci.defaultProps,type:"best-available",devices:void 0}),g(ai,"stats",gd),g(ai,"log",B);let gi=ai;function Og(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const ZR=Kn()&&typeof document<"u",ic=()=>ZR&&document.readyState==="complete",QR={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class _d{constructor(e){g(this,"id");g(this,"props");g(this,"canvas");g(this,"htmlCanvas");g(this,"offscreenCanvas");g(this,"type");g(this,"width",1);g(this,"height",1);g(this,"resizeObserver");g(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...QR,...e},e=this.props,!Kn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=eb(e.canvas):this.canvas=e.canvas;else{const n=tb(e),r=GR((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return ic()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return nb(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(B.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/r,u/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),B.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}g(_d,"pageLoaded",JR());function JR(){return ic()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function GR(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!ic())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function eb(t){const e=document.getElementById(t);if(!e&&!ic())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function tb(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function nb(t,e,n,r,i){const s=t,o=Fg(s[0],e,n);let a=Dg(s[1],e,r,i),l=Fg(s[0]+1,e,n);const c=l===n-1?l:l-1;l=Dg(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function Fg(t,e,n){return Math.min(Math.round(t*e),n-1)}function Dg(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Gt=class Gt extends re{constructor(n,r,i=Gt.defaultProps){super(n,r,i);g(this,"dimension");g(this,"format");g(this,"width");g(this,"height");g(this,"depth");g(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};g(Gt,"defaultProps",{...re.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),g(Gt,"COPY_SRC",1),g(Gt,"COPY_DST",2),g(Gt,"TEXTURE_BINDING",4),g(Gt,"STORAGE_BINDING",8),g(Gt,"RENDER_ATTACHMENT",16);let dt=Gt;const yl=class yl extends re{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,yl.defaultProps)}};g(yl,"defaultProps",{...re.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let el=yl;function rb(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=lv(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=Bg(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=Bg(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Bg(t,e,n,r){if(r!=null&&r.inlineSource){const i=ib(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function ib(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=lv(s,e,n))}return r}function lv(t,e,n){const r=n!=null&&n.html?ob(t):t;return`${sb(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function sb(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function ob(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function cv(t,e){return{name:ab(t,e),language:"glsl",version:lb(t)}}function ab(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function lb(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const vl=class vl extends re{constructor(n,r){super(n,{id:cb(r),...r},vl.defaultProps);g(this,"stage");g(this,"source");g(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=cv(this.source).name,i=`${this.stage} ${r}`;let s=rb(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};g(vl,"defaultProps",{...re.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let tl=vl;function cb(t){return cv(t.source).name||t.id||Pr(`unnamed ${t.stage}-shader`)}const Tl=class Tl extends re{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,Tl.defaultProps)}};g(Tl,"defaultProps",{...re.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let nl=Tl;const El=class El extends re{constructor(n,r={}){super(n,r,El.defaultProps);g(this,"width");g(this,"height");g(this,"colorAttachments",[]);g(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(B.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof dt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof dt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:dt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:dt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};g(El,"defaultProps",{...re.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let rl=El;const Sl=class Sl extends re{constructor(n,r){super(n,r,Sl.defaultProps);g(this,"shaderLayout");g(this,"bufferLayout");g(this,"linkStatus","pending");g(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};g(Sl,"defaultProps",{...re.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Pi=Sl;const wl=class wl extends re{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,wl.defaultProps)}};g(wl,"defaultProps",{...re.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let If=wl;const Al=class Al extends re{constructor(n,r){super(n,r,Al.defaultProps);g(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};g(Al,"defaultProps",{...re.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let il=Al;const Rl=class Rl extends re{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Rl.defaultProps)}};g(Rl,"defaultProps",{...re.defaultProps,measureExecutionTime:void 0});let Mf=Rl;const bl=class bl extends re{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,bl.defaultProps)}};g(bl,"defaultProps",{...re.defaultProps});let Nf=bl;function ub(t){const[e,n]=hb[t],r=e==="i32"||e==="u32",i=e!=="u32",s=db[e]*n,o=fb(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function fb(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const hb={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},db={f32:4,f16:2,i32:4,u32:4};function uv(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=ov(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function fv(t,e){const n={};for(const r of t.attributes)n[r.name]=gb(t,e,r.name);return n}function pb(t,e,n=16){const r=fv(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function gb(t,e,n){const r=_b(t,n),i=mb(e,n);if(!r)return null;const s=ub(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=uv(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function _b(t,e){const n=t.attributes.find(r=>r.name===e);return n||B.warn(`shader layout attribute "${e}" not present in shader`),n||null}function mb(t,e){yb(t);let n=vb(t,e);return n||(n=Tb(t,e),n)?n:(B.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function yb(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&B.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function vb(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function Tb(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=uv(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function Eb(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):B.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const Cl=class Cl extends re{constructor(n,r){super(n,r,Cl.defaultProps);g(this,"maxVertexAttributes");g(this,"attributeInfos");g(this,"indexBuffer",null);g(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=pb(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};g(Cl,"defaultProps",{...re.defaultProps,renderPipeline:null});let kf=Cl;const Pl=class Pl extends re{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Pl.defaultProps)}};g(Pl,"defaultProps",{...re.defaultProps,layout:void 0,buffers:{}});let Of=Pl;const xl=class xl extends re{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,xl.defaultProps)}};g(xl,"defaultProps",{...re.defaultProps,type:void 0,count:void 0});let Ff=xl;const Sb={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function wb(t){const e=Sb[t];return oe(t),e}function Ab(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Ko;function hv(t){return(!Ko||Ko.byteLength<t)&&(Ko=new ArrayBuffer(t)),Ko}function Rb(t,e){const n=hv(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function bb(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const Ug=1024;class Cb{constructor(e){g(this,"layout",{});g(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=wb(s),{type:a,components:l}=o;n=Ab(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,Ug)}getData(e){const n=Math.max(this.byteLength,Ug),r=hv(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){B.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){B.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}f[u]=Number(o)}else{const h=Gs(o);if(!h){B.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}f.set(h,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Pb(t,e,n=16){if(t!==e)return!1;const r=Gs(t);if(!r)return!1;const i=Gs(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function xb(t){const e=Gs(t);return e?e.slice():t}class Ib{constructor(e){g(this,"name");g(this,"uniforms",{});g(this,"modifiedUniforms",{});g(this,"modified",!0);g(this,"bindingLayout",{});g(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){Pb(this.uniforms[e],n)||(this.uniforms[e]=xb(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Mb{constructor(e){g(this,"uniformBlocks",new Map);g(this,"uniformBufferLayouts",new Map);g(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new Cb(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new Ib({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:fe.UNIFORM|fe.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:fe.UNIFORM|fe.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&B.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();B.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function dv(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function pv(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function Nb(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=dv(t);if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function kb(t){return Gs(t)!==null||typeof t=="number"||typeof t=="boolean"}function md(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];kb(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function Ob(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?`${t}.${r[a]}`:"N/A";B.removed(`${t}.${a}`,c)()}for(const a in i)if(a in e){const l=i[a];B.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(B.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let Fb="";async function Db(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:Fb+t}catch(i){r(i)}})}async function gv(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function Df(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Df(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Df(t[s],e[s],n-1))return!1;return!0}return!1}function Bb(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Ub(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class Lb{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class dn{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(sl.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(ol.instance)}}}class sl extends dn{}sl.instance=new sl;class ol extends dn{}ol.instance=new ol;class he extends dn{constructor(){super()}}class Bf extends he{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class Vb extends he{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class zb extends he{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class jb extends he{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Hb extends he{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class nr extends he{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class _v extends he{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Uf extends he{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Lg extends he{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var xi;(function(t){t.increment="++",t.decrement="--"})(xi||(xi={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(xi||(xi={}));class Wb extends he{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var eo;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(eo||(eo={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(eo||(eo={}));class $b extends he{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class mv extends he{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class Xb extends he{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class Yb extends he{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class Kb extends he{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class qb extends he{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Zb extends he{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Qb extends he{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Jb extends he{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class yv extends he{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class Gb extends he{constructor(){super()}get astNodeType(){return"discard"}}class e3 extends he{constructor(){super()}get astNodeType(){return"break"}}class t3 extends he{constructor(){super()}get astNodeType(){return"continue"}}class xr extends he{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class tr extends xr{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class vv extends xr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class n3 extends xr{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Tv extends xr{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class gs extends xr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class It extends dn{constructor(){super()}}class Vg extends It{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ti extends It{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){e(this);for(const n of this.args)n.search(e)}}class Ev extends It{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Lf extends It{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class zg extends It{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof ti){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class jg extends It{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class r3 extends It{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class i3 extends It{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class Hg extends It{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class s3 extends It{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Sv extends It{constructor(){super()}}class o3 extends Sv{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Ft extends Sv{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class wv extends dn{constructor(){super()}}class a3 extends wv{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class l3 extends wv{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class c3 extends dn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class u3 extends dn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class f3 extends dn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let h3=class extends dn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var P,R;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(R||(R={}));class b{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class T{}P=T;T.none=new b("",R.reserved,"");T.eof=new b("EOF",R.token,"");T.reserved={asm:new b("asm",R.reserved,"asm"),bf16:new b("bf16",R.reserved,"bf16"),do:new b("do",R.reserved,"do"),enum:new b("enum",R.reserved,"enum"),f16:new b("f16",R.reserved,"f16"),f64:new b("f64",R.reserved,"f64"),handle:new b("handle",R.reserved,"handle"),i8:new b("i8",R.reserved,"i8"),i16:new b("i16",R.reserved,"i16"),i64:new b("i64",R.reserved,"i64"),mat:new b("mat",R.reserved,"mat"),premerge:new b("premerge",R.reserved,"premerge"),regardless:new b("regardless",R.reserved,"regardless"),typedef:new b("typedef",R.reserved,"typedef"),u8:new b("u8",R.reserved,"u8"),u16:new b("u16",R.reserved,"u16"),u64:new b("u64",R.reserved,"u64"),unless:new b("unless",R.reserved,"unless"),using:new b("using",R.reserved,"using"),vec:new b("vec",R.reserved,"vec"),void:new b("void",R.reserved,"void")};T.keywords={array:new b("array",R.keyword,"array"),atomic:new b("atomic",R.keyword,"atomic"),bool:new b("bool",R.keyword,"bool"),f32:new b("f32",R.keyword,"f32"),i32:new b("i32",R.keyword,"i32"),mat2x2:new b("mat2x2",R.keyword,"mat2x2"),mat2x3:new b("mat2x3",R.keyword,"mat2x3"),mat2x4:new b("mat2x4",R.keyword,"mat2x4"),mat3x2:new b("mat3x2",R.keyword,"mat3x2"),mat3x3:new b("mat3x3",R.keyword,"mat3x3"),mat3x4:new b("mat3x4",R.keyword,"mat3x4"),mat4x2:new b("mat4x2",R.keyword,"mat4x2"),mat4x3:new b("mat4x3",R.keyword,"mat4x3"),mat4x4:new b("mat4x4",R.keyword,"mat4x4"),ptr:new b("ptr",R.keyword,"ptr"),sampler:new b("sampler",R.keyword,"sampler"),sampler_comparison:new b("sampler_comparison",R.keyword,"sampler_comparison"),struct:new b("struct",R.keyword,"struct"),texture_1d:new b("texture_1d",R.keyword,"texture_1d"),texture_2d:new b("texture_2d",R.keyword,"texture_2d"),texture_2d_array:new b("texture_2d_array",R.keyword,"texture_2d_array"),texture_3d:new b("texture_3d",R.keyword,"texture_3d"),texture_cube:new b("texture_cube",R.keyword,"texture_cube"),texture_cube_array:new b("texture_cube_array",R.keyword,"texture_cube_array"),texture_multisampled_2d:new b("texture_multisampled_2d",R.keyword,"texture_multisampled_2d"),texture_storage_1d:new b("texture_storage_1d",R.keyword,"texture_storage_1d"),texture_storage_2d:new b("texture_storage_2d",R.keyword,"texture_storage_2d"),texture_storage_2d_array:new b("texture_storage_2d_array",R.keyword,"texture_storage_2d_array"),texture_storage_3d:new b("texture_storage_3d",R.keyword,"texture_storage_3d"),texture_depth_2d:new b("texture_depth_2d",R.keyword,"texture_depth_2d"),texture_depth_2d_array:new b("texture_depth_2d_array",R.keyword,"texture_depth_2d_array"),texture_depth_cube:new b("texture_depth_cube",R.keyword,"texture_depth_cube"),texture_depth_cube_array:new b("texture_depth_cube_array",R.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new b("texture_depth_multisampled_2d",R.keyword,"texture_depth_multisampled_2d"),texture_external:new b("texture_external",R.keyword,"texture_external"),u32:new b("u32",R.keyword,"u32"),vec2:new b("vec2",R.keyword,"vec2"),vec3:new b("vec3",R.keyword,"vec3"),vec4:new b("vec4",R.keyword,"vec4"),bitcast:new b("bitcast",R.keyword,"bitcast"),block:new b("block",R.keyword,"block"),break:new b("break",R.keyword,"break"),case:new b("case",R.keyword,"case"),continue:new b("continue",R.keyword,"continue"),continuing:new b("continuing",R.keyword,"continuing"),default:new b("default",R.keyword,"default"),diagnostic:new b("diagnostic",R.keyword,"diagnostic"),discard:new b("discard",R.keyword,"discard"),else:new b("else",R.keyword,"else"),enable:new b("enable",R.keyword,"enable"),fallthrough:new b("fallthrough",R.keyword,"fallthrough"),false:new b("false",R.keyword,"false"),fn:new b("fn",R.keyword,"fn"),for:new b("for",R.keyword,"for"),function:new b("function",R.keyword,"function"),if:new b("if",R.keyword,"if"),let:new b("let",R.keyword,"let"),const:new b("const",R.keyword,"const"),loop:new b("loop",R.keyword,"loop"),while:new b("while",R.keyword,"while"),private:new b("private",R.keyword,"private"),read:new b("read",R.keyword,"read"),read_write:new b("read_write",R.keyword,"read_write"),return:new b("return",R.keyword,"return"),requires:new b("requires",R.keyword,"requires"),storage:new b("storage",R.keyword,"storage"),switch:new b("switch",R.keyword,"switch"),true:new b("true",R.keyword,"true"),alias:new b("alias",R.keyword,"alias"),type:new b("type",R.keyword,"type"),uniform:new b("uniform",R.keyword,"uniform"),var:new b("var",R.keyword,"var"),override:new b("override",R.keyword,"override"),workgroup:new b("workgroup",R.keyword,"workgroup"),write:new b("write",R.keyword,"write"),r8unorm:new b("r8unorm",R.keyword,"r8unorm"),r8snorm:new b("r8snorm",R.keyword,"r8snorm"),r8uint:new b("r8uint",R.keyword,"r8uint"),r8sint:new b("r8sint",R.keyword,"r8sint"),r16uint:new b("r16uint",R.keyword,"r16uint"),r16sint:new b("r16sint",R.keyword,"r16sint"),r16float:new b("r16float",R.keyword,"r16float"),rg8unorm:new b("rg8unorm",R.keyword,"rg8unorm"),rg8snorm:new b("rg8snorm",R.keyword,"rg8snorm"),rg8uint:new b("rg8uint",R.keyword,"rg8uint"),rg8sint:new b("rg8sint",R.keyword,"rg8sint"),r32uint:new b("r32uint",R.keyword,"r32uint"),r32sint:new b("r32sint",R.keyword,"r32sint"),r32float:new b("r32float",R.keyword,"r32float"),rg16uint:new b("rg16uint",R.keyword,"rg16uint"),rg16sint:new b("rg16sint",R.keyword,"rg16sint"),rg16float:new b("rg16float",R.keyword,"rg16float"),rgba8unorm:new b("rgba8unorm",R.keyword,"rgba8unorm"),rgba8unorm_srgb:new b("rgba8unorm_srgb",R.keyword,"rgba8unorm_srgb"),rgba8snorm:new b("rgba8snorm",R.keyword,"rgba8snorm"),rgba8uint:new b("rgba8uint",R.keyword,"rgba8uint"),rgba8sint:new b("rgba8sint",R.keyword,"rgba8sint"),bgra8unorm:new b("bgra8unorm",R.keyword,"bgra8unorm"),bgra8unorm_srgb:new b("bgra8unorm_srgb",R.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new b("rgb10a2unorm",R.keyword,"rgb10a2unorm"),rg11b10float:new b("rg11b10float",R.keyword,"rg11b10float"),rg32uint:new b("rg32uint",R.keyword,"rg32uint"),rg32sint:new b("rg32sint",R.keyword,"rg32sint"),rg32float:new b("rg32float",R.keyword,"rg32float"),rgba16uint:new b("rgba16uint",R.keyword,"rgba16uint"),rgba16sint:new b("rgba16sint",R.keyword,"rgba16sint"),rgba16float:new b("rgba16float",R.keyword,"rgba16float"),rgba32uint:new b("rgba32uint",R.keyword,"rgba32uint"),rgba32sint:new b("rgba32sint",R.keyword,"rgba32sint"),rgba32float:new b("rgba32float",R.keyword,"rgba32float"),static_assert:new b("static_assert",R.keyword,"static_assert")};T.tokens={decimal_float_literal:new b("decimal_float_literal",R.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new b("hex_float_literal",R.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new b("int_literal",R.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new b("uint_literal",R.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new b("ident",R.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new b("and",R.token,"&"),and_and:new b("and_and",R.token,"&&"),arrow:new b("arrow ",R.token,"->"),attr:new b("attr",R.token,"@"),forward_slash:new b("forward_slash",R.token,"/"),bang:new b("bang",R.token,"!"),bracket_left:new b("bracket_left",R.token,"["),bracket_right:new b("bracket_right",R.token,"]"),brace_left:new b("brace_left",R.token,"{"),brace_right:new b("brace_right",R.token,"}"),colon:new b("colon",R.token,":"),comma:new b("comma",R.token,","),equal:new b("equal",R.token,"="),equal_equal:new b("equal_equal",R.token,"=="),not_equal:new b("not_equal",R.token,"!="),greater_than:new b("greater_than",R.token,">"),greater_than_equal:new b("greater_than_equal",R.token,">="),shift_right:new b("shift_right",R.token,">>"),less_than:new b("less_than",R.token,"<"),less_than_equal:new b("less_than_equal",R.token,"<="),shift_left:new b("shift_left",R.token,"<<"),modulo:new b("modulo",R.token,"%"),minus:new b("minus",R.token,"-"),minus_minus:new b("minus_minus",R.token,"--"),period:new b("period",R.token,"."),plus:new b("plus",R.token,"+"),plus_plus:new b("plus_plus",R.token,"++"),or:new b("or",R.token,"|"),or_or:new b("or_or",R.token,"||"),paren_left:new b("paren_left",R.token,"("),paren_right:new b("paren_right",R.token,")"),semicolon:new b("semicolon",R.token,";"),star:new b("star",R.token,"*"),tilde:new b("tilde",R.token,"~"),underscore:new b("underscore",R.token,"_"),xor:new b("xor",R.token,"^"),plus_equal:new b("plus_equal",R.token,"+="),minus_equal:new b("minus_equal",R.token,"-="),times_equal:new b("times_equal",R.token,"*="),division_equal:new b("division_equal",R.token,"/="),modulo_equal:new b("modulo_equal",R.token,"%="),and_equal:new b("and_equal",R.token,"&="),or_equal:new b("or_equal",R.token,"|="),xor_equal:new b("xor_equal",R.token,"^="),shift_right_equal:new b("shift_right_equal",R.token,">>="),shift_left_equal:new b("shift_left_equal",R.token,"<<=")};T.simpleTokens={"@":P.tokens.attr,"{":P.tokens.brace_left,"}":P.tokens.brace_right,":":P.tokens.colon,",":P.tokens.comma,"(":P.tokens.paren_left,")":P.tokens.paren_right,";":P.tokens.semicolon};T.literalTokens={"&":P.tokens.and,"&&":P.tokens.and_and,"->":P.tokens.arrow,"/":P.tokens.forward_slash,"!":P.tokens.bang,"[":P.tokens.bracket_left,"]":P.tokens.bracket_right,"=":P.tokens.equal,"==":P.tokens.equal_equal,"!=":P.tokens.not_equal,">":P.tokens.greater_than,">=":P.tokens.greater_than_equal,">>":P.tokens.shift_right,"<":P.tokens.less_than,"<=":P.tokens.less_than_equal,"<<":P.tokens.shift_left,"%":P.tokens.modulo,"-":P.tokens.minus,"--":P.tokens.minus_minus,".":P.tokens.period,"+":P.tokens.plus,"++":P.tokens.plus_plus,"|":P.tokens.or,"||":P.tokens.or_or,"*":P.tokens.star,"~":P.tokens.tilde,_:P.tokens.underscore,"^":P.tokens.xor,"+=":P.tokens.plus_equal,"-=":P.tokens.minus_equal,"*=":P.tokens.times_equal,"/=":P.tokens.division_equal,"%=":P.tokens.modulo_equal,"&=":P.tokens.and_equal,"|=":P.tokens.or_equal,"^=":P.tokens.xor_equal,">>=":P.tokens.shift_right_equal,"<<=":P.tokens.shift_left_equal};T.regexTokens={decimal_float_literal:P.tokens.decimal_float_literal,hex_float_literal:P.tokens.hex_float_literal,int_literal:P.tokens.int_literal,uint_literal:P.tokens.uint_literal,ident:P.tokens.ident};T.storage_class=[P.keywords.function,P.keywords.private,P.keywords.workgroup,P.keywords.uniform,P.keywords.storage];T.access_mode=[P.keywords.read,P.keywords.write,P.keywords.read_write];T.sampler_type=[P.keywords.sampler,P.keywords.sampler_comparison];T.sampled_texture_type=[P.keywords.texture_1d,P.keywords.texture_2d,P.keywords.texture_2d_array,P.keywords.texture_3d,P.keywords.texture_cube,P.keywords.texture_cube_array];T.multisampled_texture_type=[P.keywords.texture_multisampled_2d];T.storage_texture_type=[P.keywords.texture_storage_1d,P.keywords.texture_storage_2d,P.keywords.texture_storage_2d_array,P.keywords.texture_storage_3d];T.depth_texture_type=[P.keywords.texture_depth_2d,P.keywords.texture_depth_2d_array,P.keywords.texture_depth_cube,P.keywords.texture_depth_cube_array,P.keywords.texture_depth_multisampled_2d];T.texture_external_type=[P.keywords.texture_external];T.any_texture_type=[...P.sampled_texture_type,...P.multisampled_texture_type,...P.storage_texture_type,...P.depth_texture_type,...P.texture_external_type];T.texel_format=[P.keywords.r8unorm,P.keywords.r8snorm,P.keywords.r8uint,P.keywords.r8sint,P.keywords.r16uint,P.keywords.r16sint,P.keywords.r16float,P.keywords.rg8unorm,P.keywords.rg8snorm,P.keywords.rg8uint,P.keywords.rg8sint,P.keywords.r32uint,P.keywords.r32sint,P.keywords.r32float,P.keywords.rg16uint,P.keywords.rg16sint,P.keywords.rg16float,P.keywords.rgba8unorm,P.keywords.rgba8unorm_srgb,P.keywords.rgba8snorm,P.keywords.rgba8uint,P.keywords.rgba8sint,P.keywords.bgra8unorm,P.keywords.bgra8unorm_srgb,P.keywords.rgb10a2unorm,P.keywords.rg11b10float,P.keywords.rg32uint,P.keywords.rg32sint,P.keywords.rg32float,P.keywords.rgba16uint,P.keywords.rgba16sint,P.keywords.rgba16float,P.keywords.rgba32uint,P.keywords.rgba32sint,P.keywords.rgba32float];T.const_literal=[P.tokens.int_literal,P.tokens.uint_literal,P.tokens.decimal_float_literal,P.tokens.hex_float_literal,P.keywords.true,P.keywords.false];T.literal_or_ident=[P.tokens.ident,P.tokens.int_literal,P.tokens.uint_literal,P.tokens.decimal_float_literal,P.tokens.hex_float_literal];T.element_count_expression=[P.tokens.int_literal,P.tokens.uint_literal,P.tokens.ident];T.template_types=[P.keywords.vec2,P.keywords.vec3,P.keywords.vec4,P.keywords.mat2x2,P.keywords.mat2x3,P.keywords.mat2x4,P.keywords.mat3x2,P.keywords.mat3x3,P.keywords.mat3x4,P.keywords.mat4x2,P.keywords.mat4x3,P.keywords.mat4x4,P.keywords.atomic,P.keywords.bitcast,...P.any_texture_type];T.attribute_name=[P.tokens.ident,P.keywords.block,P.keywords.diagnostic];T.assignment_operators=[P.tokens.equal,P.tokens.plus_equal,P.tokens.minus_equal,P.tokens.times_equal,P.tokens.division_equal,P.tokens.modulo_equal,P.tokens.and_equal,P.tokens.or_equal,P.tokens.xor_equal,P.tokens.shift_right_equal,P.tokens.shift_left_equal];T.increment_operators=[P.tokens.plus_plus,P.tokens.minus_minus];class Wg{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return T.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==T.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class d3{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Wg(T.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=T.simpleTokens[e];if(n)return this._addToken(n),!0;let r=T.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=T.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(T.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&T.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===T.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===T.none){let l=e,c=0;const u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),o=this._findType(l),o!==T.none){c=f;break}if(o===T.none)return r===T.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===T.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in T.regexTokens){const i=T.regexTokens[r];if(this._match(e,i.rule))return i}const n=T.literalTokens[e];return n||T.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Wg(e,n,this._line))}}class p3{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Lb,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Lf){const a=s.name,l=this._context.constants.get(a);if(l)try{const c=l.evaluate(this._context);i.count=c}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new d3(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==T.eof}_match(e){if(e instanceof b)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._match(T.keywords.alias)){const n=this._type_alias();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.diagnostic)){const n=this._diagnostic();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.requires)){const n=this._requires_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),n}if(this._match(T.keywords.enable)){const n=this._enable_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(T.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),n}if(this._check(T.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(T.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(T.keywords.fn))return null;const e=this._currentLine,n=this._consume(T.tokens.ident,"Expected function name.").toString();this._consume(T.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(T.tokens.paren_right))do{if(this._check(T.tokens.paren_right))break;const a=this._attribute(),l=this._consume(T.tokens.ident,"Expected argument name.").toString();this._consume(T.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(new c3(l,u,a)))}while(this._match(T.tokens.comma));this._consume(T.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(T.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new Bf(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(T.tokens.brace_left,"Expected '{' for block.");!this._check(T.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(T.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._check(T.tokens.attr)&&this._attribute(),this._check(T.keywords.if))return this._if_statement();if(this._check(T.keywords.switch))return this._switch_statement();if(this._check(T.keywords.loop))return this._loop_statement();if(this._check(T.keywords.for))return this._for_statement();if(this._check(T.keywords.while))return this._while_statement();if(this._check(T.keywords.continuing))return this._continuing_statement();if(this._check(T.keywords.static_assert))return this._static_assert_statement();if(this._check(T.tokens.brace_left))return this._compound_statement();let e=null;return this._check(T.keywords.return)?e=this._return_statement():this._check([T.keywords.var,T.keywords.let,T.keywords.const])?e=this._variable_statement():this._match(T.keywords.discard)?e=new Gb:this._match(T.keywords.break)?e=new e3:this._match(T.keywords.continue)?e=new t3:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(T.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(T.keywords.static_assert))return null;const e=this._optional_paren_expression();return new Vb(e)}_while_statement(){if(!this._match(T.keywords.while))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute();const n=this._compound_statement();return new zb(e,n)}_continuing_statement(){if(!this._match(T.keywords.continuing))return null;const e=this._compound_statement();return new jb(e)}_for_statement(){if(!this._match(T.keywords.for))return null;this._consume(T.tokens.paren_left,"Expected '('.");const e=this._check(T.tokens.semicolon)?null:this._for_init();this._consume(T.tokens.semicolon,"Expected ';'.");const n=this._check(T.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(T.tokens.semicolon,"Expected ';'.");const r=this._check(T.tokens.paren_right)?null:this._for_increment();this._consume(T.tokens.paren_right,"Expected ')'."),this._check(T.tokens.attr)&&this._attribute();const i=this._compound_statement();return new Hb(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(T.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(T.tokens.equal)&&(n=this._short_circuit_or_expression()),new nr(e.name,e.type,e.storage,e.access,n)}if(this._match(T.keywords.let)){const e=this._consume(T.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(T.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Uf(e,n,null,null,r)}if(this._match(T.keywords.const)){const e=this._consume(T.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(T.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Lg(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(T.increment_operators))return this._current=e,null;const r=this._consume(T.increment_operators,"Expected increment operator");return new Wb(r.type===T.tokens.plus_plus?xi.increment:xi.decrement,n)}_assignment_statement(){let e=null;if(this._check(T.tokens.brace_right))return null;let n=this._match(T.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(T.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new $b(eo.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(T.tokens.ident))return null;const e=this._current,n=this._consume(T.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new mv(n.lexeme,r)}_loop_statement(){if(!this._match(T.keywords.loop))return null;this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(T.keywords.continuing)&&(r=this._compound_statement()),this._consume(T.tokens.brace_right,"Expected '}' for loop."),new Xb(e,r)}_switch_statement(){if(!this._match(T.keywords.switch))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(T.tokens.brace_right,"Expected '}' for switch."),new Yb(e,n)}_switch_body(){const e=[];if(this._match(T.keywords.case)){const n=this._case_selectors();this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch case."),e.push(new a3(n,r))}if(this._match(T.keywords.default)){this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch default."),e.push(new l3(n))}if(this._check([T.keywords.default,T.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(T.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(T.keywords.fallthrough))return this._consume(T.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(T.keywords.if))return null;const e=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(T.keywords.else)&&(this._check(T.tokens.attr)&&this._attribute(),i=this._compound_statement()),new Kb(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===T.keywords.else&&this._tokens[this._current+1].type===T.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new u3(n,r)),this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(T.keywords.return))return null;const e=this._short_circuit_or_expression();return new qb(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(T.tokens.or_or);)e=new Ft(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(T.tokens.and_and);)e=new Ft(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(T.tokens.or);)e=new Ft(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(T.tokens.xor);)e=new Ft(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(T.tokens.and);)e=new Ft(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([T.tokens.equal_equal,T.tokens.not_equal])?new Ft(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([T.tokens.less_than,T.tokens.greater_than,T.tokens.less_than_equal,T.tokens.greater_than_equal]);)e=new Ft(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([T.tokens.shift_left,T.tokens.shift_right]);)e=new Ft(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([T.tokens.plus,T.tokens.minus]);)e=new Ft(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([T.tokens.star,T.tokens.forward_slash,T.tokens.modulo]);)e=new Ft(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([T.tokens.minus,T.tokens.bang,T.tokens.tilde,T.tokens.star,T.tokens.and])?new o3(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(T.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(T.tokens.bracket_right,"Expected ']'.");const n=new s3(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(T.tokens.period)){const e=this._consume(T.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new Vg(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(T.tokens.ident)){const r=this._previous().toString();if(this._check(T.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new ti(s,i):new Ev(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new zg(r,i.value)}return new Lf(r)}if(this._match(T.const_literal))return new jg(parseFloat(this._previous().toString()));if(this._check(T.tokens.paren_left))return this._paren_expression();if(this._match(T.keywords.bitcast)){this._consume(T.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(T.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new r3(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new i3(e,n)}_argument_expression_list(){if(!this._match(T.tokens.paren_left))return null;const e=[];do{if(this._check(T.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(T.tokens.comma));return this._consume(T.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(T.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(T.tokens.paren_right),new Hg([e])}_paren_expression(){this._consume(T.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(T.tokens.paren_right,"Expected ')'."),new Hg([e])}_struct_decl(){if(!this._match(T.keywords.struct))return null;const e=this._currentLine,n=this._consume(T.tokens.ident,"Expected name for struct.").toString();this._consume(T.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(T.tokens.brace_right);){const o=this._attribute(),a=this._consume(T.tokens.ident,"Expected variable name.").toString();this._consume(T.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(T.tokens.brace_right)?this._match(T.tokens.comma):this._consume(T.tokens.comma,"Expected ',' for struct member."),r.push(new f3(a,c,o))}this._consume(T.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new tr(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(T.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(T.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(T.keywords.const))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(T.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof ti)r=s;else if(s instanceof zg&&s.initializer instanceof ti)r=s.initializer;else try{const o=s.evaluate(this._context);r=new jg(o)}catch{r=s}}const i=new Lg(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(T.keywords.let))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(T.tokens.equal)&&(r=this._const_expression()),new Uf(e.toString(),n,"","",r)}_const_expression(){if(this._match(T.const_literal))return new Vg(this._previous().toString());const e=this._type_decl();this._consume(T.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(T.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(T.tokens.comma));)this._advance();return this._consume(T.tokens.paren_right,"Expected ')'."),new ti(e,n)}_variable_decl(){if(!this._match(T.keywords.var))return null;let e="",n="";this._match(T.tokens.less_than)&&(e=this._consume(T.storage_class,"Expected storage_class.").toString(),this._match(T.tokens.comma)&&(n=this._consume(T.access_mode,"Expected access_mode.").toString()),this._consume(T.tokens.greater_than,"Expected '>'."));const r=this._consume(T.tokens.ident,"Expected variable name");let i=null;if(this._match(T.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new nr(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(T.keywords.override))return null;const e=this._consume(T.tokens.ident,"Expected variable name");let n=null;if(this._match(T.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new _v(e.toString(),n,null)}_diagnostic(){this._consume(T.tokens.paren_left,"Expected '('");const e=this._consume(T.tokens.ident,"Expected severity control name.");this._consume(T.tokens.comma,"Expected ','");const n=this._consume(T.tokens.ident,"Expected diagnostic rule name.");return this._consume(T.tokens.paren_right,"Expected ')'"),new Jb(e.toString(),n.toString())}_enable_directive(){const e=this._consume(T.tokens.ident,"identity expected.");return new Zb(e.toString())}_requires_directive(){const e=[this._consume(T.tokens.ident,"identity expected.").toString()];for(;this._match(T.tokens.comma);){const n=this._consume(T.tokens.ident,"identity expected.");e.push(n.toString())}return new Qb(e)}_type_alias(){const e=this._consume(T.tokens.ident,"identity expected.");this._consume(T.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new yv(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([T.tokens.ident,...T.texel_format,T.keywords.bool,T.keywords.f32,T.keywords.i32,T.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new xr(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(T.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(T.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(T.tokens.comma)&&(s=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for type.")),new vv(r,i,s)}if(this._match(T.keywords.ptr)){let r=this._previous().toString();this._consume(T.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(T.storage_class,"Expected storage_class for pointer");this._consume(T.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(T.tokens.comma)&&(o=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for pointer."),new n3(r,i.toString(),s,o)}const n=this._attribute();if(this._match(T.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(T.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(T.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(T.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new Tv(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(T.sampler_type))return new gs(this._previous().toString(),null,null);if(this._match(T.depth_texture_type))return new gs(this._previous().toString(),null,null);if(this._match(T.sampled_texture_type)||this._match(T.multisampled_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),new gs(e.toString(),n,null)}if(this._match(T.storage_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(T.texel_format,"Invalid texel format.").toString();this._consume(T.tokens.comma,"Expected ',' after texel format.");const r=this._consume(T.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),new gs(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(T.tokens.attr);){const n=this._consume(T.attribute_name,"Expected attribute name"),r=new h3(n.toString(),null);if(this._match(T.tokens.paren_left)){if(r.value=this._consume(T.literal_or_ident,"Expected attribute value").toString(),this._check(T.tokens.comma)){this._advance();do{const i=this._consume(T.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(T.tokens.comma))}this._consume(T.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class _i{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class $g{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qo extends _i{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class eu extends _i{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Xg extends _i{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var wn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(wn||(wn={}));class Zo{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class g3{constructor(e,n){this.name=e,this.type=n}}class Qo{constructor(e,n){this.align=e,this.size=n}}class _3{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Yg{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class m3{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class y3{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class v3{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class T3{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class sn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new y3,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new p3().parse(e);for(const i of r)i instanceof Bf&&this._functions.set(i.name,new T3(i));for(const i of r)if(i instanceof tr){const s=this._getTypeInfo(i,null);s instanceof qo&&this.structs.push(s)}for(const i of r){if(i instanceof yv){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof _v){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new v3(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Zo(s.name,l,o,a,s.attributes,wn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Zo(s.name,l,o,a,s.attributes,c?wn.StorageTexture:wn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Zo(s.name,l,o,a,s.attributes,c?wn.StorageTexture:wn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Zo(s.name,l,o,a,s.attributes,wn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof Bf){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,c=new m3(i.name,l==null?void 0:l.name);c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,l&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!l),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof sl)s.push({});else if(o instanceof ol)s.pop();else if(o instanceof nr){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof ti){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Uf){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Lf){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof Ev){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof mv){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof tr)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof tr)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new Yg(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Yg("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof tr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof tr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new _3(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new g3(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Tv){const i=e,s=this._getTypeInfo(i.format,i.attributes),o=new eu(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof tr){const i=e,s=new qo(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new $g(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof gs){const i=e,s=i.format instanceof xr,o=i.format?s?this._getTypeInfo(i.format,null):new _i(i.format,null):null,a=new Xg(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof vv){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new Xg(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new _i(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof eu){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof qo&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const f=u.align,h=u.size;r=this._roundUp(f,r+i),i=h,s=r,o=Math.max(o,f),c.offset=r,c.size=h,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof $g&&(e=e.type),e instanceof _i){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=sn._typeInfo[e.name];if(s!==void 0){const o=e.format==="f16"?2:1;return new Qo(Math.max(i,s.align/o),Math.max(r,s.size/o))}}{const s=sn._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const o=e.name[e.name.length-1]==="h"?2:1;return new Qo(Math.max(i,s.align/o),Math.max(r,s.size/o))}}if(e instanceof eu){let s=e,o=8,a=8;const l=this._getTypeSize(s.format);l!==null&&(a=l.size,o=l.align);const c=s.count,u=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=c*u,r&&(a=r),new Qo(Math.max(i,o),Math.max(r,a))}if(e instanceof qo){let s=0,o=0,a=0,l=0,c=0;for(const u of e.members){const f=this._getTypeSize(u.type);f!==null&&(s=Math.max(f.align,s),a=this._roundUp(f.align,a+l),l=f.size,c=a)}return o=this._roundUp(s,c+l),new Qo(Math.max(i,s),Math.max(r,o))}return null}_isUniformVar(e){return e instanceof nr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof nr&&e.storage=="storage"}_isTextureVar(e){return e instanceof nr&&e.type!==null&&sn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof nr&&e.type!==null&&sn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}sn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};sn._textureTypes=T.any_texture_type.map(t=>t.name);sn._samplerTypes=T.sampler_type.map(t=>t.name);function E3(t){var s;const e={attributes:[],bindings:[]};let n;try{n=S3(t)}catch(o){return B.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:Kg(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=Kg(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function Kg(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function S3(t){try{return new sn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const w3=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,A3={name:"fp32",vs:w3},R3=[0,1,1,1],b3=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,C3=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,qg={name:"picking",vs:b3,fs:C3,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:R3},getUniforms:P3};function P3(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function Av(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function x3(t){return t-Math.fround(t)}function I3(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;Av(t[r*4+n],e,i*2)}return e}const M3=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,N3={ONE:1};function k3(){return N3}const O3={name:"fp64-arithmetic",vs:M3,getUniforms:k3,fp64ify:Av,fp64LowPart:x3,fp64ifyMatrix4:I3},F3={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...F3}};const gt=globalThis.mathgl.config;function D3(t,{precision:e=gt.precision}={}){return t=B3(t),`${parseFloat(t.toPrecision(e))}`}function Ii(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function xn(t,e,n){return L3(t,r=>Math.max(e,Math.min(n,r)))}function al(t,e,n){return Ii(t)?t.map((r,i)=>al(r,e[i],n)):n*e+(1-n)*t}function to(t,e,n){const r=gt.EPSILON;try{if(t===e)return!0;if(Ii(t)&&Ii(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!to(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=gt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{gt.EPSILON=r}}function B3(t){return Math.round(t/gt.EPSILON)*gt.EPSILON}function U3(t){return t.clone?t.clone():new Array(t.length)}function L3(t,e,n){if(Ii(t)){const r=t;n=n||U3(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class Rv extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ii(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(gt)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+D3(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!to(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(gt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function V3(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function tt(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function tu(t,e,n=""){if(gt.debug&&!V3(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Zg(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class z3 extends Rv{get x(){return this[0]}set x(e){this[0]=tt(e)}get y(){return this[1]}set y(e){this[1]=tt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return tt(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return tt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Zg(e>=0&&e<this.ELEMENTS,"index is out of range"),tt(this[e])}setComponent(e,n){return Zg(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Ea=1e-6;let Mi=typeof Float32Array<"u"?Float32Array:Array;function j3(){const t=new Mi(2);return Mi!=Float32Array&&(t[0]=0,t[1]=0),t}function Qg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function H3(t,e){return t[0]=-e[0],t[1]=-e[1],t}function bv(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function W3(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=j3();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function $3(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function Cv(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function X3(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function Y3(){const t=new Mi(3);return Mi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function K3(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function q3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Z3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Q3(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function Pv(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function J3(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function G3(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,f=s*a-r*c,h=r*l-i*a,_=i*h-s*f,y=s*u-r*h,S=r*f-i*u;const C=o*2;return u*=C,f*=C,h*=C,_*=2,y*=2,S*=2,t[0]=a+u+_,t[1]=l+f+y,t[2]=c+h+S,t}function eC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function tC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function nC(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function rC(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&Z3(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const iC=K3;(function(){const t=Y3();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const nu=[0,0,0];let Jo;class Yt extends z3{static get ZERO(){return Jo||(Jo=new Yt(0,0,0),Object.freeze(Jo)),Jo}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Ii(e)?this.copy(e):(gt.debug&&(tt(e),tt(n),tt(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return gt.debug&&(tt(e.x),tt(e.y),tt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=tt(e)}angle(e){return rC(this,e)}cross(e){return Q3(this,this,e),this.check()}rotateX({radians:e,origin:n=nu}){return eC(this,this,n,e),this.check()}rotateY({radians:e,origin:n=nu}){return tC(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=nu}){return nC(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Pv(this,this,e),this.check()}transformAsVector(e){return Cv(this,this,e),this.check()}transformByMatrix3(e){return J3(this,this,e),this.check()}transformByMatrix2(e){return X3(this,this,e),this.check()}transformByQuaternion(e){return G3(this,this,e),this.check()}}class sC extends Rv{toString(){let e="[";if(gt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=tt(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function oC(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aC(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Vf(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],_=e[11],y=e[12],S=e[13],C=e[14],m=e[15],p=n*a-r*o,E=n*l-i*o,A=n*c-s*o,x=r*l-i*a,M=r*c-s*a,N=i*c-s*l,D=u*S-f*y,L=u*C-h*y,U=u*m-_*y,H=f*C-h*S,Q=f*m-_*S,ee=h*m-_*C;let q=p*ee-E*Q+A*H+x*U-M*L+N*D;return q?(q=1/q,t[0]=(a*ee-l*Q+c*H)*q,t[1]=(i*Q-r*ee-s*H)*q,t[2]=(S*N-C*M+m*x)*q,t[3]=(h*M-f*N-_*x)*q,t[4]=(l*U-o*ee-c*L)*q,t[5]=(n*ee-i*U+s*L)*q,t[6]=(C*A-y*N-m*E)*q,t[7]=(u*N-h*A+_*E)*q,t[8]=(o*Q-a*U+c*D)*q,t[9]=(r*U-n*Q-s*D)*q,t[10]=(y*M-S*A+m*p)*q,t[11]=(f*A-u*M-_*p)*q,t[12]=(a*L-o*H-l*D)*q,t[13]=(n*H-r*L+i*D)*q,t[14]=(S*E-y*x-C*p)*q,t[15]=(u*x-f*E+h*p)*q,t):null}function lC(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],_=t[12],y=t[13],S=t[14],C=t[15],m=e*o-n*s,p=e*a-r*s,E=n*a-r*o,A=c*y-u*_,x=c*S-f*_,M=u*S-f*y,N=e*M-n*x+r*A,D=s*M-o*x+a*A,L=c*E-u*p+f*m,U=_*E-y*p+S*m;return l*N-i*D+C*L-h*U}function pr(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],_=e[10],y=e[11],S=e[12],C=e[13],m=e[14],p=e[15];let E=n[0],A=n[1],x=n[2],M=n[3];return t[0]=E*r+A*a+x*f+M*S,t[1]=E*i+A*l+x*h+M*C,t[2]=E*s+A*c+x*_+M*m,t[3]=E*o+A*u+x*y+M*p,E=n[4],A=n[5],x=n[6],M=n[7],t[4]=E*r+A*a+x*f+M*S,t[5]=E*i+A*l+x*h+M*C,t[6]=E*s+A*c+x*_+M*m,t[7]=E*o+A*u+x*y+M*p,E=n[8],A=n[9],x=n[10],M=n[11],t[8]=E*r+A*a+x*f+M*S,t[9]=E*i+A*l+x*h+M*C,t[10]=E*s+A*c+x*_+M*m,t[11]=E*o+A*u+x*y+M*p,E=n[12],A=n[13],x=n[14],M=n[15],t[12]=E*r+A*a+x*f+M*S,t[13]=E*i+A*l+x*h+M*C,t[14]=E*s+A*c+x*_+M*m,t[15]=E*o+A*u+x*y+M*p,t}function ll(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,f,h,_,y,S,C,m;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],_=e[7],y=e[8],S=e[9],C=e[10],m=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=_,t[8]=y,t[9]=S,t[10]=C,t[11]=m,t[12]=o*r+u*i+y*s+e[12],t[13]=a*r+f*i+S*s+e[13],t[14]=l*r+h*i+C*s+e[14],t[15]=c*r+_*i+m*s+e[15]),t}function yd(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function cC(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,f,h,_,y,S,C,m,p,E,A,x,M,N,D,L,U,H,Q,ee,q,at;return a<Ea?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],h=e[1],_=e[2],y=e[3],S=e[4],C=e[5],m=e[6],p=e[7],E=e[8],A=e[9],x=e[10],M=e[11],N=i*i*u+l,D=s*i*u+o*c,L=o*i*u-s*c,U=i*s*u-o*c,H=s*s*u+l,Q=o*s*u+i*c,ee=i*o*u+s*c,q=s*o*u-i*c,at=o*o*u+l,t[0]=f*N+S*D+E*L,t[1]=h*N+C*D+A*L,t[2]=_*N+m*D+x*L,t[3]=y*N+p*D+M*L,t[4]=f*U+S*H+E*Q,t[5]=h*U+C*H+A*Q,t[6]=_*U+m*H+x*Q,t[7]=y*U+p*H+M*Q,t[8]=f*ee+S*q+E*at,t[9]=h*ee+C*q+A*at,t[10]=_*ee+m*q+x*at,t[11]=y*ee+p*q+M*at,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function xv(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function uC(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function Iv(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function fC(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,f=r*a,h=i*o,_=i*a,y=i*l,S=s*o,C=s*a,m=s*l;return t[0]=1-f-y,t[1]=u+m,t[2]=h-C,t[3]=0,t[4]=u-m,t[5]=1-c-y,t[6]=_+S,t[7]=0,t[8]=h+C,t[9]=_-S,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hC(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function dC(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const pC=dC;function gC(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const _C=gC;function mC(t,e,n,r){let i,s,o,a,l,c,u,f,h,_;const y=e[0],S=e[1],C=e[2],m=r[0],p=r[1],E=r[2],A=n[0],x=n[1],M=n[2];return Math.abs(y-A)<Ea&&Math.abs(S-x)<Ea&&Math.abs(C-M)<Ea?oC(t):(f=y-A,h=S-x,_=C-M,i=1/Math.sqrt(f*f+h*h+_*_),f*=i,h*=i,_*=i,s=p*_-E*h,o=E*f-m*_,a=m*h-p*f,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=h*a-_*o,c=_*s-f*a,u=f*o-h*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=_,t[11]=0,t[12]=-(s*y+o*S+a*C),t[13]=-(l*y+c*S+u*C),t[14]=-(f*y+h*S+_*C),t[15]=1,t)}function yC(){const t=new Mi(4);return Mi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vC(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function go(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=yC();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var zf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(zf||(zf={}));const TC=45*Math.PI/180,EC=1,ru=.1,iu=500,SC=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Kt extends sC{static get IDENTITY(){return AC()}static get ZERO(){return wC()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return zf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,f,h,_,y,S,C){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=_,this[13]=y,this[14]=S,this[15]=C,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,f,h,_,y,S,C){return this[0]=e,this[1]=s,this[2]=c,this[3]=_,this[4]=n,this[5]=o,this[6]=u,this[7]=y,this[8]=r,this[9]=a,this[10]=f,this[11]=S,this[12]=i,this[13]=l,this[14]=h,this[15]=C,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(SC)}fromObject(e){return this.check()}fromQuaternion(e){return fC(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=ru,far:a=iu}=e;return a===1/0?RC(this,n,r,i,s,o):hC(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return mC(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=ru,far:a=iu}=e;return _C(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=TC,aspect:r=EC,focalDistance:i=1,near:s=ru,far:o=iu}=e;Jg(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Jg(n),pC(this,n,r,i,s),this.check()}determinant(){return lC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return aC(this,this),this.check()}invert(){return Vf(this,this),this.check()}multiplyLeft(e){return pr(this,e,this),this.check()}multiplyRight(e){return pr(this,this,e),this.check()}rotateX(e){return xv(this,this,e),this.check()}rotateY(e){return uC(this,this,e),this.check()}rotateZ(e){return Iv(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return cC(this,this,e,n),this.check()}scale(e){return yd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ll(this,this,e),this.check()}transform(e,n){return e.length===4?(n=go(n||[-0,-0,-0,-0],e,this),tu(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=W3(n||[-0,-0],e,this);break;case 3:i=Pv(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return tu(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=$3(n||[-0,-0],e,this);break;case 3:r=Cv(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return tu(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Go,ea;function wC(){return Go||(Go=new Kt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Go)),Go}function AC(){return ea||(ea=new Kt,Object.freeze(ea)),ea}function Jg(t){if(t>Math.PI*2)throw Error("expected radians")}function RC(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const Mv="#define SMOOTH_EDGE_RADIUS 0.5",bC=`
${Mv}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,CC=`
${Mv}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,PC={name:"geometry",vs:bC,fs:CC},J={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(J,"IDENTITY",{get:()=>(se.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ht={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},jf={common:0,meters:1,pixels:2},Hf={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},xC=Object.keys(J).map(t=>`const int COORDINATE_SYSTEM_${t} = ${J[t]};`).join(""),IC=Object.keys(Ht).map(t=>`const int PROJECTION_MODE_${t} = ${Ht[t]};`).join(""),MC=Object.keys(jf).map(t=>`const int UNIT_${t.toUpperCase()} = ${jf[t]};`).join(""),NC=`${xC}
${IC}
${MC}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function kC(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function _o(t){let e={},n;return r=>{for(const i in r)if(!kC(r[i],e[i])){n=t(r),e=r;break}return n}}const Gg=[0,0,0,0],OC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Nv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FC=[0,0,0],kv=[0,0,0],DC=_o(LC);function Ov(t,e,n=kv){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===J.LNGLAT_OFFSETS||e===J.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Ht.WEB_MERCATOR:(e===J.LNGLAT||e===J.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Ht.WEB_MERCATOR_AUTO_OFFSET:e===J.LNGLAT?r=i:e===J.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Ht.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Ht.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function BC(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Gg,l=Gg,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=Ov(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=go([],l,o),s=r||s,o=pr([],i,s),o=pr([],o,OC)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function UC({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=J.DEFAULT,coordinateOrigin:i=kv,autoWrapLongitude:s=!1}){r===J.DEFAULT&&(r=t.isGeospatial?J.LNGLAT:J.CARTESIAN);const o=DC({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Nv,o}function LC({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=BC(t,n,r),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=go([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,_={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:FC,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Nv,project_uCameraPosition:a};if(c){const y=t.getDistanceScales(c);switch(n){case J.METER_OFFSETS:_.project_uCommonUnitsPerWorldUnit=y.unitsPerMeter,_.project_uCommonUnitsPerWorldUnit2=y.unitsPerMeter2;break;case J.LNGLAT:case J.LNGLAT_OFFSETS:t._pseudoMeters||(_.project_uCommonUnitsPerMeter=y.unitsPerMeter),_.project_uCommonUnitsPerWorldUnit=y.unitsPerDegree,_.project_uCommonUnitsPerWorldUnit2=y.unitsPerDegree2;break;case J.CARTESIAN:_.project_uCommonUnitsPerWorldUnit=[1,1,y.unitsPerMeter[2]],_.project_uCommonUnitsPerWorldUnit2=[0,0,y.unitsPerMeter2[2]];break}}return _}const VC={};function zC(t=VC){return"viewport"in t?UC(t):{}}const vd={name:"project",dependencies:[A3,PC],vs:NC,getUniforms:zC},jC=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,HC={name:"project32",dependencies:[vd],vs:jC};function WC(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mi(t,e){const n=go([],e,t);return vC(n,n,1/n[3]),n}function e_(t,e){const n=t%e;return n<0?e+n:n}function Wf(t,e,n){return t<e?e:t>n?n:t}function $C(t){return Math.log(t)*Math.LOG2E}const Td=Math.log2||$C;function fn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Rt=Math.PI,Fv=Rt/4,_t=Rt/180,$f=180/Rt,Ni=512,cl=4003e4,ta=85.051129,XC=1.5;function YC(t){return Td(t)}function ul(t){const[e,n]=t;fn(Number.isFinite(e)),fn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*_t,i=n*_t,s=Ni*(r+Rt)/(2*Rt),o=Ni*(Rt+Math.log(Math.tan(Fv+i*.5)))/(2*Rt);return[s,o]}function ki(t){const[e,n]=t,r=e/Ni*(2*Rt)-Rt,i=2*(Math.atan(Math.exp(n/Ni*(2*Rt)-Rt))-Fv);return[r*$f,i*$f]}function KC(t){const{latitude:e}=t;fn(Number.isFinite(e));const n=Math.cos(e*_t);return YC(cl*n)-9}function su(t){const e=Math.cos(t*_t);return Ni/cl/e}function Xf(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;fn(Number.isFinite(e)&&Number.isFinite(n));const i=Ni,s=Math.cos(e*_t),o=i/360,a=o/s,l=i/cl/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=_t*Math.tan(e*_t)/s,f=o*u/2,h=i/cl*u,_=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[_,0,_]}return c}function Dv(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Xf({longitude:n,latitude:r,highPrecision:!0}),u=ul(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=ki(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function qC(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=WC();ll(a,a,[0,0,-i]),xv(a,a,-n*_t),Iv(a,a,r*_t);const l=s/e;return yd(a,a,[l,l,l]),o&&ll(a,a,q3([],o)),a}function ZC(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=fl(XC)}=t;r!==void 0&&(u=fl(r));const f=u*_t,h=i*_t,_=Bv(u);let y=_;o&&(y+=o[2]*a/Math.cos(h)/n);const S=f*(.5+(s?s[1]:0)/n),C=Math.sin(S)*y/Math.sin(Wf(Math.PI/2-h-S,.01,Math.PI-.01)),m=Math.sin(h)*C+y,p=y*10,E=Math.min(m*c,p);return{fov:f,aspect:e/n,focalDistance:_,near:l,far:E}}function fl(t){return 2*Math.atan(.5/t)*$f}function Bv(t){return .5/Math.tan(.5*t*_t)}function Uv(t,e){const[n,r,i=0]=t;return fn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),mi(e,[n,r,i,1])}function Ed(t,e,n=0){const[r,i,s]=t;if(fn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return mi(e,[r,i,s,1]);const o=mi(e,[r,i,0,1]),a=mi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return bv([],o,a,u)}function QC(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,f=JC(t.padding),h=ul([a,Wf(u,-ta,ta)]),_=ul([c,Wf(l,-ta,ta)]),y=[Math.max(Math.abs(_[0]-h[0]),i),Math.max(Math.abs(_[1]-h[1]),i)],S=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];fn(S[0]>0&&S[1]>0);const C=S[0]/y[0],m=S[1]/y[1],p=(f.right-f.left)/2/C,E=(f.top-f.bottom)/2/m,A=[(_[0]+h[0])/2+p,(_[1]+h[1])/2+E],x=ki(A),M=Math.min(s,Td(Math.abs(Math.min(C,m))));return fn(Number.isFinite(M)),{longitude:x[0],latitude:x[1],zoom:M}}function JC(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(fn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const t_=Math.PI/180;function GC(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*t_:Math.atan(.5/t.altitude),f=(90-t.pitch)*t_;return u>f-.01?(l=n_(t,0,e),c=n_(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function n_(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=mi(r,[e,0,1,1]),s=mi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=bv([],i,s,a),c=ki(l);return c.push(n),c}const r_=512;function eP(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=e_(i+180,360)-180),(a<-180||a>180)&&(a=e_(a+180,360)-180);const l=Td(n/r_);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=ki([0,c])[1];if(s<u)s=u;else{const f=ki([0,r_-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const tP=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,nP=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,rP=_o(lP),iP=_o(cP),sP=[0,0,0,1],oP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function aP(t,e){const[n,r,i]=t,s=Ed([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function lP({viewport:t,center:e}){return new Kt(t.viewProjectionMatrix).invert().transform(e)}function cP({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>aP(o,r));for(const o of e){const a=o.clone().translate(new Yt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Kt().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function uP(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||sP,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=rP({viewport:t.viewport,center:e.project_uCenter}),s=[],o=iP({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new Yt(t.viewport.center).negate());e.project_uCoordinateSystem===J.LNGLAT&&e.project_uProjectionMode===Ht.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(oP),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const i_={name:"shadow",dependencies:[vd],vs:tP,fs:nP,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?uP(t,e):{}},fP={...qg,defaultUniforms:{...qg.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},hP=[vd],dP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function pP(){const t=Ja.getDefaultShaderAssembler();for(const e of hP)t.addDefaultModule(e);for(const e of dP)t.addShaderHook(e);return t}const gP=[255,255,255],_P=1;let mP=0;class yP{constructor(e={}){this.type="ambient";const{color:n=gP}=e,{intensity:r=_P}=e;this.id=e.id||`ambient-${mP++}`,this.color=n,this.intensity=r}}const vP=[255,255,255],TP=1,EP=[0,0,-1];let SP=0;class s_{constructor(e={}){this.type="directional";const{color:n=vP}=e,{intensity:r=TP}=e,{direction:i=EP}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${SP++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Yt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class wP{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Sd extends wP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const f=o&&o[u.id];a==null||a(u);const h=this._getDrawLayerParams(u,n),_=u.subViewports||[u];for(const y of _){const S=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:y,view:f,pass:n.pass,layers:n.layers},h);c.push(S)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var y;const u=[],f=Lv(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},_={};for(let S=0;S<n.length;S++){const C=n[S],m=this._shouldDrawLayer(C,h,s,_),p={shouldDrawLayer:m};m&&!c&&(p.layerRenderIndex=f(C,m),p.moduleParameters=this._getModuleParameters(C,a,r,l),p.layerParameters={...(y=C.context.deck)==null?void 0:y.props.parameters,...this.getLayerParameters(C,S,e)}),u[S]=p}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=AP(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:_,layerRenderIndex:y,moduleParameters:S,layerParameters:C}=l[f];if(_&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(_){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,y),S.viewport=o,h.context.renderPass=e;try{h._drawLayer({renderPass:e,moduleParameters:S,uniforms:{layerIndex:y},parameters:C})}catch(m){h.raiseError(m,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function Lv(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||Lv(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function AP(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class RP extends Sd{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const bP={color:[255,255,255],intensity:1},o_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],CP=[0,0,0,200/255];class Vv{constructor(e={}){this.id="lighting-effect",this.shadowColor=CP,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(i_),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(i_))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Kt().lookAt({eye:new Yt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new RP(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new yP(bP),this.directionalLights.push(new s_(o_[0]),new s_(o_[1])))}}class PP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Oi=new PP;function _s(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xP(t){return[t[12],t[13],t[14]]}function IP(t){return{left:Lr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Lr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Lr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Lr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Lr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Lr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const a_=new Yt;function Lr(t,e,n,r){a_.set(t,e,n);const i=a_.len();return{distance:r/i,normal:new Yt(-t/i,-e/i,-n/i)}}function MP(t){return t-Math.fround(t)}let ss;function ou(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;ss=Oi.allocate(ss,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];ss[a+l]=c,ss[a+l+n]=MP(c)}a+=n*2}return ss.subarray(0,s*n*2)}function NP(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const kP=Math.PI/180,OP=_s(),l_=[0,0,0],FP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function DP({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new Kt().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new Kt().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:_=0}=s,y=xn((u+t-f)/2,0,t)-t/2,S=xn((h+e-_)/2,0,e)-e/2;c[8]-=y*2/t,c[9]+=S*2/e}return c}const Il=class Il{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||FP,this.focalDistance=e.focalDistance||1,this.position=e.position||l_,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ht.WEB_MERCATOR:Ht.WEB_MERCATOR_AUTO_OFFSET:Ht.IDENTITY}equals(e){return e instanceof Il?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&to(e.projectionMatrix,this.projectionMatrix)&&to(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Uv(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=Ed([i,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(r)?[u,f,r]:[u,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=ul(e);return n[1]=xn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ki(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Xf({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,IP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=KC({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Xf({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=l_;if(s&&(a=o?new Kt(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new Yt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=OP,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Kt().multiplyRight(n).translate(new Yt(this.center).negate()),this.projectionMatrix=r||DP({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*kP,focalDistance:u,padding:c,near:a,far:l});const f=_s();pr(f,f,this.projectionMatrix),pr(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Vf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=xP(this.viewMatrixInverse);const h=_s(),_=_s();yd(h,h,[this.width/2,-this.height/2,1]),ll(h,h,[1,-1,0]),pr(_,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=_,this.pixelUnprojectionMatrix=Vf(_s(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||se.warn("Pixel project matrix not invertible")()}};Il.displayName="Viewport";let hl=Il;const Os=class Os extends hl{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:_=!1,worldOffset:y=0,position:S,padding:C,legacyMeterSizes:m=!1}=e;let{width:p,height:E,altitude:A=1.5}=e;const x=Math.pow(2,i);p=p||1,E=E||1;let M,N=null;if(h)A=h[5]/2,M=fl(A);else{e.fovy?(M=e.fovy,A=Bv(M)):M=fl(A);let L;if(C){const{top:U=0,bottom:H=0}=C;L=[0,xn((U+E-H)/2,0,E)-E/2]}N=ZC({width:p,height:E,scale:x,center:S&&[0,0,S[2]*su(n)],offset:L,pitch:s,fovy:M,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(N.near=c),Number.isFinite(u)&&(N.far=u)}let D=qC({height:E,pitch:s,bearing:o,scale:x,altitude:A});y&&(D=new Kt().translate([512*y,0,0]).multiplyLeft(D)),super({...e,width:p,height:E,viewMatrix:D,longitude:r,latitude:n,zoom:i,...N,fovy:M,focalDistance:A}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=A,this.fovy=M,this.orthographic=f,this._subViewports=_?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Os({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*su(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/su(r);return[n,r,i]}addMetersToLngLat(e,n){return Dv(e,n)}panByPosition(e,n){const r=Ed(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=Qg([],i,H3([],r)),o=Qg([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=GC(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=QC({width:r,height:i,bounds:e,...n});return new Os({width:r,height:i,longitude:s,latitude:o,zoom:a})}};Os.displayName="WebMercatorViewport";let no=Os;const c_=[0,0,0];function au(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof no){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function BP(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===J.DEFAULT&&(i=e.isGeospatial?J.LNGLAT:J.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function zv(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=go([],[o,a,l,1],n)),r){case J.LNGLAT:return au([o,a,l],e,s);case J.LNGLAT_OFFSETS:return au([o+i[0],a+i[1],l+(i[2]||0)],e,s);case J.METER_OFFSETS:return au(Dv(i,[o,a,l]),e,s);case J.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function UP(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=BP(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=c_,shaderCoordinateOrigin:u=c_,offsetMode:f=!1}=l?Ov(n,r,i):{},h=zv(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const _=n.projectPosition(c||u);iC(h,h,_)}return h}let LP=1,VP=1;class jv{constructor(){g(this,"time",0);g(this,"channels",new Map);g(this,"animations",new Map);g(this,"playing",!1);g(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=LP++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=VP++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let zP=0;const jP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:gi.stats.get(`animation-loop-${zP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class HP{constructor(e){g(this,"device",null);g(this,"canvas",null);g(this,"props");g(this,"animationProps",null);g(this,"timeline",null);g(this,"stats");g(this,"cpuTime");g(this,"gpuTime");g(this,"frameRate");g(this,"display");g(this,"needsRedraw","initialized");g(this,"_initialized",!1);g(this,"_running",!1);g(this,"_animationFrameId",null);g(this,"_nextFramePromise",null);g(this,"_resolveNextFrame",null);g(this,"_cpuStartTime",0);if(this.props={...jP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new tc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=Bb(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Ub(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class u_{constructor(e){g(this,"id");g(this,"userData",{});g(this,"topology");g(this,"bufferLayout",[]);g(this,"vertexCount");g(this,"indices");g(this,"attributes");this.id=e.id||Pr("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&oe(this.indices.usage===fe.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function WP(t,e){if(e instanceof u_)return e;const n=$P(t,e),{attributes:r,bufferLayout:i}=XP(t,e);return new u_({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function $P(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:fe.INDEX,data:n})}function XP(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:Nb(l,c,u)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class YP{constructor(e){g(this,"modules");g(this,"moduleUniforms");g(this,"moduleBindings");g(this,"moduleUniformsChanged");const n=rc(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;B.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){B.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:f}=md(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const Ml=class Ml{constructor(e){g(this,"device");g(this,"_hashCounter",0);g(this,"_hashes",{});g(this,"_renderPipelineCache",{});g(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Ml(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Pi.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...il.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof il?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};g(Ml,"defaultProps",{...Pi.defaultProps});let Yf=Ml;const Nl=class Nl{constructor(e){g(this,"device");g(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Nl(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};g(Nl,"defaultProps",{...tl.defaultProps});let Kf=Nl;function KP(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let Ce=null,lu=null;function qP(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){Ce||(Ce=document.createElement("canvas"),Ce.id=e,Ce.title=e,Ce.style.zIndex="100",Ce.style.position="absolute",Ce.style.top=i,Ce.style.left=s,Ce.style.border="blue 1px solid",Ce.style.transform="scaleY(-1)",document.body.appendChild(Ce),lu=Ce.getContext("2d")),(Ce.width!==t.width||Ce.height!==t.height)&&(Ce.width=t.width/2,Ce.height=t.height/2,Ce.style.width="400px",Ce.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=lu.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=r?255:a[u+3]*o;lu.putImageData(l,0,0)}const Vr=2,ZP=1e4,kl=class kl{constructor(e,n){g(this,"device");g(this,"id");g(this,"source");g(this,"vs");g(this,"fs");g(this,"pipelineFactory");g(this,"shaderFactory");g(this,"userData",{});g(this,"parameters");g(this,"topology");g(this,"bufferLayout");g(this,"isInstanced");g(this,"instanceCount",0);g(this,"vertexCount");g(this,"indexBuffer",null);g(this,"bufferAttributes",{});g(this,"constantAttributes",{});g(this,"bindings",{});g(this,"uniforms",{});g(this,"vertexArray");g(this,"transformFeedback",null);g(this,"pipeline");g(this,"shaderInputs");g(this,"_uniformStore");g(this,"_attributeInfos",{});g(this,"_gpuGeometry",null);g(this,"_getModuleUniforms");g(this,"props");g(this,"_pipelineNeedsUpdate","newly created");g(this,"_needsRedraw","initializing");g(this,"_destroyed",!1);g(this,"_lastDrawTimestamp",-1);g(this,"_lastLogTime",0);g(this,"_logOpen",!1);g(this,"_drawCount",0);var a,l,c,u;this.props={...kl.defaultProps,...n},n=this.props,this.id=n.id||Pr("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(f=>[f.name,f]))||[]);this.setShaderInputs(n.shaderInputs||new YP(r));const i=QP(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=E3(this.props.source));const{source:f,getUniforms:h}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=f,this._getModuleUniforms=h}else{const{vs:f,fs:h,getUniforms:_}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=f,this.fs=h,this._getModuleUniforms=_}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Yf.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Kf.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Ga(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&WP(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=f_(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?f_(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Df(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Mb(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&B.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>h_(l).includes(r));if(!s){B.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=h_(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&B.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||B.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Ga(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=md(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof el?e=Math.max(e,n.texture.updateTimestamp):n instanceof fe||n instanceof dt?e=Math.max(e,n.updateTimestamp):n instanceof nl||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(B.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=fv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=B.level>3?0:ZP;B.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,B.group(Vr,`>>> DRAWING MODEL ${this.id}`,{collapsed:B.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=KP(this.pipeline.shaderLayout,this.id);B.table(Vr,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};B.table(Vr,n)();const r=this._getAttributeDebugTable();B.table(Vr,this._attributeInfos)(),B.table(Vr,r)(),B.groupEnd(Vr)(),this._logOpen=!1}}_logFramebuffer(e){const n=B.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&qP(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=pv(n);return(e instanceof fe?new r(e.debugData):e).toString()}};g(kl,"defaultProps",{...Pi.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Ja.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let ro=kl;function f_(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function QP(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function h_(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class io{constructor(e,n=ro.defaultProps){g(this,"device");g(this,"model");g(this,"transformFeedback");oe(io.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new ro(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||kR(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof fe)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class JP{constructor(e){g(this,"id");g(this,"topology");g(this,"vertexCount");g(this,"indices");g(this,"attributes");g(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Pr("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;oe(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(oe(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return oe(Number.isFinite(r)),r}}const GP={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Hv extends Sd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:_="picking",pickZ:y,moduleParameters:S}){this.pickZ=y;const C=this._resetColorEncoder(y),m=[a,l,c,u],p=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(A=>A.useInPicking),pass:_,isPicking:!0,moduleParameters:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:C&&t2.bind(null,C),stats:p}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,GP),i.blend=!0,i.blendColor=e2(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function e2(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(se.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function t2(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const jr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},dl=Symbol.for("component"),gr=Symbol.for("propTypes"),cu=Symbol.for("deprecatedProps"),yi=Symbol.for("asyncPropDefaults"),Sr=Symbol.for("asyncPropOriginal"),In=Symbol.for("asyncPropResolved");function Wv(t,e=()=>!0){return Array.isArray(t)?$v(t,e,[]):e(t)?[t]:[]}function $v(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?$v(i,e,n):e(i)&&n.push(i)}return n}function n2({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class r2{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=wf(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class i2{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new r2(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const s2="layerManager.setLayers",o2="layerManager.activateViewport";class a2{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{He(o2,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new i2({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:pP(),defaultShaderModules:[],renderPass:void 0,stats:i||new tc({id:"deck.gl"}),viewport:s||new hl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new jv,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){He(s2,this,n,e),this._lastRenderedLayers=e;const r=Wv(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?se.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&se.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=jr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=jr.MATCHED,n!==e&&(e.lifecycle=jr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=jr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=jr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function bt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!bt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!bt(t[s],e[s],n-1))return!1;return!0}return!1}class l2{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Wv(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!bt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):se.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const c2=/([0-9]+\.?[0-9]*)(%|px)/;function mn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=c2.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function yn(t,e){return t.relative?Math.round(t.position*e):t.position}class Fi{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=mn(r),this._y=mn(i),this._width=mn(s),this._height=mn(o),this._padding=a&&{left:mn(a.left||0),right:mn(a.right||0),top:mn(a.top||0),bottom:mn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&bt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:yn(this._x,e),y:yn(this._y,n),width:yn(this._width,e),height:yn(this._height,n)};return this._padding&&(r.padding={left:yn(this._padding.left,e),top:yn(this._padding.top,n),right:yn(this._padding.right,e),bottom:yn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class sc{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const d_=()=>{},qf={BREAK:1,SNAP_TO_END:2,IGNORE:3},u2=t=>t,f2=qf.BREAK;class h2{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new sc(e.timeline),this.onViewStateChange=e.onViewStateChange||d_,this.onStateChange=e.onStateChange||d_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===qf.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===qf.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||u2,interpolator:s,interruption:n.transitionInterruption||f2,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function ke(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class d2{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!to(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ke(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const p2=["longitude","latitude","zoom","bearing","pitch"],g2=["longitude","latitude","zoom"];class Xv extends d2{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:p2,required:g2},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=al(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,al(e.around,n.around,r)))}return i}}const vn={transitionDuration:0},_2=300,na=t=>1-(1-t)*(1-t),zr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Jn={};class m2{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new h2({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?_2:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(zr.WHEEL,u&&r),this.toggleEvents(zr.PAN,u),this.toggleEvents(zr.PINCH,u&&(a||l)),this.toggleEvents(zr.TRIPLE_PAN,u&&l),this.toggleEvents(zr.DOUBLE_TAP,u&&o),this.toggleEvents(zr.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,vn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,vn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,vn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,vn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,vn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Jn._startPinchRotation=e.rotation,Jn._lastPinchEvent=e,this.updateViewport(r,vn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Jn._startPinchRotation-r})}return this.updateViewport(n,vn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Jn._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Jn;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:na},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Jn._startPinchRotation=null,Jn._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?vn:e?{...n,transitionInterpolator:new Xv({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class y2{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const p_=5,v2=1.2;class T2 extends y2{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:_=60,minPitch:y=0,startPanLngLat:S,startZoomLngLat:C,startRotatePos:m,startBearing:p,startPitch:E,startZoom:A,normalize:x=!0}=e;ke(Number.isFinite(s)),ke(Number.isFinite(i)),ke(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:_,minPitch:y,normalize:x,position:u},{startPanLngLat:S,startZoomLngLat:C,startRotatePos:m,startBearing:p,startPitch:E,startZoom:A}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=xn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=xn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=xn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,eP(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>p_&&(h=o/(l-u)*v2):o<0&&l>p_&&(h=1-a/l),h=xn(h,-1,1);const{minPitch:_,maxPitch:y}=this.getViewportProps(),S=i+180*f;let C=r;return h>0?C=r+h*(y-r):h<0&&(C=r-h*(_-r)),{pitch:C,bearing:S}}}class E2 extends m2{constructor(){super(...arguments),this.ControllerState=T2,this.transition={transitionDuration:300,transitionInterpolator:new Xv({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}var vi;let S2=(vi=class extends Fi{constructor(e={}){super(e)}get ViewportType(){return no}get ControllerType(){return E2}},vi.displayName="MapView",vi);const w2=new Vv;function A2(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class R2{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>A2(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(bt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof Vv)||this._resolvedEffects.push(w2),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class b2 extends Sd{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const C2="deckRenderer.renderLayers";class P2{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new b2(e),this.pickLayersPass=new Hv(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,He(C2,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const x2={pickedColor:null,pickedObjectIndex:-1};function I2({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,f=-1,h=0;for(let _=0;_<c;_++){const y=_+a-r,S=y*y;if(S>u)h+=4*l;else for(let C=0;C<l;C++){if(t[h+3]-1>=0){const p=C+o-n,E=p*p+S;E<=u&&(u=E,f=h)}h+=4}}if(f>=0){const _=t.slice(f,f+4),y=e(_);if(y){const S=Math.floor(f/4/l),C=f/4-S*l;return{...y,pickedColor:_,pickedX:o+C,pickedY:a+S}}se.error("Picked non-existent layer. Is picking buffer corrupt?")()}return x2}function M2({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):se.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Yv({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=k2((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function N2(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,_=o?o.props.id:null;if(_!==h||a!==f){if(_!==h){const y=i.find(S=>S.props.id===h);y&&l.unshift(y)}n.layerId=_,n.index=a,n.info=null}}const c=Yv(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=Kv({layer:f,info:h,mode:r});const _=h.layer;f===o&&r==="hover"&&(n.info=h),u.set(_.id,h),r==="hover"&&_.updateAutoHighlight(h)}),u}function Kv({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function k2(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class O2{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Hv(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),_=this._getPickable(e);if(!_||r.length===0)return{result:[],emptyInfo:Yv({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const y=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=[y.x+Math.floor(y.width/2),y.y+Math.floor(y.height/2)],C=Math.round(o*h),{width:m,height:p}=this.pickingFBO,E=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:C,deviceWidth:m,deviceHeight:p}),A={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let x;const M=[],N=new Set;for(let D=0;D<a;D++){let L;if(E){const H=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:u,deviceRect:E,cullRect:A,effects:f,pass:`picking:${l}`});L=I2({...H,deviceX:S[0],deviceY:S[1],deviceRadius:C,deviceRect:E})}else L={pickedColor:null,pickedObjectIndex:-1};let U;if(L.pickedLayer&&c&&this.depthFBO){const{pickedColors:H}=this._drawAndSample({layers:[L.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:L.pickedX,y:L.pickedY,width:1,height:1},cullRect:A,effects:f,pass:`picking:${l}:z`},!0);H[3]&&(U=H[0])}L.pickedLayer&&D+1<a&&(N.add(L.pickedLayer),L.pickedLayer.disablePickingIndex(L.pickedObjectIndex)),x=N2({pickInfo:L,lastPickedInfo:this.lastPickedInfo,mode:l,layers:_,viewports:r,x:i,y:s,z:U,pixelRatio:h});for(const H of x.values())H.layer&&M.push(H);if(!L.pickedColor)break}for(const D of N)D.restorePickingColors();return{result:M,emptyInfo:x.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const _=this.device.canvasContext.cssToDeviceRatio(),y=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=y.x,C=y.y+y.height,m=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),p=m.x+m.width,E=m.y,A={x:S,y:E,width:p-S,height:C-E},x=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:A,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),M=M2(x),N=new Map,D=[],L=Number.isFinite(c);for(let U=0;U<M.length&&!(L&&D.length>=c);U++){const H=M[U];let Q={color:H.pickedColor,layer:null,index:H.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:_};Q=Kv({layer:H.pickedLayer,info:Q,mode:l});const ee=Q.layer.id;N.has(ee)||N.set(ee,new Set);const q=N.get(ee),at=Q.object??Q.index;q.has(at)||(q.add(at),D.push(Q))}return D}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const p of a)p.useInPicking&&(f.preRenderStats[p.id]=p.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:_,y,width:S,height:C}=s,m=new(c?Float32Array:Uint8Array)(S*C*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:_,sourceY:y,sourceWidth:S,sourceHeight:C,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const F2={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},D2="top-left",g_="__root";class B2{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!bt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=D2}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||g_;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,F2[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===g_||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=Hf[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const U2={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class L2{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,U2),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var ni;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ni||(ni={}));const wd={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Se=(t,e,n)=>e?t.enable(n):t.disable(n),__=(t,e,n)=>t.hint(n,e),Ge=(t,e,n)=>t.pixelStorei(n,e),m_=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},os=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function uu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const V2={3042:Se,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Se,2885:(t,e)=>t.cullFace(e),2929:Se,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Se,35723:__,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:m_,36010:m_,34964:os,36662:os,36663:os,35053:os,35055:os,2886:(t,e)=>t.frontFace(e),33170:__,2849:(t,e)=>t.lineWidth(e),32823:Se,32824:"polygonOffset",10752:"polygonOffset",35977:Se,32926:Se,32928:Se,32938:"sampleCoverage",32939:"sampleCoverage",3089:Se,3088:(t,e)=>t.scissor(...e),2960:Se,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Se,10754:Se,12288:Se,12289:Se,12290:Se,12291:Se,12292:Se,12293:Se,12294:Se,12295:Se,3333:Ge,3317:Ge,37440:Ge,37441:Ge,37443:Ge,3330:Ge,3332:Ge,3331:Ge,3314:Ge,32878:Ge,3316:Ge,3315:Ge,32877:Ge,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=uu(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=uu(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=uu(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function me(t,e,n){return e[t]!==void 0?e[t]:n[t]}const z2={blendEquation:(t,e,n)=>t.blendEquationSeparate(me(32777,e,n),me(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(me(32969,e,n),me(32968,e,n),me(32971,e,n),me(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(me(32824,e,n),me(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(me(32938,e,n),me(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,me(2962,e,n),me(2967,e,n),me(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,me(34816,e,n),me(36003,e,n),me(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,me(2964,e,n),me(2965,e,n),me(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,me(34817,e,n),me(34818,e,n),me(34819,e,n))},y_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Dt=(t,e)=>t.isEnabled(e),v_={3042:Dt,2884:Dt,2929:Dt,3024:Dt,32823:Dt,32926:Dt,32928:Dt,3089:Dt,2960:Dt,35977:Dt},j2=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Vi(t,e){if(W2(e))return;const n={};for(const i in e){const s=Number(i),o=V2[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=z2[i];s(t,e,r)}}function qv(t,e=wd){if(typeof e=="number"){const i=e,s=v_[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=v_[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function H2(t){Vi(t,wd)}function W2(t){for(const e in t)return!1;return!0}function $2(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class X2{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){g(this,"gl");g(this,"program",null);g(this,"stateStack",[]);g(this,"enable",!0);g(this,"cache");g(this,"log");this.gl=e,this.cache=n?qv(e):Object.assign({},wd),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){oe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Vi(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){oe(s!==void 0);const o=e[s],a=this.cache[s];$2(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function wr(t){return t.state}function Zv(t,e){const{enable:n=!0,copyState:r}=e;if(oe(r!==void 0),!t.state){t.state=new X2(t,{copyState:r}),K2(t);for(const s in y_){const o=y_[s];Y2(t,s,o)}T_(t,"getParameter"),T_(t,"isEnabled")}const i=wr(t);return i.enable=n,t}function oc(t){let e=wr(t);e||(Zv(t,{copyState:!1}),e=wr(t)),e.push()}function so(t){const e=wr(t);oe(e),e.pop()}function T_(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||j2.has(i))return n(i);const s=wr(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Y2(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=wr(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function K2(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=wr(t);i.program!==r&&(e(r),i.program=r)}}const q2={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function Z2(t,e){e={...q2,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function Wn(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function Q2(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Wn(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=Qv(a,l),f=J2(a,l),h=G2(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Qv(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function J2(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function G2(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(Qv(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Jv(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ue="texture-compression-bc",te="texture-compression-astc",Bt="texture-compression-etc2",ex="texture-compression-etc1-webgl",ra="texture-compression-pvrtc-webgl",fu="texture-compression-atc-webgl",as="float32-renderable-webgl",hu="float16-renderable-webgl",tx="rgb9e5ufloat_renderable-webgl",du="snorm8-renderable-webgl",ls="norm16-renderable-webgl",pu="snorm16-renderable-webgl",ia="float32-filterable",E_="float16-filterable-webgl",ms="WEBGL_compressed_texture_s3tc",ys="WEBGL_compressed_texture_s3tc_srgb",ri="EXT_texture_compression_rgtc",ii="EXT_texture_compression_bptc",nx="WEBGL_compressed_texture_etc",rx="WEBGL_compressed_texture_astc",ix="WEBGL_compressed_texture_etc1",sx="WEBGL_compressed_texture_pvrtc",ox="WEBGL_compressed_texture_atc",S_="EXT_texture_norm16",w_="EXT_render_snorm",ax="EXT_color_buffer_float",Ad={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[w_],"norm16-renderable-webgl":[S_],"snorm16-renderable-webgl":[S_,w_],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ms,ys,ri,ii],"texture-compression-bc5-webgl":[ri],"texture-compression-bc7-webgl":[ii],"texture-compression-etc2":[nx],"texture-compression-astc":[rx],"texture-compression-etc1-webgl":[ix],"texture-compression-pvrtc-webgl":[sx],"texture-compression-atc-webgl":[ox]};function lx(t){return t in Ad}function cx(t,e,n){return(Ad[e]||[]).every(i=>Wn(t,i,n))}const ac={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:du},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:du},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:hu,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:ls,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:pu},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:du},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:hu,filter:E_,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:ls},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:pu},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:as,filter:ia},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:tx},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:as,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:ls},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:ls},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:as,filter:ia,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:hu,filter:E_},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:ls,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:pu},"rgb32float-webgl":{gl:34837,render:as,filter:ia,gl2ext:ax,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:as,filter:ia,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ms,f:Ue},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ys,f:Ue},"bc1-rgba-unorm":{gl:33777,x:ms,f:Ue},"bc1-rgba-unorm-srgb":{gl:35916,x:ys,f:Ue},"bc2-rgba-unorm":{gl:33778,x:ms,f:Ue},"bc2-rgba-unorm-srgb":{gl:35918,x:ys,f:Ue},"bc3-rgba-unorm":{gl:33779,x:ms,f:Ue},"bc3-rgba-unorm-srgb":{gl:35919,x:ys,f:Ue},"bc4-r-unorm":{gl:36283,x:ri,f:Ue},"bc4-r-snorm":{gl:36284,x:ri,f:Ue},"bc5-rg-unorm":{gl:36285,x:ri,f:Ue},"bc5-rg-snorm":{gl:36286,x:ri,f:Ue},"bc6h-rgb-ufloat":{gl:36495,x:ii,f:Ue},"bc6h-rgb-float":{gl:36494,x:ii,f:Ue},"bc7-rgba-unorm":{gl:36492,x:ii,f:Ue},"bc7-rgba-unorm-srgb":{gl:36493,x:ii,f:Ue},"etc2-rgb8unorm":{gl:37492,f:Bt},"etc2-rgb8unorm-srgb":{gl:37494,f:Bt},"etc2-rgb8a1unorm":{gl:37496,f:Bt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Bt},"etc2-rgba8unorm":{gl:37493,f:Bt},"etc2-rgba8unorm-srgb":{gl:37495,f:Bt},"eac-r11unorm":{gl:37488,f:Bt},"eac-r11snorm":{gl:37489,f:Bt},"eac-rg11unorm":{gl:37490,f:Bt},"eac-rg11snorm":{gl:37491,f:Bt},"astc-4x4-unorm":{gl:37808,f:te},"astc-4x4-unorm-srgb":{gl:37840,f:te},"astc-5x4-unorm":{gl:37809,f:te},"astc-5x4-unorm-srgb":{gl:37841,f:te},"astc-5x5-unorm":{gl:37810,f:te},"astc-5x5-unorm-srgb":{gl:37842,f:te},"astc-6x5-unorm":{gl:37811,f:te},"astc-6x5-unorm-srgb":{gl:37843,f:te},"astc-6x6-unorm":{gl:37812,f:te},"astc-6x6-unorm-srgb":{gl:37844,f:te},"astc-8x5-unorm":{gl:37813,f:te},"astc-8x5-unorm-srgb":{gl:37845,f:te},"astc-8x6-unorm":{gl:37814,f:te},"astc-8x6-unorm-srgb":{gl:37846,f:te},"astc-8x8-unorm":{gl:37815,f:te},"astc-8x8-unorm-srgb":{gl:37847,f:te},"astc-10x5-unorm":{gl:37819,f:te},"astc-10x5-unorm-srgb":{gl:37851,f:te},"astc-10x6-unorm":{gl:37817,f:te},"astc-10x6-unorm-srgb":{gl:37849,f:te},"astc-10x8-unorm":{gl:37818,f:te},"astc-10x8-unorm-srgb":{gl:37850,f:te},"astc-10x10-unorm":{gl:37819,f:te},"astc-10x10-unorm-srgb":{gl:37851,f:te},"astc-12x10-unorm":{gl:37820,f:te},"astc-12x10-unorm-srgb":{gl:37852,f:te},"astc-12x12-unorm":{gl:37821,f:te},"astc-12x12-unorm-srgb":{gl:37853,f:te},"pvrtc-rgb4unorm-webgl":{gl:35840,f:ra},"pvrtc-rgba4unorm-webgl":{gl:35842,f:ra},"pvrtc-rbg2unorm-webgl":{gl:35841,f:ra},"pvrtc-rgba2unorm-webgl":{gl:35843,f:ra},"etc1-rbg-unorm-webgl":{gl:36196,f:ex},"atc-rgb-unorm-webgl":{gl:35986,f:fu},"atc-rgba-unorm-webgl":{gl:35986,f:fu},"atc-rgbai-unorm-webgl":{gl:34798,f:fu}},ux={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},fx={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Rd(t,e,n){const r=ac[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!Wn(t,i,n):!0}function Gv(t){const e=ac[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function hx(t,e,n){if(!Rd(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(av(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Wn(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Wn(t,"OES_texture_half_float_linear, extensions",n):!0}function dx(t,e,n){return!(!Rd(t,e,n)||typeof e=="number")}function pl(t){var i;const e=ac[t],n=Gv(t),r=av(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||gx(r.format,r.integer,r.normalized,n),type:r.dataType?Jv(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function px(t){const e=ac[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function A_(t){const e=pl(t),n=ux[e.dataFormat]||4,r=fx[e.type]||1;return n*r}function gx(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const R_={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class _x extends qR{constructor(n,r,i){super([],i);g(this,"gl");g(this,"extensions");g(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Wn(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),lx(n)&&cx(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(R_),...Object.keys(Ad)]}getWebGLFeature(n){const r=R_[n];return typeof r=="string"?!!Wn(this.gl,r,this.extensions):!!r}}class mx extends KR{constructor(n){super();g(this,"gl");g(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Mn(t,e,n){if(yx(e))return n(t);const{nocatch:r=!0}=e;oc(t),Vi(t,e);let i;if(r)i=n(t),so(t);else try{i=n(t)}finally{so(t)}return i}function yx(t){for(const e in t)return!1;return!0}function vx(t,e,n,r){if(Ga(e))return r(t);const i=t;oc(i.gl);try{return Tx(t,e),Vi(i.gl,n),r(t)}finally{so(i.gl)}}function Tx(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(_r("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=_r("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=_r("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(Sx("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Zf("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&B.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Zf("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=gu("stencilPassOperation",e.stencilPassOperation),s=gu("stencilFailOperation",e.stencilFailOperation),o=gu("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=b_("blendColorOperation",e.blendColorOperation||"add"),s=b_("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=sa("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=sa("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=sa("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=sa("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Zf(t,e){return _r(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function gu(t,e){return _r(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function b_(t,e){return _r(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function sa(t,e){return _r(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Ex(t,e){return`Illegal parameter ${e} for ${t}`}function _r(t,e,n){if(!(e in n))throw new Error(Ex(t,e));return n[e]}function Sx(t,e){return e}function eT(t){const e={};return t.addressModeU&&(e[10242]=_u(t.addressModeU)),t.addressModeV&&(e[10243]=_u(t.addressModeV)),t.addressModeW&&(e[32882]=_u(t.addressModeW)),t.magFilter&&(e[10240]=tT(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=wx(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Zf("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function _u(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function tT(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function wx(t,e){if(!e)return tT(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Vn extends fe{constructor(n,r={}){super(n,r);g(this,"device");g(this,"gl");g(this,"handle");g(this,"glTarget");g(this,"glUsage");g(this,"glIndexType",5123);g(this,"byteLength");g(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Ax(this.props.usage),this.glUsage=Rx(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){oe(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function Ax(t){return t&fe.INDEX?34963:t&fe.VERTEX?34962:t&fe.UNIFORM?35345:34962}function Rx(t){return t&fe.INDEX||t&fe.VERTEX?35044:t&fe.UNIFORM?35048:35044}class Qf extends nl{constructor(n,r){super(n,r);g(this,"device");g(this,"handle");g(this,"parameters");this.device=n,this.parameters=eT(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class si extends el{constructor(n,r){super(n,{...dt.defaultProps,...r});g(this,"device");g(this,"gl");g(this,"handle");g(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const bx={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Fs=class Fs extends dt{constructor(n,r){var i;super(n,{...bx,format:"rgba8unorm",...r});g(this,"MAX_ATTRIBUTES");g(this,"device");g(this,"gl");g(this,"handle");g(this,"sampler");g(this,"view");g(this,"glFormat");g(this,"type");g(this,"dataFormat");g(this,"mipmaps");g(this,"target");g(this,"textureUnit");g(this,"loaded",!1);g(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=Cx(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:Db(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new si(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(m=>this.initialize(Object.assign({},n,{pixels:m,data:m}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;r||(r=o);let{width:u,height:f,dataFormat:h,type:_,compressed:y=!1}=n;const{depth:S=0}=n,C=Gv(n.format);return{width:u,height:f,compressed:y,dataFormat:h,type:_}=this._deduceParameters({format:n.format,type:_,dataFormat:h,compressed:y,data:r,width:u,height:f}),this.width=u,this.height=f,this.glFormat=C,this.type=_,this.dataFormat=h,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:r,width:u,height:f,depth:S,format:C,type:_,dataFormat:h,parameters:a,compressed:y}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof Qf?(this.sampler=n,r=n.props):(this.sampler=new Qf(this.device,n),r=n);const i=eT(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Mn(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:_=this.dataFormat,compressed:y=!1}=n;c||(c=i),{type:u,dataFormat:_,compressed:y,width:f,height:h}=this._deduceParameters({format:this.props.format,type:u,dataFormat:_,compressed:y,data:c,width:f,height:h});const{gl:S}=this;S.bindTexture(this.target,this.handle);let C=null;if({data:c,dataType:C}=this._getDataType({data:c,compressed:y}),Mn(this.gl,l,()=>{switch(C){case"null":S.texImage2D(r,s,o,f,h,0,_,u,c);break;case"typed-array":S.texImage2D(r,s,o,f,h,0,_,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(r,s,o,f,h,0,_,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":S.texImage2D(r,s,o,f,h,0,_,u,c);break;case"compressed":for(const[m,p]of c.entries())S.compressedTexImage2D(r,m,p.format,p.width,p.height,0,p.data);break;default:oe(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const m=A_(this.props.format);this.trackAllocatedMemory(this.width*this.height*m,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:f=this.type,dataFormat:h=this.dataFormat,compressed:_=!1,offset:y=0,parameters:S={}}){if({type:f,dataFormat:h,compressed:_,width:a,height:l}=this._deduceParameters({format:this.props.format,type:f,dataFormat:h,compressed:_,data:i,width:a,height:l}),oe(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const C=i;i=C.data,a=C.shape[0],l=C.shape[1]}i instanceof Vn&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Mn(this.gl,S,()=>{_?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i):i===null?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,i,y):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,y),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Vn?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=pl(r);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},oe(s,"Could not deduced texture size"),oe(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),oe(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,f=await Promise.all(Fs.FACES.map(h=>{const _=u[h];return Promise.all(Array.isArray(_)?_:[_])}));this.bind(),Fs.FACES.forEach((h,_)=>{f[_].length>1&&this.props.mipmaps!==!1&&B.warn(`${this.id} has mipmap and multiple LODs.`)(),f[_].forEach((y,S)=>{i&&s?r.texImage2D(h,S,l,i,s,0,l,c,y):r.texImage2D(h,S,l,l,c,y)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,f=o||a;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},n,{face:r,data:h,pixels:h}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,f):u.texImage2D(r,0,l,l,c,f),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:f,parameters:h={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const _=pl(s);if(Mn(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,r,_.format,a,l,c,0,_.dataFormat,_.type,f),f instanceof Vn&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,r,i,a,l,c,0,s,o,u))}),f&&f.byteLength)this.trackAllocatedMemory(f.byteLength,"Texture");else{const y=A_(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*y,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!Ga(n)){Px(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};g(Fs,"FACES",[34069,34070,34071,34072,34073,34074]);let Wt=Fs;function Cx(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function Px(t){B.log(1,"texture sampler parameters",t)()}class Is extends rl{constructor(n,r){super(n,r);g(this,"device");g(this,"gl");g(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(px(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${Ix(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new Wt(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof Wt)return this._attachTexture(n,r,0,0),r;if(r instanceof si){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=xx(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:oe(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function xx(t){return t<34069?t+34069:t}function Ix(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class Mx extends _d{constructor(n,r){super(r);g(this,"device");g(this,"presentationSize");g(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Is(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const Nx={spector:B.get("spector")||B.get("spectorjs")},kx="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",Ox=1;let ne=null,C_=!1;async function Fx(t){if(!globalThis.SPECTOR)try{await gv(kx)}catch(e){B.warn(String(e))}}function Dx(t){if(t={...Nx,...t},!(t!=null&&t.spector)||(!ne&&globalThis.SPECTOR&&(B.probe(Ox,"SPECTOR found and initialized")(),ne=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ne)),!ne))return null;if(C_||(C_=!0,ne.spyCanvases(),ne==null||ne.onCaptureStarted.add(e=>B.info("Spector capture started:",e)()),ne==null||ne.onCapture.add(e=>{B.info("Spector capture complete:",e)(),ne==null||ne.getResultUI(),ne==null||ne.resultView.display(),ne==null||ne.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return ne;ne==null||ne.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{B.info("Spector capture stopped after 2 seconds")(),ne==null||ne.stopCapture()})}return ne}const Bx="https://unpkg.com/webgl-debug@2.0.1/index.js";function nT(t){return t.luma=t.luma||{},t.luma}async function Ux(){Kn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await gv(Bx))}function Lx(t,e={}){return t?e.debug?zx(t,e):Vx(t):null}function Vx(t){const e=nT(t);return e.realContext?e.realContext:t}function zx(t,e){if(!globalThis.WebGLDebugUtils)return B.warn("webgl-debug not loaded")(),t;const n=nT(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...ni,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,jx.bind(null,e),Hx.bind(null,e));for(const o in ni)!(o in r)&&typeof ni[o]=="number"&&(r[o]=ni[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function mu(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function jx(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;B.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function Hx(t,e,n){let r="";if(B.level>=1&&(r=mu(e,n),B.log(1,r)()),t.break&&t.break.length>0&&(r=r||mu(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||mu(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);B.error(`Undefined argument: ${r}`)();debugger}}function Wx(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[f,h]=i;n.push({message:h.trim(),type:P_(f),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:P_(s),lineNum:c,linePos:u})}return n}function P_(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class $x extends tl{constructor(n,r){super(n,r);g(this,"device");g(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return Wx(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),B.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}B.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),B.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const Xx=256,Yx=1024,Kx=16384,yu=6144,qx=[1,2,4,8];class Zx extends If{constructor(n,r){super(n,r);g(this,"device");g(this,"glParameters");this.device=n,oc(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){so(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=qx.map(i=>!!(i&n.colorMask))),this.glParameters=r,Vi(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=Kx,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=Xx,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=Yx,n.clearStencil=this.props.clearStencil),r!==0&&Mn(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Mn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(yu,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(yu,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(yu,n,r);break}})}}const Qx="Failed to deduce GL constant from typed array";function Jx(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Qx)}}function Jf(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const Gx={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},eI={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ms{constructor(...e){g(this,"offset");g(this,"stride");g(this,"type");g(this,"size");g(this,"divisor");g(this,"normalized");g(this,"integer");g(this,"buffer");g(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Jf(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return oe(e.size),Jf(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Ms(Gx,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ms.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ms.getBytesPerVertex(this)}_assign(e={}){return e=Ob("Accessor",e,eI),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function tI(t){return nI.includes(t)}const nI=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],rT={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function iT(t){const e=rT[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function rI(t){const e=rT[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function iI(t,e){const n={attributes:[],bindings:[]};n.attributes=sI(t,e);const r=lI(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=aI(t,e);let s=0;for(const a of i)if(tI(a.type)){const{viewDimension:l,sampleType:c}=uI(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=oI(t,e);return o!=null&&o.length&&(n.varyings=o),n}function sI(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=rI(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function oI(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=iT(a),f=new Ms({type:c,size:l*u}),h={location:i,name:o,accessor:f};n.push(h)}return n.sort((i,s)=>i.location-s.location),n}function aI(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=fI(o);let f=t.getUniformLocation(e,c);const h={location:f,name:c,size:a,type:l,isArray:u};if(n.push(h),h.size>1)for(let _=0;_<h.size;_++){const y=`${c}[${_}]`;f=t.getUniformLocation(e,y);const S={...h,name:y,location:f};n.push(S)}}return n}function lI(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),f=t.getActiveUniforms(e,a,35388);for(let h=0;h<o.uniformCount;++h){const _=t.getActiveUniform(e,a[h]);if(!_)throw new Error("activeInfo");o.uniforms.push({name:_.name,format:iT(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const cI={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function uI(t){const e=cI[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function fI(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function hI(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function dI(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function pI(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const x_=4;class gI extends Pi{constructor(n,r){super(n,r);g(this,"device");g(this,"handle");g(this,"vs");g(this,"fs");g(this,"introspectedLayout");g(this,"uniforms",{});g(this,"bindings",{});g(this,"varyings",null);g(this,"_uniformCount",0);g(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),B.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=iI(this.device.gl,this.handle),B.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Eb(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":B.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||B.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||B.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Vn)&&!(s.buffer instanceof Vn))throw new Error("buffer value");break;case"texture":if(!(s instanceof si||s instanceof Wt||s instanceof Is))throw new Error("texture value");break;case"sampler":B.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var C;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:f}=n,h=dI(s),_=!!o.indexBuffer,y=(C=o.indexBuffer)==null?void 0:C.glIndexType;if(this.linkStatus!=="success")return B.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=r;return vx(this.device,i,S.glParameters,()=>{_&&c?this.device.gl.drawElementsInstanced(h,a||0,y,u,l||0):_?this.device.gl.drawElements(h,a||0,y,u):c?this.device.gl.drawArraysInstanced(h,u,a||0,l||0):this.device.gl.drawArrays(h,u,a||0),f&&f.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=md(n);Object.keys(r).forEach(i=>{B.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),B.time(x_,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),B.timeEnd(x_,`linkProgram for ${this.id}`)(),B.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}B.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),B.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Wt&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof Vn?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof si||o instanceof Wt||o instanceof Is))throw new Error("texture");let c;if(o instanceof si)c=o.texture;else if(o instanceof Wt)c=o;else if(o instanceof Is&&o.colorAttachments[0]instanceof si)B.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.target,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&hI(this.device.gl,i,s,a)}}}class _I extends Nf{constructor(n){super(n,{});g(this,"device");g(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":mI(this.device,r.options);break;case"copy-buffer-to-texture":yI(this.device,r.options);break;case"copy-texture-to-buffer":vI(this.device,r.options);break;case"copy-texture-to-texture":TI(this.device,r.options);break}}}function mI(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function yI(t,e){throw new Error("Not implemented")}function vI(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||f||h)throw new Error("not implemented");const{framebuffer:_,destroyFramebuffer:y}=sT(n);let S;try{const C=c,m=s||_.width,p=o||_.height,E=pl(_.texture.props.format),A=E.dataFormat,x=E.type;t.gl.bindBuffer(35051,C.handle),S=t.gl.bindFramebuffer(36160,_.handle),t.gl.readPixels(l[0],l[1],m,p,A,x,u)}finally{t.gl.bindBuffer(35051,null),S!==void 0&&t.gl.bindFramebuffer(36160,S),y&&_.destroy()}}function TI(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=sT(n),[f,h]=i,[_,y,S]=s,C=t.gl.bindFramebuffer(36160,c.handle);let m=null,p;if(o instanceof Wt)m=o,a=Number.isFinite(a)?a:m.width,l=Number.isFinite(l)?l:m.height,m.bind(0),p=m.target;else throw new Error("invalid destination");switch(p){case 3553:case 34067:t.gl.copyTexSubImage2D(p,r,_,y,f,h,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(p,r,_,y,S,f,h,a,l);break}m&&m.unbind(),t.gl.bindFramebuffer(36160,C),u&&c.destroy()}function sT(t){if(t instanceof dt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class EI extends Mf{constructor(n,r){super(n,r);g(this,"device");g(this,"commandBuffer");this.device=n,this.commandBuffer=new _I(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class bd extends kf{constructor(n,r){super(n,r);g(this,"device");g(this,"handle");g(this,"buffer",null);g(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return jw()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:f}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,f||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=Jv(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=bd.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=SI(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!wI(i,this.bufferValue),a){const l=Rb(r.constructor,o);bb({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function SI(t){return Array.isArray(t)?new Float32Array(t):t}function wI(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class AI extends Of{constructor(n,r){super(n,r);g(this,"device");g(this,"gl");g(this,"handle");g(this,"layout");g(this,"buffers",{});g(this,"unusedBuffers",{});g(this,"bindOnUse",!0);g(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(pI(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,B.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(I_(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Vn)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(I_(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function I_(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class RI extends Ff{constructor(n,r){super(n,r);g(this,"device");g(this,"handle");g(this,"target",null);g(this,"_queryPending",!1);g(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function oT(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return oe(!1),0}}function bI(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return oe(!1),0}}function CI(t,e){var C,m;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=aT(t);oe(u);const{gl:h,handle:_}=u;a=a||u.width,l=l||u.height;const y=s-36064;c=c||((m=(C=u.colorAttachments[y])==null?void 0:C.texture)==null?void 0:m.type)||5121,o=II(o,c,i,a,l),c=c||Jx(o);const S=h.bindFramebuffer(36160,_);return h.readPixels(n,r,a,l,i,c,o),h.bindFramebuffer(36160,S||null),f&&u.destroy(),o}function PI(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=aT(t);oe(u),a=a||u.width,l=l||u.height;const h=u;c=c||5121;let _=n;if(!_){const S=oT(s),C=bI(c),m=o+a*l*S*C;_=h.device.createBuffer({byteLength:m})}const y=t.device.createCommandEncoder();return y.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:_,byteOffset:o}),y.destroy(),f&&u.destroy(),_}function aT(t){return t instanceof rl?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:xI(t),deleteFramebuffer:!0}}function xI(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function II(t,e,n,r,i){if(t)return t;e=e||5121;const s=Jf(e,{clamped:!1}),o=oT(n);return new s(r*i*o)}const MI=256,NI=1024,kI=16384,OI="clear: bad arguments";function FI(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=kI,r!==!0&&(o.clearColor=r)),i&&(a|=MI,i!==!0&&(o.clearDepth=i)),s&&(a|=NI,i!==!0&&(o.clearStencil=i)),oe(a!==0,OI);const l=t.gl;Mn(l,o,()=>{l.clear(a)})}const cs=1,ir=class ir extends Ci{constructor(n){var l,c;super({...n,id:n.id||Pr("webgl-device")});g(this,"type","webgl");g(this,"handle");g(this,"features");g(this,"limits");g(this,"info");g(this,"canvasContext");g(this,"lost");g(this,"_resolveContextLost");g(this,"renderPass",null);g(this,"gl");g(this,"debug",!1);g(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});g(this,"_extensions",{});g(this,"_polyfilled",!1);g(this,"spectorJS");g(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new Mx(this,{...n,canvas:i}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=Z2(this.canvasContext.canvas,{...n,onContextLost:u=>{var f;return(f=this._resolveContextLost)==null?void 0:f.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=Dx({...this.props,canvas:this.handle.canvas})),this.info=Q2(this.gl,this._extensions),this.limits=new mx(this.gl),this.features=new _x(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;Zv(this.gl,{enable:o,copyState:a,log:(...u)=>B.log(1,...u)()}),n.debug&&(this.gl=Lx(this.gl,{...n,throwOnError:!0}),this.debug=!0,B.level=Math.max(B.level,1),B.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof ir)return n;if((n==null?void 0:n.device)instanceof Ci)return n.device;if(!DI(n))throw new Error("Invalid WebGL2RenderingContext");return new ir({gl:n})}static async create(n={}){var a;B.groupCollapsed(cs,"WebGLDevice created")();const r=[];n.debug&&r.push(Ux()),n.spector&&r.push(Fx()),typeof n.canvas=="string"&&r.push(_d.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&B.error(`Failed to initialize debug libraries ${l.reason}`)();if(B.probe(cs+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return B.warn("reattaching existing device")(),ir.attach(n.gl);const s=new ir(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return B.probe(cs,o)(),B.table(cs,s.info)(),B.groupEnd(cs)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Rd(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return hx(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return dx(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new Vn(this,r)}_createTexture(n){return new Wt(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Qf(this,n)}createShader(n){return new $x(this,n)}createFramebuffer(n){return new Is(this,n)}createVertexArray(n){return new bd(this,n)}createTransformFeedback(n){return new AI(this,n)}createQuerySet(n){return new RI(this,n)}createRenderPipeline(n){return new gI(this,n)}beginRenderPass(n){return new Zx(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new EI(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return CI(n,r)}readPixelsToBufferWebGL(n,r){return PI(n,r)}setParametersWebGL(n){Vi(this.gl,n)}getParametersWebGL(n){return qv(this.gl,n)}withParametersWebGL(n,r){return Mn(this.gl,n,r)}clearWebGL(n){FI(this,n)}resetWebGL(){B.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),H2(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){oc(this.gl)}popState(){so(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&VI(s,r)&&B.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:BI(this,n,r);break;case Int32Array:UI(this,n,r);break;case Uint32Array:LI(this,n,r);break;default:oe(!1)}}getExtension(n){return Wn(this.gl,n,this._extensions),this._extensions}};g(ir,"type","webgl");let Ns=ir;function DI(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function BI(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:oe(!1)}}function UI(t,e,n){t.gl.vertexAttribI4iv(e,n)}function LI(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function VI(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var lT={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(d,v,w){return setTimeout(E(d,w),v)}function h(d,v,w){return Array.isArray(d)?(_(d,w[v],w),!0):!1}function _(d,v,w){var I;if(d)if(d.forEach)d.forEach(v,w);else if(d.length!==i)for(I=0;I<d.length;)v.call(w,d[I],I,d),I++;else for(I in d)d.hasOwnProperty(I)&&v.call(w,d[I],I,d)}function y(d,v,w){var I="DEPRECATED METHOD: "+v+`
`+w+` AT 
`;return function(){var O=new Error("get-stack-trace"),V=O&&O.stack?O.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Y=e.console&&(e.console.warn||e.console.log);return Y&&Y.call(e.console,I,V),d.apply(this,arguments)}}var S;typeof Object.assign!="function"?S=function(v){if(v===i||v===null)throw new TypeError("Cannot convert undefined or null to object");for(var w=Object(v),I=1;I<arguments.length;I++){var O=arguments[I];if(O!==i&&O!==null)for(var V in O)O.hasOwnProperty(V)&&(w[V]=O[V])}return w}:S=Object.assign;var C=y(function(v,w,I){for(var O=Object.keys(w),V=0;V<O.length;)(!I||I&&v[O[V]]===i)&&(v[O[V]]=w[O[V]]),V++;return v},"extend","Use `assign`."),m=y(function(v,w){return C(v,w,!0)},"merge","Use `assign`.");function p(d,v,w){var I=v.prototype,O;O=d.prototype=Object.create(I),O.constructor=d,O._super=I,w&&S(O,w)}function E(d,v){return function(){return d.apply(v,arguments)}}function A(d,v){return typeof d==a?d.apply(v&&v[0]||i,v):d}function x(d,v){return d===i?v:d}function M(d,v,w){_(U(v),function(I){d.addEventListener(I,w,!1)})}function N(d,v,w){_(U(v),function(I){d.removeEventListener(I,w,!1)})}function D(d,v){for(;d;){if(d==v)return!0;d=d.parentNode}return!1}function L(d,v){return d.indexOf(v)>-1}function U(d){return d.trim().split(/\s+/g)}function H(d,v,w){if(d.indexOf&&!w)return d.indexOf(v);for(var I=0;I<d.length;){if(w&&d[I][w]==v||!w&&d[I]===v)return I;I++}return-1}function Q(d){return Array.prototype.slice.call(d,0)}function ee(d,v,w){for(var I=[],O=[],V=0;V<d.length;){var Y=d[V][v];H(O,Y)<0&&I.push(d[V]),O[V]=Y,V++}return I=I.sort(function(Ie,ze){return Ie[v]>ze[v]}),I}function q(d,v){for(var w,I,O=v[0].toUpperCase()+v.slice(1),V=0;V<s.length;){if(w=s[V],I=w?w+O:v,I in d)return I;V++}return i}var at=1;function zi(){return at++}function Mr(d){var v=d.ownerDocument||d;return v.defaultView||v.parentWindow||e}var z=/mobile|tablet|ip(ad|hone|od)|android/i,$="ontouchstart"in e,X=q(e,"PointerEvent")!==i,de=$&&z.test(navigator.userAgent),ce="touch",Nr="pen",vt="mouse",ji="kinect",qt=25,Te=1,qn=2,Ee=4,Ye=8,vo=1,Hi=2,Wi=4,$i=8,Xi=16,Mt=Hi|Wi,Zn=$i|Xi,xd=Mt|Zn,Id=["x","y"],To=["clientX","clientY"];function lt(d,v){var w=this;this.manager=d,this.callback=v,this.element=d.element,this.target=d.options.inputTarget,this.domHandler=function(I){A(d.options.enable,[d])&&w.handler(I)},this.init()}lt.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(Mr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&N(this.element,this.evEl,this.domHandler),this.evTarget&&N(this.target,this.evTarget,this.domHandler),this.evWin&&N(Mr(this.element),this.evWin,this.domHandler)}};function IT(d){var v,w=d.options.inputClass;return w?v=w:X?v=hc:de?v=wo:$?v=dc:v=So,new v(d,MT)}function MT(d,v,w){var I=w.pointers.length,O=w.changedPointers.length,V=v&Te&&I-O===0,Y=v&(Ee|Ye)&&I-O===0;w.isFirst=!!V,w.isFinal=!!Y,V&&(d.session={}),w.eventType=v,NT(d,w),d.emit("hammer.input",w),d.recognize(w),d.session.prevInput=w}function NT(d,v){var w=d.session,I=v.pointers,O=I.length;w.firstInput||(w.firstInput=Md(v)),O>1&&!w.firstMultiple?w.firstMultiple=Md(v):O===1&&(w.firstMultiple=!1);var V=w.firstInput,Y=w.firstMultiple,be=Y?Y.center:V.center,Ie=v.center=Nd(I);v.timeStamp=u(),v.deltaTime=v.timeStamp-V.timeStamp,v.angle=fc(be,Ie),v.distance=Eo(be,Ie),kT(w,v),v.offsetDirection=Od(v.deltaX,v.deltaY);var ze=kd(v.deltaTime,v.deltaX,v.deltaY);v.overallVelocityX=ze.x,v.overallVelocityY=ze.y,v.overallVelocity=c(ze.x)>c(ze.y)?ze.x:ze.y,v.scale=Y?DT(Y.pointers,I):1,v.rotation=Y?FT(Y.pointers,I):0,v.maxPointers=w.prevInput?v.pointers.length>w.prevInput.maxPointers?v.pointers.length:w.prevInput.maxPointers:v.pointers.length,OT(w,v);var kt=d.element;D(v.srcEvent.target,kt)&&(kt=v.srcEvent.target),v.target=kt}function kT(d,v){var w=v.center,I=d.offsetDelta||{},O=d.prevDelta||{},V=d.prevInput||{};(v.eventType===Te||V.eventType===Ee)&&(O=d.prevDelta={x:V.deltaX||0,y:V.deltaY||0},I=d.offsetDelta={x:w.x,y:w.y}),v.deltaX=O.x+(w.x-I.x),v.deltaY=O.y+(w.y-I.y)}function OT(d,v){var w=d.lastInterval||v,I=v.timeStamp-w.timeStamp,O,V,Y,be;if(v.eventType!=Ye&&(I>qt||w.velocity===i)){var Ie=v.deltaX-w.deltaX,ze=v.deltaY-w.deltaY,kt=kd(I,Ie,ze);V=kt.x,Y=kt.y,O=c(kt.x)>c(kt.y)?kt.x:kt.y,be=Od(Ie,ze),d.lastInterval=v}else O=w.velocity,V=w.velocityX,Y=w.velocityY,be=w.direction;v.velocity=O,v.velocityX=V,v.velocityY=Y,v.direction=be}function Md(d){for(var v=[],w=0;w<d.pointers.length;)v[w]={clientX:l(d.pointers[w].clientX),clientY:l(d.pointers[w].clientY)},w++;return{timeStamp:u(),pointers:v,center:Nd(v),deltaX:d.deltaX,deltaY:d.deltaY}}function Nd(d){var v=d.length;if(v===1)return{x:l(d[0].clientX),y:l(d[0].clientY)};for(var w=0,I=0,O=0;O<v;)w+=d[O].clientX,I+=d[O].clientY,O++;return{x:l(w/v),y:l(I/v)}}function kd(d,v,w){return{x:v/d||0,y:w/d||0}}function Od(d,v){return d===v?vo:c(d)>=c(v)?d<0?Hi:Wi:v<0?$i:Xi}function Eo(d,v,w){w||(w=Id);var I=v[w[0]]-d[w[0]],O=v[w[1]]-d[w[1]];return Math.sqrt(I*I+O*O)}function fc(d,v,w){w||(w=Id);var I=v[w[0]]-d[w[0]],O=v[w[1]]-d[w[1]];return Math.atan2(O,I)*180/Math.PI}function FT(d,v){return fc(v[1],v[0],To)+fc(d[1],d[0],To)}function DT(d,v){return Eo(v[0],v[1],To)/Eo(d[0],d[1],To)}var BT={mousedown:Te,mousemove:qn,mouseup:Ee},UT="mousedown",LT="mousemove mouseup";function So(){this.evEl=UT,this.evWin=LT,this.pressed=!1,lt.apply(this,arguments)}p(So,lt,{handler:function(v){var w=BT[v.type];w&Te&&v.button===0&&(this.pressed=!0),w&qn&&v.which!==1&&(w=Ee),this.pressed&&(w&Ee&&(this.pressed=!1),this.callback(this.manager,w,{pointers:[v],changedPointers:[v],pointerType:vt,srcEvent:v}))}});var VT={pointerdown:Te,pointermove:qn,pointerup:Ee,pointercancel:Ye,pointerout:Ye},zT={2:ce,3:Nr,4:vt,5:ji},Fd="pointerdown",Dd="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Fd="MSPointerDown",Dd="MSPointerMove MSPointerUp MSPointerCancel");function hc(){this.evEl=Fd,this.evWin=Dd,lt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}p(hc,lt,{handler:function(v){var w=this.store,I=!1,O=v.type.toLowerCase().replace("ms",""),V=VT[O],Y=zT[v.pointerType]||v.pointerType,be=Y==ce,Ie=H(w,v.pointerId,"pointerId");V&Te&&(v.button===0||be)?Ie<0&&(w.push(v),Ie=w.length-1):V&(Ee|Ye)&&(I=!0),!(Ie<0)&&(w[Ie]=v,this.callback(this.manager,V,{pointers:w,changedPointers:[v],pointerType:Y,srcEvent:v}),I&&w.splice(Ie,1))}});var jT={touchstart:Te,touchmove:qn,touchend:Ee,touchcancel:Ye},HT="touchstart",WT="touchstart touchmove touchend touchcancel";function Bd(){this.evTarget=HT,this.evWin=WT,this.started=!1,lt.apply(this,arguments)}p(Bd,lt,{handler:function(v){var w=jT[v.type];if(w===Te&&(this.started=!0),!!this.started){var I=$T.call(this,v,w);w&(Ee|Ye)&&I[0].length-I[1].length===0&&(this.started=!1),this.callback(this.manager,w,{pointers:I[0],changedPointers:I[1],pointerType:ce,srcEvent:v})}}});function $T(d,v){var w=Q(d.touches),I=Q(d.changedTouches);return v&(Ee|Ye)&&(w=ee(w.concat(I),"identifier")),[w,I]}var XT={touchstart:Te,touchmove:qn,touchend:Ee,touchcancel:Ye},YT="touchstart touchmove touchend touchcancel";function wo(){this.evTarget=YT,this.targetIds={},lt.apply(this,arguments)}p(wo,lt,{handler:function(v){var w=XT[v.type],I=KT.call(this,v,w);I&&this.callback(this.manager,w,{pointers:I[0],changedPointers:I[1],pointerType:ce,srcEvent:v})}});function KT(d,v){var w=Q(d.touches),I=this.targetIds;if(v&(Te|qn)&&w.length===1)return I[w[0].identifier]=!0,[w,w];var O,V,Y=Q(d.changedTouches),be=[],Ie=this.target;if(V=w.filter(function(ze){return D(ze.target,Ie)}),v===Te)for(O=0;O<V.length;)I[V[O].identifier]=!0,O++;for(O=0;O<Y.length;)I[Y[O].identifier]&&be.push(Y[O]),v&(Ee|Ye)&&delete I[Y[O].identifier],O++;if(be.length)return[ee(V.concat(be),"identifier"),be]}var qT=2500,Ud=25;function dc(){lt.apply(this,arguments);var d=E(this.handler,this);this.touch=new wo(this.manager,d),this.mouse=new So(this.manager,d),this.primaryTouch=null,this.lastTouches=[]}p(dc,lt,{handler:function(v,w,I){var O=I.pointerType==ce,V=I.pointerType==vt;if(!(V&&I.sourceCapabilities&&I.sourceCapabilities.firesTouchEvents)){if(O)ZT.call(this,w,I);else if(V&&QT.call(this,I))return;this.callback(v,w,I)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ZT(d,v){d&Te?(this.primaryTouch=v.changedPointers[0].identifier,Ld.call(this,v)):d&(Ee|Ye)&&Ld.call(this,v)}function Ld(d){var v=d.changedPointers[0];if(v.identifier===this.primaryTouch){var w={x:v.clientX,y:v.clientY};this.lastTouches.push(w);var I=this.lastTouches,O=function(){var V=I.indexOf(w);V>-1&&I.splice(V,1)};setTimeout(O,qT)}}function QT(d){for(var v=d.srcEvent.clientX,w=d.srcEvent.clientY,I=0;I<this.lastTouches.length;I++){var O=this.lastTouches[I],V=Math.abs(v-O.x),Y=Math.abs(w-O.y);if(V<=Ud&&Y<=Ud)return!0}return!1}var Vd=q(o.style,"touchAction"),zd=Vd!==i,jd="compute",Hd="auto",pc="manipulation",Qn="none",Yi="pan-x",Ki="pan-y",Ao=GT();function gc(d,v){this.manager=d,this.set(v)}gc.prototype={set:function(d){d==jd&&(d=this.compute()),zd&&this.manager.element.style&&Ao[d]&&(this.manager.element.style[Vd]=d),this.actions=d.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var d=[];return _(this.manager.recognizers,function(v){A(v.options.enable,[v])&&(d=d.concat(v.getTouchAction()))}),JT(d.join(" "))},preventDefaults:function(d){var v=d.srcEvent,w=d.offsetDirection;if(this.manager.session.prevented){v.preventDefault();return}var I=this.actions,O=L(I,Qn)&&!Ao[Qn],V=L(I,Ki)&&!Ao[Ki],Y=L(I,Yi)&&!Ao[Yi];if(O){var be=d.pointers.length===1,Ie=d.distance<2,ze=d.deltaTime<250;if(be&&Ie&&ze)return}if(!(Y&&V)&&(O||V&&w&Mt||Y&&w&Zn))return this.preventSrc(v)},preventSrc:function(d){this.manager.session.prevented=!0,d.preventDefault()}};function JT(d){if(L(d,Qn))return Qn;var v=L(d,Yi),w=L(d,Ki);return v&&w?Qn:v||w?v?Yi:Ki:L(d,pc)?pc:Hd}function GT(){if(!zd)return!1;var d={},v=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(w){d[w]=v?e.CSS.supports("touch-action",w):!0}),d}var Ro=1,ct=2,kr=4,pn=8,Zt=pn,qi=16,Nt=32;function Qt(d){this.options=S({},this.defaults,d||{}),this.id=zi(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Ro,this.simultaneous={},this.requireFail=[]}Qt.prototype={defaults:{},set:function(d){return S(this.options,d),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(d){if(h(d,"recognizeWith",this))return this;var v=this.simultaneous;return d=bo(d,this),v[d.id]||(v[d.id]=d,d.recognizeWith(this)),this},dropRecognizeWith:function(d){return h(d,"dropRecognizeWith",this)?this:(d=bo(d,this),delete this.simultaneous[d.id],this)},requireFailure:function(d){if(h(d,"requireFailure",this))return this;var v=this.requireFail;return d=bo(d,this),H(v,d)===-1&&(v.push(d),d.requireFailure(this)),this},dropRequireFailure:function(d){if(h(d,"dropRequireFailure",this))return this;d=bo(d,this);var v=H(this.requireFail,d);return v>-1&&this.requireFail.splice(v,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(d){return!!this.simultaneous[d.id]},emit:function(d){var v=this,w=this.state;function I(O){v.manager.emit(O,d)}w<pn&&I(v.options.event+Wd(w)),I(v.options.event),d.additionalEvent&&I(d.additionalEvent),w>=pn&&I(v.options.event+Wd(w))},tryEmit:function(d){if(this.canEmit())return this.emit(d);this.state=Nt},canEmit:function(){for(var d=0;d<this.requireFail.length;){if(!(this.requireFail[d].state&(Nt|Ro)))return!1;d++}return!0},recognize:function(d){var v=S({},d);if(!A(this.options.enable,[this,v])){this.reset(),this.state=Nt;return}this.state&(Zt|qi|Nt)&&(this.state=Ro),this.state=this.process(v),this.state&(ct|kr|pn|qi)&&this.tryEmit(v)},process:function(d){},getTouchAction:function(){},reset:function(){}};function Wd(d){return d&qi?"cancel":d&pn?"end":d&kr?"move":d&ct?"start":""}function $d(d){return d==Xi?"down":d==$i?"up":d==Hi?"left":d==Wi?"right":""}function bo(d,v){var w=v.manager;return w?w.get(d):d}function Tt(){Qt.apply(this,arguments)}p(Tt,Qt,{defaults:{pointers:1},attrTest:function(d){var v=this.options.pointers;return v===0||d.pointers.length===v},process:function(d){var v=this.state,w=d.eventType,I=v&(ct|kr),O=this.attrTest(d);return I&&(w&Ye||!O)?v|qi:I||O?w&Ee?v|pn:v&ct?v|kr:ct:Nt}});function Co(){Tt.apply(this,arguments),this.pX=null,this.pY=null}p(Co,Tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:xd},getTouchAction:function(){var d=this.options.direction,v=[];return d&Mt&&v.push(Ki),d&Zn&&v.push(Yi),v},directionTest:function(d){var v=this.options,w=!0,I=d.distance,O=d.direction,V=d.deltaX,Y=d.deltaY;return O&v.direction||(v.direction&Mt?(O=V===0?vo:V<0?Hi:Wi,w=V!=this.pX,I=Math.abs(d.deltaX)):(O=Y===0?vo:Y<0?$i:Xi,w=Y!=this.pY,I=Math.abs(d.deltaY))),d.direction=O,w&&I>v.threshold&&O&v.direction},attrTest:function(d){return Tt.prototype.attrTest.call(this,d)&&(this.state&ct||!(this.state&ct)&&this.directionTest(d))},emit:function(d){this.pX=d.deltaX,this.pY=d.deltaY;var v=$d(d.direction);v&&(d.additionalEvent=this.options.event+v),this._super.emit.call(this,d)}});function _c(){Tt.apply(this,arguments)}p(_c,Tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Qn]},attrTest:function(d){return this._super.attrTest.call(this,d)&&(Math.abs(d.scale-1)>this.options.threshold||this.state&ct)},emit:function(d){if(d.scale!==1){var v=d.scale<1?"in":"out";d.additionalEvent=this.options.event+v}this._super.emit.call(this,d)}});function mc(){Qt.apply(this,arguments),this._timer=null,this._input=null}p(mc,Qt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hd]},process:function(d){var v=this.options,w=d.pointers.length===v.pointers,I=d.distance<v.threshold,O=d.deltaTime>v.time;if(this._input=d,!I||!w||d.eventType&(Ee|Ye)&&!O)this.reset();else if(d.eventType&Te)this.reset(),this._timer=f(function(){this.state=Zt,this.tryEmit()},v.time,this);else if(d.eventType&Ee)return Zt;return Nt},reset:function(){clearTimeout(this._timer)},emit:function(d){this.state===Zt&&(d&&d.eventType&Ee?this.manager.emit(this.options.event+"up",d):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function yc(){Tt.apply(this,arguments)}p(yc,Tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Qn]},attrTest:function(d){return this._super.attrTest.call(this,d)&&(Math.abs(d.rotation)>this.options.threshold||this.state&ct)}});function vc(){Tt.apply(this,arguments)}p(vc,Tt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mt|Zn,pointers:1},getTouchAction:function(){return Co.prototype.getTouchAction.call(this)},attrTest:function(d){var v=this.options.direction,w;return v&(Mt|Zn)?w=d.overallVelocity:v&Mt?w=d.overallVelocityX:v&Zn&&(w=d.overallVelocityY),this._super.attrTest.call(this,d)&&v&d.offsetDirection&&d.distance>this.options.threshold&&d.maxPointers==this.options.pointers&&c(w)>this.options.velocity&&d.eventType&Ee},emit:function(d){var v=$d(d.offsetDirection);v&&this.manager.emit(this.options.event+v,d),this.manager.emit(this.options.event,d)}});function Po(){Qt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}p(Po,Qt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pc]},process:function(d){var v=this.options,w=d.pointers.length===v.pointers,I=d.distance<v.threshold,O=d.deltaTime<v.time;if(this.reset(),d.eventType&Te&&this.count===0)return this.failTimeout();if(I&&O&&w){if(d.eventType!=Ee)return this.failTimeout();var V=this.pTime?d.timeStamp-this.pTime<v.interval:!0,Y=!this.pCenter||Eo(this.pCenter,d.center)<v.posThreshold;this.pTime=d.timeStamp,this.pCenter=d.center,!Y||!V?this.count=1:this.count+=1,this._input=d;var be=this.count%v.taps;if(be===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Zt,this.tryEmit()},v.interval,this),ct):Zt}return Nt},failTimeout:function(){return this._timer=f(function(){this.state=Nt},this.options.interval,this),Nt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Zt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function gn(d,v){return v=v||{},v.recognizers=x(v.recognizers,gn.defaults.preset),new Tc(d,v)}gn.VERSION="2.0.7",gn.defaults={domEvents:!1,touchAction:jd,enable:!0,inputTarget:null,inputClass:null,preset:[[yc,{enable:!1}],[_c,{enable:!1},["rotate"]],[vc,{direction:Mt}],[Co,{direction:Mt},["swipe"]],[Po],[Po,{event:"doubletap",taps:2},["tap"]],[mc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var eE=1,Xd=2;function Tc(d,v){this.options=S({},gn.defaults,v||{}),this.options.inputTarget=this.options.inputTarget||d,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=d,this.input=IT(this),this.touchAction=new gc(this,this.options.touchAction),Yd(this,!0),_(this.options.recognizers,function(w){var I=this.add(new w[0](w[1]));w[2]&&I.recognizeWith(w[2]),w[3]&&I.requireFailure(w[3])},this)}Tc.prototype={set:function(d){return S(this.options,d),d.touchAction&&this.touchAction.update(),d.inputTarget&&(this.input.destroy(),this.input.target=d.inputTarget,this.input.init()),this},stop:function(d){this.session.stopped=d?Xd:eE},recognize:function(d){var v=this.session;if(!v.stopped){this.touchAction.preventDefaults(d);var w,I=this.recognizers,O=v.curRecognizer;(!O||O&&O.state&Zt)&&(O=v.curRecognizer=null);for(var V=0;V<I.length;)w=I[V],v.stopped!==Xd&&(!O||w==O||w.canRecognizeWith(O))?w.recognize(d):w.reset(),!O&&w.state&(ct|kr|pn)&&(O=v.curRecognizer=w),V++}},get:function(d){if(d instanceof Qt)return d;for(var v=this.recognizers,w=0;w<v.length;w++)if(v[w].options.event==d)return v[w];return null},add:function(d){if(h(d,"add",this))return this;var v=this.get(d.options.event);return v&&this.remove(v),this.recognizers.push(d),d.manager=this,this.touchAction.update(),d},remove:function(d){if(h(d,"remove",this))return this;if(d=this.get(d),d){var v=this.recognizers,w=H(v,d);w!==-1&&(v.splice(w,1),this.touchAction.update())}return this},on:function(d,v){if(d!==i&&v!==i){var w=this.handlers;return _(U(d),function(I){w[I]=w[I]||[],w[I].push(v)}),this}},off:function(d,v){if(d!==i){var w=this.handlers;return _(U(d),function(I){v?w[I]&&w[I].splice(H(w[I],v),1):delete w[I]}),this}},emit:function(d,v){this.options.domEvents&&tE(d,v);var w=this.handlers[d]&&this.handlers[d].slice();if(!(!w||!w.length)){v.type=d,v.preventDefault=function(){v.srcEvent.preventDefault()};for(var I=0;I<w.length;)w[I](v),I++}},destroy:function(){this.element&&Yd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Yd(d,v){var w=d.element;if(w.style){var I;_(d.options.cssProps,function(O,V){I=q(w.style,V),v?(d.oldCssProps[I]=w.style[I],w.style[I]=O):w.style[I]=d.oldCssProps[I]||""}),v||(d.oldCssProps={})}}function tE(d,v){var w=n.createEvent("Event");w.initEvent(d,!0,!0),w.gesture=v,v.target.dispatchEvent(w)}S(gn,{INPUT_START:Te,INPUT_MOVE:qn,INPUT_END:Ee,INPUT_CANCEL:Ye,STATE_POSSIBLE:Ro,STATE_BEGAN:ct,STATE_CHANGED:kr,STATE_ENDED:pn,STATE_RECOGNIZED:Zt,STATE_CANCELLED:qi,STATE_FAILED:Nt,DIRECTION_NONE:vo,DIRECTION_LEFT:Hi,DIRECTION_RIGHT:Wi,DIRECTION_UP:$i,DIRECTION_DOWN:Xi,DIRECTION_HORIZONTAL:Mt,DIRECTION_VERTICAL:Zn,DIRECTION_ALL:xd,Manager:Tc,Input:lt,TouchAction:gc,TouchInput:wo,MouseInput:So,PointerEventInput:hc,TouchMouseInput:dc,SingleTouchInput:Bd,Recognizer:Qt,AttrRecognizer:Tt,Tap:Po,Pan:Co,Swipe:vc,Pinch:_c,Rotate:yc,Press:mc,on:M,off:N,each:_,merge:m,extend:C,assign:S,inherit:p,bindFn:E,prefixed:q});var nE=typeof e<"u"?e:typeof self<"u"?self:{};nE.Hammer=gn,t.exports?t.exports=gn:e[r]=gn})(window,document,"Hammer")})(lT);var mo=lT.exports;const zI=_m(mo),Ut=sE({__proto__:null,default:zI},[mo]),cT=1,uT=2,Gf=4,jI={mousedown:cT,mousemove:uT,mouseup:Gf};function HI(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function WI(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(HI(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function $I(t){t.prototype.handler=function(n){let r=jI[n.type];r&cT&&n.button>=0&&(this.pressed=!0),r&uT&&n.buttons===0&&(r=Gf),this.pressed&&(r&Gf&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}WI(mo.PointerEventInput);$I(mo.MouseInput);const XI=mo.Manager;class lc{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const YI=Ut?[[Ut.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ut.Rotate,{enable:!1}],[Ut.Pinch,{enable:!1}],[Ut.Swipe,{enable:!1}],[Ut.Pan,{threshold:0,enable:!1}],[Ut.Press,{enable:!1}],[Ut.Tap,{event:"doubletap",taps:2,enable:!1}],[Ut.Tap,{event:"anytap",enable:!1}],[Ut.Tap,{enable:!1}]]:null,M_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},KI={doubletap:["tap"]},qI={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Cd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},ZI={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},N_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},QI=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",oi=typeof window<"u"?window:global;let eh=!1;try{const t={get passive(){return eh=!0,!0}};oi.addEventListener("test",null,t),oi.removeEventListener("test",null)}catch{eh=!1}const JI=QI.indexOf("firefox")!==-1,{WHEEL_EVENTS:GI}=Cd,k_="wheel",O_=4.000244140625,eM=40,tM=.25;class nM extends lc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;oi.WheelEvent&&(JI&&i.deltaMode===oi.WheelEvent.DOM_DELTA_PIXEL&&(s/=oi.devicePixelRatio),i.deltaMode===oi.WheelEvent.DOM_DELTA_LINE&&(s*=eM)),s!==0&&s%O_===0&&(s=Math.floor(s/O_)),i.shiftKey&&s&&(s=s*tM),this.callback({type:k_,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(GI),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,eh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===k_&&(this.options.enable=n)}}const{MOUSE_EVENTS:rM}=Cd,F_="pointermove",D_="pointerover",B_="pointerout",U_="pointerenter",L_="pointerleave";class iM extends lc{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(rM),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===F_&&(this.enableMoveEvent=n),e===D_&&(this.enableOverEvent=n),e===B_&&(this.enableOutEvent=n),e===U_&&(this.enableEnterEvent=n),e===L_&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(D_,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(B_,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(U_,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(L_,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(F_,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:sM}=Cd,V_="keydown",z_="keyup";class oM extends lc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:V_,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:z_,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(sM),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===V_&&(this.enableDownEvent=n),e===z_&&(this.enableUpEvent=n)}}const j_="contextmenu";class aM extends lc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:j_,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===j_&&(this.options.enable=n)}}const H_=1,th=2,W_=4,lM={pointerdown:H_,pointermove:th,pointerup:W_,mousedown:H_,mousemove:th,mouseup:W_},cM=0,uM=1,fM=2,hM=1,dM=2,pM=4;function gM(t){const e=lM[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===th?(i=!!(n&hM),s=!!(n&pM),o=!!(n&dM)):(i=r===cM,s=r===uM,o=r===fM),{leftButton:i,middleButton:s,rightButton:o}}function _M(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const vu={srcElement:"root",priority:0};class mM{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=vu;typeof r=="string"||r&&r.addEventListener?l={...vu,srcElement:r}:r&&(l={...vu,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:f}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...gM(e),..._M(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const yM={events:null,recognizers:null,recognizerOptions:{},Manager:XI,touchAction:"none",tabIndex:0};class vM{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=qI[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...yM,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||YI}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(M_).forEach(i=>{const s=this.manager.get(i);s&&M_[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new nM(e,this._onOtherEvent,{enable:!1}),this.moveInput=new iM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new oM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new aM(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=KI[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=N_[e]||e;let c=a.get(l);c||(c=new mM(this),a.set(l,c),c.recognizerName=ZI[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=N_[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Tn(){}const TM=({isDragging:t})=>t?"grabbing":"grab",$_={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Tn,onWebGLInitialized:Tn,onResize:Tn,onViewStateChange:Tn,onInteractionStateChange:Tn,onBeforeRender:Tn,onAfterRender:Tn,onLoad:Tn,onError:t=>se.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:TM,getTooltip:null,debug:!1,drawPickingColors:!1},Ol=class Ol{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new tc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=Hf[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let f=!1;c&&(f=c.call(l,a,r)),f||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...$_,...e},e=this.props,e.viewState&&e.initialViewState&&se.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&se.error("WebGL1 context not supported.")(),this.device=Ns.attach(e.gl));let n=this.device;n||(gi.registerDevices([Ns]),n=gi.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Oi.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&se.removed("onLayerHover","onHover")(),"onLayerClick"in e&&se.removed("onLayerClick","onClick")(),e.initialViewState&&!bt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ke(this.viewManager),this.viewManager.views}getViewports(e){return ke(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){ke(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ke(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new HP({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new S2({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Ns&&this.props.onWebGLInitialized(this.device.gl);const n=new jv;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new vM(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Hf)this.eventManager.on(o,this._onEvent);this.viewManager=new l2({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new a2(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new R2({deck:this,device:this.device}),this.deckRenderer=new P2(this.device),this.deckPicker=new O2(this.device),this.widgetManager=new B2({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new L2),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),se.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=gi.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}};Ol.defaultProps=$_,Ol.VERSION=aR;let nh=Ol;function EM(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return pv(t)}}const SM=dv;function oa(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function ur(t){return t.stride||t.size*t.bytesPerElement}function wM(t,e){return t.type===e.type&&t.size===e.size&&ur(t)===ur(e)&&(t.offset||0)===(e.offset||0)}function rh(t,e){e.offset&&se.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=ur(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function AM(t,e){const n=rh(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class RM{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=EM(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ur(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Oi.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=rh(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:ur(r),attributes:i};if(this.doublePrecision){const o=AM(r,n||{});i.push(oa(e,{...r,...o.high}),oa(`${e}64Low`,{...r,...o.low}))}else if(n){const o=rh(r,n);i.push(oa(e,{...r,...o}))}else i.push(oa(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof fe?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=SM(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=ur(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=ur(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=ou(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?ou(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Oi.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?ou(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&se.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?fe.INDEX:fe.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const X_=[],Y_=[];function fT(t,e=0,n=1/0){let r=X_;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(Y_.length=t.length,r=Y_):r=X_,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function hT(t){return t&&t[Symbol.asyncIterator]}function dT(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:_})=>{if(!s){const m=h*l+c;for(let p=0;p<n;p++)_[p]=t[m+p];return _}const y=s[h],S=s[h+1]||u;let C;if(o){C=new Array(S-y);for(let m=y;m<S;m++){const p=m*l+c;_=new Array(n);for(let E=0;E<n;E++)_[E]=t[p+E];C[m-y]=_}}else if(l===n)C=t.subarray(y*n+c,S*n+c);else{C=new t.constructor((S-y)*n);let m=0;for(let p=y;p<S;p++){const E=p*l+c;for(let A=0;A<n;A++)C[m++]=t[E+A]}}return C}}const bM=[],Sa=[[0,1/0]];function CM(t,e){if(t===Sa||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const PM={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function pT(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...PM[n],...e,...t,type:n}}class gT extends RM{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Sa}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!wM(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return pT(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=CM(this.state.updateRanges,[r,i])}else this.state.updateRanges=Sa}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=bM}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Sa),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;ke(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=dT(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:_}=a,y=l.binaryAccessor||(typeof h=="function"?h:s[h]);ke(typeof y=="function",`accessor "${h}" is not a function`);let S=e.getVertexOffset(r);const{iterable:C,objectInfo:m}=fT(n,r,i);for(const p of C){m.index++;let E=y(p,m);if(_&&(E=_.call(this,E)),f){const A=(m.index<f.length-1?f[m.index+1]:o)-f[m.index];if(E&&Array.isArray(E[0])){let x=S;for(const M of E)e._normalizeValue(M,c,x),x+=u}else E&&E.length>u?c.set(E,S):(e._normalizeValue(E,m.target,0),n2({target:c,source:m.target,start:S,count:A}));S+=A*u}else e._normalizeValue(E,c,S),S+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Tu(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<i;f++)n[r+c]=u[f]||0,c++}}function xM({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Tu({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,f)=>r(u+a,f)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const f=i[u]*n,h=s[u]*n;Tu({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&Tu({source:[],target:e,start:a,size:n,getData:l}),e}function IM(t){const{device:e,settings:n,value:r}=t,i=new gT(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function _T(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function mT(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function yT(t){t.push(t.shift())}function MM(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function vT({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function TT({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,f=n.startIndices,h=s&&f,_=n.isConstant;if(!h&&e&&r>=i)return e;const y=n.value instanceof Float64Array?Float32Array:n.value.constructor,S=_?n.value:new y(n.getBuffer().readSyncWebGL(c,i*y.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!_){const E=o;o=(A,x)=>n.normalizeConstant(E(A,x))}const C=_?(E,A)=>o(S,A):(E,A)=>o(S.subarray(E+c,E+c+l),A),m=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),p=new Float32Array(i);return xM({source:m,target:p,sourceStartIndices:s,targetStartIndices:f,size:l,getData:C}),(!e||e.byteLength<p.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:p.byteLength+u,usage:35050})),e.write(p,u),e}class ET{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new sc(r),this.attribute=n,this.attributeInTransition=IM(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=MM(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class NM extends ET{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=FM(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;yT(s),s[0]=TT({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=vT({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);ST(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const kM=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,OM=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function ST(t){return t.doublePrecision&&t.value instanceof Float64Array}function FM(t,e){const n=e.size,r=_T(n),i=mT(n),s=e.getBufferLayout();return ST(e)?new io(t,{vs:OM,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[O3],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new io(t,{vs:kM,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class DM extends ET{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=VM(e),this.framebuffer=zM(e,this.texture),this.transform=LM(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=TT({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=vT({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),yT(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const BM=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,UM=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function LM(t,e){const n=_T(e.size),r=mT(e.size);return new io(t,{vs:BM,fs:UM,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function VM(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function zM(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const jM={interpolation:NM,spring:DM};class HM{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=jM[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(se.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const K_="attributeManager.invalidate",WM="attributeManager.updateStart",$M="attributeManager.updateEnd",XM="attribute.updateStart",YM="attribute.allocate",KM="attribute.updateEnd";class qM{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=_o(NP),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new HM(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);He(K_,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);He(K_,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;He(WM,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&se.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&He($M,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new gT(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(He(XM,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&He(YM,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,He(KM,n,r))}}class ZM extends sc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=al(n,r,o)}}const q_=1e-5;function Z_(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function QM(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Z_(t[o],e[o],n[o],r,i);return s}return Z_(t,e,n,r,i)}function Q_(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class JM extends sc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=QM(s,o,n,r,i);const l=Q_(a,n),c=Q_(a,o);l<q_&&c<q_&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const GM={interpolation:ZM,spring:JM};class eN{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=pT(i),!i)return;const o=GM[i.type];if(!o){se.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function tN(t){const e=t[gr];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function nN(t,e){const n=wT({newProps:t,oldProps:e,propTypes:t[gr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=iN(t,e);let i=!1;return r||(i=sN(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:oN(t,e),transitionsChanged:rN(t,e)}}function rN(t,e){if(!t.transitions)return!1;const n={},r=t[gr];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&ih(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function wT({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=ih(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=ih(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function ih(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function iN(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function sN(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&J_(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&J_(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function oN(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function J_(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},wT({oldProps:i,newProps:r,triggerName:n})}const aN="count(): argument not an object",lN="count(): argument not a container";function cN(t){if(!fN(t))throw new Error(aN);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(uN(t))return Object.keys(t).length;throw new Error(lN)}function uN(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function fN(t){return t!==null&&typeof t=="object"}function G_(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const hN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},sh={};function dN(t,e,n,r){if(n instanceof dt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...hN,...i,...r}});return sh[s.id]=t,s}function pN(t,e){!e||!(e instanceof dt)||sh[e.id]===t&&(e.delete(),delete sh[e.id])}const gN={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||oh(t)&&(t.length===3||t.length===4)},equal(t,e,n){return bt(t,e,1)}},accessor:{validate(t,e){const n=gl(t);return n==="function"||n===gl(e.value)},equal(t,e,n){return typeof e=="function"?!0:bt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||oh(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?bt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?bt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:dN(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{pN(n.id,t)}}};function _N(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=mN(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function mN(t,e){switch(gl(e)){case"object":return us(t,e);case"array":return us(t,{type:"array",value:e,compare:!1});case"boolean":return us(t,{type:"boolean",value:e});case"number":return us(t,{type:"number",value:e});case"function":return us(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function us(t,e){return"type"in e?{name:t,...gN[e.type],...e}:"value"in e?{name:t,type:gl(e.value),...e}:{name:t,type:"object",value:e}}function oh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function gl(t){return oh(t)?"array":t===null?"null":typeof t}function yN(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=ah(t.constructor,n),i=Object.create(r);i[dl]=t,i[Sr]={},i[In]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const vN="_mergedDefaultProps";function ah(t,e){let n=vN;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=AT(t,n);return r||(t[n]=TN(t,e||[]))}function TN(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=ah(r),s=AT(t,"defaultProps")||{},o=_N(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[gr],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[cu],o.deprecatedProps);for(const u of e){const f=ah(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[gr]),Object.assign(c,f[cu]))}return EN(a,t),wN(a,l),SN(a,c),a[gr]=l,a[cu]=c,e.length===0&&!Pd(t,"_propTypes")&&(t._propTypes=l),a}function EN(t,e){const n=RN(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function SN(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Pd(this,s)||(this[s]=r);se.deprecated(i,e[n].join("/"))()}})}function wN(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=AN(o))}t[yi]=n,t[Sr]={},Object.defineProperties(t,r)}function AN(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||hT(e)?this[Sr][t]=e:this[In][t]=e},get(){if(this[In]){if(t in this[In])return this[In][t]||this[yi][t];if(t in this[Sr]){const e=this[dl]&&this[dl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[yi][t]}}return this[yi][t]}}}function Pd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function AT(t,e){return Pd(t,e)&&t[e]}function RN(t){const e=t.componentName;return e||se.warn(`${t.name}.componentName not specified`)(),e||t.name}let bN=0;const Fl=class Fl{constructor(...e){this.props=yN(this,e),this.id=this.props.id,this.count=bN++}clone(e){const{props:n}=this,r={};for(const i in n[yi])i in n[In]?r[i]=n[In][i]:i in n[Sr]&&(r[i]=n[Sr][i]);return new this.constructor({...n,...r,...e})}};Fl.componentName="Component",Fl.defaultProps={};let lh=Fl;const CN=Object.freeze({});class PN{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||CN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[dl]||this.component;const n=e[In]||{},r=e[Sr]||e,i=e[yi]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(hT(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[gr];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class xN extends PN{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const IN="layer.changeFlag",MN="layer.initialize",NN="layer.update",kN="layer.finalize",ON="layer.matched",em=2**24-1,FN=Object.freeze([]),DN=_o(({oldViewport:t,viewport:e})=>t.equals(e));let Lt=new Uint8ClampedArray(0);const BN={data:{type:"data",value:FN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:wf(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):wf(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:J.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Dl=class Dl extends lh{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ke(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=zv(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=Uv(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return ke(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ke(this.internalState);const r=this.internalState.viewport||this.context.viewport;return UP(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===J.DEFAULT||e===J.LNGLAT||e===J.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ke(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:cN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=G_(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=G_(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!DN({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Lt.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>em&&se.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Lt=Oi.allocate(Lt,n,{size:4,copy:!0,maxCount:Math.max(n,em)});const i=Math.floor(Lt.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Lt[o*4+0]=s[0],Lt[o*4+1]=s[1],Lt[o*4+2]=s[2]}e.value=Lt.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const f=c[u];f instanceof fe?n[l].settings.isIndexed?e.setIndexBuffer(f):s[u]=f:f&&(o[u]=f)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Lt.buffer&&(r.value=Lt.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ke(!this.internalState),ke(Number.isFinite(this.props.coordinateSystem)),He(MN,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new xN({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(se.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new eN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){He(ON,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(He(NN,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){He(kN,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:f}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:f}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const f of this.props.extensions)f.draw.call(this,u,f);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&He(IN,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=nN(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){tN(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new qM(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Dl.defaultProps=BN,Dl.layerName="Layer";let _l=Dl;class UN{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=Oi,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(ke(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?dT(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=fT(i,n,r);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const _=f&&this.normalizeGeometry(f);c[h]=_,r[h+1]=r[h]+(_?this.getGeometrySize(_):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof fe){const f=this.positionSize*4;i=i||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;i=i||f.length/h}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const u={};this._forEachGeometry((f,h)=>{const _=c[h]||f;u.vertexStart=r[h],u.indexStart=n[h];const y=h<r.length-1?r[h+1]:i;u.geometrySize=y-r[h],u.geometryIndex=h,this.updateGeometryAttributes(_,u)},a,l),this.vertexCount=n[n.length-1]}}const LN=typeof window<"u"?k.useLayoutEffect:k.useEffect;function ml(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const VN={position:"absolute",zIndex:-1};function RT(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>RT(n,e));if(cc(t)){if(zN(t))return e.style=VN,k.cloneElement(t,e);if(jN(t))return k.cloneElement(t,e)}return t}function cc(t){return t&&typeof t=="object"&&"type"in t||!1}function zN(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function jN(t){const e=t.type;return e&&e.deckGLViewProps}function ch(t){if(typeof t=="function")return k.createElement(Fi,{},t);if(Array.isArray(t))return t.map(ch);if(cc(t)){if(t.type===k.Fragment)return ch(t.props.children);if(ml(t.type,Fi))return t}return t}function HN({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return k.Children.forEach(ch(t),o=>{if(cc(o)){const a=o.type;if(ml(a,_l)){const l=WN(a,o.props);i.push(l)}else r.push(o);if(ml(a,Fi)&&a!==Fi&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function WN(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function $N({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;cc(o)&&ml(o.type,Fi)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:f,y:h,width:_,height:y}=c;l=RT(l,{x:f,y:h,width:_,height:y,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:f,height:h}=a,_={position:"absolute",left:c,top:u,width:f,height:h},y=`view-${o}`,S=k.createElement("div",{key:y,id:y,style:_},...l);if(n){const C={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:m=>{m.viewId=o,e._onViewStateChange(m)}};return k.createElement(n,{key:y,value:C},S)}return S})}const XN={mixBlendMode:null};function YN({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in XN?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function KN(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function bT(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function qN(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():bT(t)}});return r}function ZN(t,e){const[n,r]=k.useState(0),s=k.useRef({control:null,version:n,forceUpdate:()=>r(x=>x+1)}).current,o=k.useRef(null),a=k.useRef(null),l=k.useMemo(()=>HN(t),[t.layers,t.views,t.children]);let c=!0;const u=x=>{var M;return c&&t.viewState?(s.viewStateUpdateRequested=x,null):(s.viewStateUpdateRequested=null,(M=t.onViewStateChange)==null?void 0:M.call(t,x))},f=x=>{var M;c?s.interactionStateUpdateRequested=x:(s.interactionStateUpdateRequested=null,(M=t.onInteractionStateChange)==null||M.call(t,x))},h=k.useMemo(()=>{const x={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete x._customRender,s.deck&&s.deck.setProps(x),x},[t]);k.useEffect(()=>{const x=t.Deck||nh;return s.deck=qN(s,x,{...h,parent:o.current,canvas:a.current}),()=>{var M;return(M=s.deck)==null?void 0:M.finalize()}},[]),LN(()=>{bT(s);const{viewStateUpdateRequested:x,interactionStateUpdateRequested:M}=s;x&&u(x),M&&f(M)}),k.useImperativeHandle(e,()=>KN(s),[]);const _=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:y,width:S="100%",height:C="100%",id:m,style:p}=t,{containerStyle:E,canvasStyle:A}=k.useMemo(()=>YN({width:S,height:C,style:p}),[S,C,p]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===_||s.version!==n){s.lastRenderedViewports=_,s.version=n;const x=$N({children:l.children,deck:s.deck,ContextProvider:y}),M=k.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:A});s.control=k.createElement("div",{id:`${m||"deckgl"}-wrapper`,ref:o,style:E},[M,x])}return c=!1,s.control}const QN=k.forwardRef(ZN),JN="modulepreload",GN=function(t){return"/bird-tracking/"+t},tm={},ek=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.all(n.map(a=>{if(a=GN(a),a in tm)return;tm[a]=!0;const l=a.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":JN,l||(u.as="script",u.crossOrigin=""),u.href=a,o&&u.setAttribute("nonce",o),document.head.appendChild(u),l)return new Promise((f,h)=>{u.addEventListener("load",f),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${a}`)))})}))}return i.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},tk=k.createContext(null);function nk(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function tn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!tn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!tn(t[i],e[i]))return!1;return!0}return!1}function rk(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function nm(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();tn(n,r)||e.setProjection(n)}function rm(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function im(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const ik=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function sm(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of ik)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}var om={};const am={version:8,sources:{},layers:[]},lm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Eu={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},cm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},sk=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],ok=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Di{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[cm[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[lm[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Eu[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Di.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=am}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||ak()||null,container:e,style:sm(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),nm(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in lm)o.on(u,this._onPointerEvent);for(const u in Eu)o.on(u,this._onCameraEvent);for(const u in cm)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Di.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=rk(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=im(i,{...rm(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||im(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of sk)if(s in e&&!tn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=am,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(sm(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!tn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!tn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!tn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of ok){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;tn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Eu&&(typeof n=="object"&&(n.viewState=rm(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{nm(this._renderTransform,n),e.transform=n}}}Di.savedMaps=[];function ak(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||om.MapboxAccessToken}catch{}try{t=t||om.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const lk=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function ck(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of uk(e))!(r in n)&&!lk.includes(r)&&(n[r]=e[r].bind(e));return n}function uk(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const fk=typeof document<"u"?k.useLayoutEffect:k.useEffect,hk=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function dk(t,e){for(const r of hk)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const uc=k.createContext(null);function pk(t,e,n){const r=k.useContext(tk),[i,s]=k.useState(null),o=k.useRef(),{current:a}=k.useRef({mapLib:null,map:null});k.useEffect(()=>{const u=t.mapLib;let f=!0,h;return Promise.resolve(u||n).then(_=>{if(!f)return;if(!_)throw new Error("Invalid mapLib");const y="Map"in _?_:_.default;if(!y.Map)throw new Error("Invalid mapLib");if(dk(y,t),!y.supported||y.supported(t))t.reuseMaps&&(h=Di.reuse(t,o.current)),h||(h=new Di(y.Map,t,o.current)),a.map=ck(h),a.mapLib=y,s(h),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(_=>{const{onError:y}=t;y?y({type:"error",target:null,originalEvent:null,error:_}):console.error(_)}),()=>{f=!1,h&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?h.recycle():h.destroy())}},[]),fk(()=>{i&&i.setProps(t)}),k.useImperativeHandle(e,()=>a.map,[i]);const l=k.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return k.createElement("div",{id:t.id,ref:o,style:l},i&&k.createElement(uc.Provider,{value:a},k.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const gk=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ir(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!gk.test(r)?n[r]=`${i}px`:n[r]=i}}function _k(t,e){const{map:n,mapLib:r}=k.useContext(uc),i=k.useRef({props:t});i.current.props=t;const s=k.useMemo(()=>{let S=!1;k.Children.forEach(t.children,p=>{p&&(S=!0)});const C={...t,element:S?document.createElement("div"):null},m=new r.Marker(C);return m.setLngLat([t.longitude,t.latitude]),m.getElement().addEventListener("click",p=>{var E,A;(A=(E=i.current.props).onClick)===null||A===void 0||A.call(E,{type:"click",target:m,originalEvent:p})}),m.on("dragstart",p=>{var E,A;const x=p;x.lngLat=s.getLngLat(),(A=(E=i.current.props).onDragStart)===null||A===void 0||A.call(E,x)}),m.on("drag",p=>{var E,A;const x=p;x.lngLat=s.getLngLat(),(A=(E=i.current.props).onDrag)===null||A===void 0||A.call(E,x)}),m.on("dragend",p=>{var E,A;const x=p;x.lngLat=s.getLngLat(),(A=(E=i.current.props).onDragEnd)===null||A===void 0||A.call(E,x)}),m},[]);k.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:f=null,rotation:h=0,rotationAlignment:_="auto",pitchAlignment:y="auto"}=t;return k.useEffect(()=>{Ir(s.getElement(),c)},[c]),k.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!nk(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==h&&s.setRotation(h),s.getRotationAlignment()!==_&&s.setRotationAlignment(_),s.getPitchAlignment()!==y&&s.setPitchAlignment(y),s.getPopup()!==f&&s.setPopup(f),od.createPortal(t.children,s.getElement())}k.memo(k.forwardRef(_k));function um(t){return new Set(t?t.trim().split(/\s+/):[])}function mk(t,e){const{map:n,mapLib:r}=k.useContext(uc),i=k.useMemo(()=>document.createElement("div"),[]),s=k.useRef({props:t});s.current.props=t;const o=k.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,f;(f=(u=s.current.props).onOpen)===null||f===void 0||f.call(u,c)}),l},[]);if(k.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),k.useEffect(()=>{Ir(o.getElement(),t.style)},[t.style]),k.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!tn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=um(o.options.className),l=um(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return od.createPortal(t.children,i)}k.memo(k.forwardRef(mk));function yo(t,e,n,r){const i=k.useContext(uc),s=k.useMemo(()=>t(i),[]);return k.useEffect(()=>{const o=e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function yk(t){const e=yo(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return k.useEffect(()=>{Ir(e._container,t.style)},[t.style]),null}k.memo(yk);function vk(t){const e=yo(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return k.useEffect(()=>{Ir(e._controlContainer,t.style)},[t.style]),null}k.memo(vk);function Tk(t,e){const n=k.useRef({props:t}),r=yo(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,k.useImperativeHandle(e,()=>r,[]),k.useEffect(()=>{Ir(r._container,t.style)},[t.style]),null}k.memo(k.forwardRef(Tk));function Ek(t){const e=yo(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return k.useEffect(()=>{Ir(e._container,t.style)},[t.style]),null}k.memo(Ek);function Sk(t){const e=yo(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=k.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),k.useEffect(()=>{Ir(e._container,i)},[i]),null}k.memo(Sk);const wk=ek(()=>import("./maplibre-gl-D-aJ2ALj.js").then(t=>t.m),[]),Ak=k.forwardRef(function(e,n){return pk(e,n,wk)});var CT={};Object.defineProperty(CT,"__esModule",{value:!0});function Rk(t,e,n){var r,i,s;if(e==0)r=i=s=n;else{var o=function(u,f,h){return h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?u+(f-u)*6*h:h<.5?f:h<.6666666666666666?u+(f-u)*(.6666666666666666-h)*6:u},a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]}function bk(t,e){for(var n=e||{lum:50,sat:50},r=isNaN(n.lum)?50:n.lum,i=isNaN(n.sat)?50:n.sat,s=isNaN(t)?3:t,o=[],a=0;a<s;a++)e.rgb?o.push("rgb("+Rk(a/s,i/100,r/100).toString()+")"):o.push("HSL("+360*a/s+","+i+"%,"+r+"%)");return o}var Ck=CT.generate=bk;const Pk=Ck(10,{lum:50,sat:75,rgb:!0}).map(t=>t.replace("rgb(","").replace(")","").split(",").map(e=>Number(e))),xk=[{name:"Aegypius monachus",name_en:"Cinereous vulture",name_fr:"Vautour moine",type:"raptor"},{name:"Aquila clanga",name_en:"Greater spotted eagle",name_fr:"Aigle criard",type:"raptor"},{name:"Aquila pomarina",name_en:"Lesser spotted eagle",name_fr:"Aigle Pomarin",type:"raptor"},{name:"Botaurus stellaris",name_en:"Eurasian bittern",name_fr:"Butor toil",type:"other"},{name:"Buteo buteo",name_en:"Common buzzard",name_fr:"Buse variable",type:"raptor"},{name:"Ciconia ciconia",name_en:"White stork",name_fr:"Cigogne blanche",type:"other"},{name:"Ciconia nigra",name_en:"Black stork",name_fr:"Cigogne noire",type:"other"},{name:"Grus grus",name_en:"Common crane",name_fr:"Grue cendre",type:"other"},{name:"Haliaeetus albicilla",name_en:"White-tailed eagle",name_fr:"Pygargue  queue blanche",type:"raptor"},{name:"Pandion haliaetus",name_en:"Osprey",name_fr:"Balbuzard pcheur",type:"raptor"}].map((t,e)=>({...t,color:Pk[e]}));xk.reduce((t,e)=>({...t,[e.name]:{...e}}),{});const Ik=3600*5;function aa(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function fm(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function hm(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function dm(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Su(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function PT(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=hm(t,0,n,o);let h,_;const y=Mk(f,i,s,[]),S=[];aa(c,f);for(let C=1;C<l;C++){for(h=hm(t,C,n,o,h),_=Su(h,y);_;){dm(f,h,_,y,S);const m=Su(S,y);m&&(dm(f,S,m,y,S),_=m),aa(c,S),fm(f,S),Nk(y,i,_),r&&c.length>n&&(c=[],u.push(c),aa(c,f)),_=Su(h,y)}aa(c,h),fm(f,h)}return r?u:u[0]}function Mk(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function Nk(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function kk(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);Ok(o,n,0,i-r);const a=PT(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)Fk(l,n);return a}function Ok(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function Fk(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function Dk(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?PT(i,{size:e,gridResolution:n}):r?kk(i,{size:e}):i}const Bk=1,Uk=2,wu=4;class Lk extends UN{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Dk(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(pm(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&pm(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=wu,r[s+o-2]=wu):(r[s]+=Bk,r[s+o-2]+=Uk),r[s+o-1]=wu}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function pm(t){return Array.isArray(t[0])}const Vk=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,zk=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xT=[0,0,0,255],jk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:xT},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Au={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Bl=class Bl extends _l{getShaders(){return super.getShaders({vs:Vk,fs:zk,modules:[HC,fP]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Au,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Au,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Au,defaultValue:xT},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new Lk({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:jf[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ro(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new JP({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}};Bl.defaultProps=jk,Bl.layerName="PathLayer";let uh=Bl;const Hk={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}},Ul=class Ul extends uh{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
in float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:r,currentTime:i}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:r,currentTime:i},super.draw(e)}};Ul.layerName="TripsLayer",Ul.defaultProps=Hk;let fh=Ul;const Wk={longitude:19,latitude:47,zoom:5,minZoom:0,maxZoom:20},$k=({time:t,data:e,highlightedSpecies:n})=>{const[r,i]=k.useState(void 0),[s,o]=k.useState(null),a=k.useRef(null),l=k.useMemo(()=>Array.from(new Set((e||[]).map(h=>{var _;return(_=h==null?void 0:h.properties)==null?void 0:_.species}).filter(Boolean))),[e]),c=k.useMemo(()=>M0(l),[l]),u=h=>{var y;const _=(y=h==null?void 0:h.properties)==null?void 0:y.species;return c[_]||[160,160,160]};k.useLayoutEffect(()=>{var h;if(!s&&e&&e.length&&a.current){let _=180,y=90,S=-180,C=-90;for(const x of e)for(const[M,N]of((h=x.geometry)==null?void 0:h.coordinates)||[])M<_&&(_=M),N<y&&(y=N),M>S&&(S=M),N>C&&(C=N);const m={width:a.current.clientWidth||800,height:a.current.clientHeight||600},{latitude:p,longitude:E,zoom:A}=new no(m).fitBounds([[_,y],[S,C]],{padding:40});o({...Wk,latitude:p,longitude:E,zoom:A})}},[s,e]);const f=k.useMemo(()=>{var _;if(!e||!e.length)return 3600;let h=0;for(const y of e){const S=((_=y.properties)==null?void 0:_.times)||[];if(S.length>=2){const C=S[S.length-1]-S[0];C>h&&(h=C)}}return Math.max(h,3600)},[e]);return k.useEffect(()=>{i(new fh({id:"birds",data:e,currentTime:t,getTimestamps:h=>h.properties.times,trailLength:f,getColor:u,getPath:h=>h.geometry.coordinates,getWidth:h=>h.properties.species===n?8:2,jointRounded:!0,capRounded:!0,opacity:.75,widthUnits:"pixels",shadowEnabled:!1,parameters:{blend:!0},updateTriggers:{getWidth:n,getColor:l.join("|")}}))},[e,t,n,l]),W.jsx("div",{id:"map",ref:a,children:s&&W.jsx(QN,{initialViewState:s,controller:!0,layers:r?[r]:[],children:W.jsx(Ak,{attributionControl:!1,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"})})})};function Xk(){const[t,e]=k.useState(!document.hidden);return k.useEffect(()=>{const n=()=>{e(!document.hidden)};return document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}},[]),t}const Yk="/bird-tracking/",Kk=()=>{const[t,e]=k.useState([]),[n,r]=k.useState([]),[i,s]=k.useState(0),[o,a]=k.useState(!1),l=k.useRef(null),[c]=pi("highlightedSpecies"),[u]=pi("activeSpeciesList",[]),[f]=pi("speed"),h=Xk();k.useEffect(()=>{document.body.classList.add("loading"),fetch(`${Yk}birds.geojson`,{cache:"no-cache"}).then(y=>{if(!y.ok)throw new Error(`Failed to load birds.geojson: ${y.status}`);return y.json()}).then(y=>e(Array.isArray(y==null?void 0:y.features)?y.features:[])).catch(y=>{console.error("[data] load error:",y),e([])}).finally(()=>{document.body.classList.remove("loading")})},[]),k.useEffect(()=>{if(t.length>0){const[y,S]=Bw(t);r([y,S]),s(y),a(!0)}},[t]),k.useEffect(()=>{const y=S=>{var C;S.key===" "&&t.length!==0&&!["BUTTON","A","INPUT"].includes((C=S.target)==null?void 0:C.tagName)&&a(m=>!m)};return document.body.addEventListener("keypress",y),()=>document.body.removeEventListener("keypress",y)},[t]),k.useEffect(()=>(h&&o&&!l.current&&(l.current=setInterval(()=>{s(y=>y+Ik*f)},50)),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[o,s,f,h]),k.useEffect(()=>{i>n[1]&&s(n[0])},[i,n,s]);const _=k.useMemo(()=>{const y=Array.from(new Set(t.map(C=>C.properties.species)));return((u==null?void 0:u.length)??0)>0&&u.some(C=>y.includes(C))?t.filter(C=>u.includes(C.properties.species)):t},[t,u]);return W.jsxs(W.Fragment,{children:[W.jsxs("div",{id:"layout",children:[W.jsx($k,{time:i,data:_,highlightedSpecies:c}),W.jsx(Vw,{time:i,timeRange:n,setTime:s,isTimeRunning:o,setIsTimeRunning:a})]}),t.length===0&&W.jsx("div",{id:"loading",children:"Please wait for data to be fetched"})]})};x0(document.getElementById("root")).render(W.jsx(EE.StrictMode,{children:W.jsx(Nw,{children:W.jsx(Kk,{})})}));export{Zk as c,_m as g};
